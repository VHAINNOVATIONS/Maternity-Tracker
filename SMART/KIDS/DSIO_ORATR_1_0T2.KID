KIDS Distribution saved on Jan 07, 2014@13:39:42
DSIO ORATR 1.0 T2
**KIDS**:DSIO ORATR 1.0^

**INSTALL NAME**
DSIO ORATR 1.0
"BLD",9685,0)
DSIO ORATR 1.0^^0^3140107^n
"BLD",9685,4,0)
^9.64PA^21695.5^1
"BLD",9685,4,21695.5,0)
21695.5
"BLD",9685,4,21695.5,222)
y^y^f^^^^n
"BLD",9685,4,"B",21695.5,21695.5)

"BLD",9685,6.3)
3
"BLD",9685,"INID")
y^y
"BLD",9685,"INIT")
DSIOP
"BLD",9685,"KRN",0)
^9.67PA^779.2^20
"BLD",9685,"KRN",.4,0)
.4
"BLD",9685,"KRN",.401,0)
.401
"BLD",9685,"KRN",.402,0)
.402
"BLD",9685,"KRN",.403,0)
.403
"BLD",9685,"KRN",.5,0)
.5
"BLD",9685,"KRN",.84,0)
.84
"BLD",9685,"KRN",3.6,0)
3.6
"BLD",9685,"KRN",3.8,0)
3.8
"BLD",9685,"KRN",9.2,0)
9.2
"BLD",9685,"KRN",9.8,0)
9.8
"BLD",9685,"KRN",9.8,"NM",0)
^9.68A^5^5
"BLD",9685,"KRN",9.8,"NM",1,0)
ORATR^^0^B96864513
"BLD",9685,"KRN",9.8,"NM",2,0)
ORATRPC^^0^B64999387
"BLD",9685,"KRN",9.8,"NM",3,0)
XQALSET^^0^B73846237
"BLD",9685,"KRN",9.8,"NM",4,0)
ORWDX^^0^B68176473
"BLD",9685,"KRN",9.8,"NM",5,0)
ORATR2^^0^B119831724
"BLD",9685,"KRN",9.8,"NM","B","ORATR",1)

"BLD",9685,"KRN",9.8,"NM","B","ORATR2",5)

"BLD",9685,"KRN",9.8,"NM","B","ORATRPC",2)

"BLD",9685,"KRN",9.8,"NM","B","ORWDX",4)

"BLD",9685,"KRN",9.8,"NM","B","XQALSET",3)

"BLD",9685,"KRN",19,0)
19
"BLD",9685,"KRN",19.1,0)
19.1
"BLD",9685,"KRN",101,0)
101
"BLD",9685,"KRN",409.61,0)
409.61
"BLD",9685,"KRN",771,0)
771
"BLD",9685,"KRN",779.2,0)
779.2
"BLD",9685,"KRN",870,0)
870
"BLD",9685,"KRN",8989.51,0)
8989.51
"BLD",9685,"KRN",8989.52,0)
8989.52
"BLD",9685,"KRN",8994,0)
8994
"BLD",9685,"KRN",8994,"NM",0)
^9.68A^1^1
"BLD",9685,"KRN",8994,"NM",1,0)
ORATR ALERT TYPE^^0
"BLD",9685,"KRN",8994,"NM","B","ORATR ALERT TYPE",1)

"BLD",9685,"KRN","B",.4,.4)

"BLD",9685,"KRN","B",.401,.401)

"BLD",9685,"KRN","B",.402,.402)

"BLD",9685,"KRN","B",.403,.403)

"BLD",9685,"KRN","B",.5,.5)

"BLD",9685,"KRN","B",.84,.84)

"BLD",9685,"KRN","B",3.6,3.6)

"BLD",9685,"KRN","B",3.8,3.8)

"BLD",9685,"KRN","B",9.2,9.2)

"BLD",9685,"KRN","B",9.8,9.8)

"BLD",9685,"KRN","B",19,19)

"BLD",9685,"KRN","B",19.1,19.1)

"BLD",9685,"KRN","B",101,101)

"BLD",9685,"KRN","B",409.61,409.61)

"BLD",9685,"KRN","B",771,771)

"BLD",9685,"KRN","B",779.2,779.2)

"BLD",9685,"KRN","B",870,870)

"BLD",9685,"KRN","B",8989.51,8989.51)

"BLD",9685,"KRN","B",8989.52,8989.52)

"BLD",9685,"KRN","B",8994,8994)

"BLD",9685,"PRE")
DSIOE
"BLD",9685,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",9685,"QUES",0)
^9.62^^
"BLD",9685,"REQB",0)
^9.611^^
"FIA",21695.5)
VFD TAR CONTROL
"FIA",21695.5,0)
^VFD(21695.5,
"FIA",21695.5,0,0)
21695.5
"FIA",21695.5,0,1)
y^y^f^^^^n
"FIA",21695.5,0,10)

"FIA",21695.5,0,11)

"FIA",21695.5,0,"RLRO")

"FIA",21695.5,21695.5)
0
"FIA",21695.5,21695.51)
0
"FIA",21695.5,21695.52)
0
"FIA",21695.5,21695.54)
0
"FIA",21695.5,21695.55)
0
"INIT")
DSIOP
"KRN",8994,3948,-1)
0^1
"KRN",8994,3948,0)
ORATR ALERT TYPE^TYPE^ORATR^1^S
"KRN",8994,3948,1,0)
^8994.01^2^2^3131216^^
"KRN",8994,3948,1,1,0)
This RPC allows SMART Alerts to use ComObjects by identifing if a TIU 
"KRN",8994,3948,1,2,0)
Template is either a Reminder Dialog or ComObject.
"KRN",8994,3948,2,0)
^8994.02A^1^1
"KRN",8994,3948,2,1,0)
ORIEN^1^^1^1
"KRN",8994,3948,2,1,1,0)
^8994.021^2^2^3131216^^
"KRN",8994,3948,2,1,1,1,0)
This is the IEN of the VFD TAR CONTROL file entry associated with the 
"KRN",8994,3948,2,1,1,2,0)
current OR Notification used to trigger the SMART Alert.
"KRN",8994,3948,2,"B","ORIEN",1)

"KRN",8994,3948,2,"PARAMSEQ",1,1)

"KRN",8994,3948,3,0)
^8994.03^3^3^3131216^^
"KRN",8994,3948,3,1,0)
Will return a R for Reminder Dialog, C for ComObject or a -1 if neither 
"KRN",8994,3948,3,2,0)
is defined. Furthermore, if both a Reminder Dialog and ComObject are 
"KRN",8994,3948,3,3,0)
defined then the Reminder Dialog will take priority.
"MBREQ")
0
"ORD",16,8994)
8994;16;1;;;;;;;RPCDEL^XPDIA1
"ORD",16,8994,0)
REMOTE PROCEDURE
"PRE")
DSIOE
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
7
"RTN","DSIOE")
0^^B1824524
"RTN","DSIOE",1,0)
DSIOE ;DSS/TFF - ENVIRONMENT CHECK ACTION;06/28/2013 15:19
"RTN","DSIOE",2,0)
 ;;1.0;DSS,INC OPEN SOURCE;;28 Jan 2013;Build 3
"RTN","DSIOE",3,0)
 ;Copyright 1995-2013,Document Storage Systems Inc. All Rights Reserved
"RTN","DSIOE",4,0)
 ;
"RTN","DSIOE",5,0)
 ;
"RTN","DSIOE",6,0)
 ; Documented API and ICRs
"RTN","DSIOE",7,0)
 ; -----------------------
"RTN","DSIOE",8,0)
 ;
"RTN","DSIOE",9,0)
 D ORATR,MODS
"RTN","DSIOE",10,0)
 ;
"RTN","DSIOE",11,0)
 Q
"RTN","DSIOE",12,0)
ORATR ; CHECK FOR PREVIOUS INSTALL
"RTN","DSIOE",13,0)
 N OUT,ERR,Z,CK
"RTN","DSIOE",14,0)
 D LIST^DIC(9.7,,"@;.01","P",,,"OR*3.0*358",,,,"OUT","ERR")
"RTN","DSIOE",15,0)
 I $D(ERR) S XPDQUIT=1 Q
"RTN","DSIOE",16,0)
 S Z=0 F  S Z=$O(OUT("DILIST",Z)) Q:'Z  D
"RTN","DSIOE",17,0)
 .S:$$GET1^DIQ(9.7,$P(OUT("DILIST",Z,0),U),.02)="Install Completed" CK=1
"RTN","DSIOE",18,0)
 I '$D(CK) S XPDQUIT=1 W !,"** OR*3.0*358 MUST BE INSTALLED **",!
"RTN","DSIOE",19,0)
 Q
"RTN","DSIOE",20,0)
MODS ; CHECK THE MODED ROUTINE CHECKSUMS
"RTN","DSIOE",21,0)
 Q:$D(XPDQUIT)
"RTN","DSIOE",22,0)
 N X,CK F X="XQALSET^72705650","ORWDX^66876839" D
"RTN","DSIOE",23,0)
 .S CK=$P(X,U,2),X=$P(X,U)
"RTN","DSIOE",24,0)
 .X ^%ZOSF("TEST") I '$T W !,X," NOT FOUND ON THIS UCI (SKIPPING)** ",$$RTNUP^XPDUTL(X,2),! Q
"RTN","DSIOE",25,0)
 .X ^%ZOSF("RSUM1") I Y'=CK W !,X," INCORRECT CHECKSUM (SKIPPING)** ",$$RTNUP^XPDUTL(X,2),!
"RTN","DSIOE",26,0)
 Q
"RTN","DSIOP")
0^^B2345588
"RTN","DSIOP",1,0)
DSIOP ;DSS/TFF - POST INSTALL ACTION;06/28/2013 15:19
"RTN","DSIOP",2,0)
 ;;1.0;DSS,INC OPEN SOURCE;;28 Jan 2013;Build 3
"RTN","DSIOP",3,0)
 ;Copyright 1995-2013,Document Storage Systems Inc. All Rights Reserved
"RTN","DSIOP",4,0)
 ;
"RTN","DSIOP",5,0)
 ;
"RTN","DSIOP",6,0)
 ; Documented API and ICRs
"RTN","DSIOP",7,0)
 ; -----------------------
"RTN","DSIOP",8,0)
 ;
"RTN","DSIOP",9,0)
 D ORATR,CPRS
"RTN","DSIOP",10,0)
 ;
"RTN","DSIOP",11,0)
 Q
"RTN","DSIOP",12,0)
ORATR ; ADD ORATR RPCs TO OR CPRS GUI CHART
"RTN","DSIOP",13,0)
 N ER,IEN,OUT,ERR,IPT
"RTN","DSIOP",14,0)
 S ER="W !,""** NOT ABLE TO ADD ORATR RPCs TO ""OR CPRS GUI CHART"" **"",! Q"
"RTN","DSIOP",15,0)
 S IEN=$$FIND1^DIC(19,,"O","OR CPRS GUI CHART") X:IEN="" ER
"RTN","DSIOP",16,0)
 D LIST^DIC(8994,,"@;.01","P",,"ORATR","ORATR",,,,"OUT","ERR") X:$D(ERR) ER
"RTN","DSIOP",17,0)
 S Z=0 F  S Z=$O(OUT("DILIST",Z)) Q:'Z  D
"RTN","DSIOP",18,0)
 .S IPT(19.05,"?+1,"_IEN_",",.01)=$P(OUT("DILIST",Z,0),U,2)
"RTN","DSIOP",19,0)
 .D:$D(IPT) UPDATE^DIE("E","IPT") K IPT
"RTN","DSIOP",20,0)
 Q
"RTN","DSIOP",21,0)
 ;
"RTN","DSIOP",22,0)
CPRS ; UPDATE OR CPRS GUI CHART CONTEXT
"RTN","DSIOP",23,0)
 N DIR,X,Y,ER,IEN,IPT,ERR W !
"RTN","DSIOP",24,0)
 S DIR("A")=" WOULD YOU LIKE TO UPDATE THE CPRS VERSION"
"RTN","DSIOP",25,0)
 S DIR(0)="Y",DIR("B")="YES" D ^DIR
"RTN","DSIOP",26,0)
 Q:Y<1
"RTN","DSIOP",27,0)
 K DIR,X,Y W !
"RTN","DSIOP",28,0)
 S DIR("A")=" TYPE THE NEW VERSION NUMBER"
"RTN","DSIOP",29,0)
 S DIR(0)="F",DIR("B")="1.0.29.23" D ^DIR
"RTN","DSIOP",30,0)
 S ER="W !,""**NOT ABLE TO SET CPRS VERSION**"",! Q"
"RTN","DSIOP",31,0)
 S IEN=$$FIND1^DIC(19,,"O","OR CPRS GUI CHART") X:IEN="" ER
"RTN","DSIOP",32,0)
 S IPT(19,IEN_",",1)="CPRSChart version "_Y D FILE^DIE(,"IPT")
"RTN","DSIOP",33,0)
 Q
"RTN","ORATR")
0^1^B96864513
"RTN","ORATR",1,0)
ORATR ; DSS/SMP/ASF - Abnormal Alert Utilities ; AUG 28, 2012
"RTN","ORATR",2,0)
 ;;1.0;VENDOR - DOCUMENT STORAGE SYSTEMS;;7/17/2012;Build 3
"RTN","ORATR",3,0)
 ;;;
"RTN","ORATR",4,0)
 Q
"RTN","ORATR",5,0)
 ;
"RTN","ORATR",6,0)
 ; Documented API and ICRs
"RTN","ORATR",7,0)
 ; -----------------------
"RTN","ORATR",8,0)
 ; 2043      EN1^RAO7PC1
"RTN","ORATR",9,0)
 ; 2051      FIND^DIC   
"RTN","ORATR",10,0)
 ; 2056      $$GET1^DIQ
"RTN","ORATR",11,0)
 ; 2056      GETS^DIQ
"RTN","ORATR",12,0)
 ; 2263      ^XPAR
"RTN","ORATR",13,0)
 ; 3315      UPDATE^DIE
"RTN","ORATR",14,0)
 ;
"RTN","ORATR",15,0)
 ;=====================================================================
"RTN","ORATR",16,0)
 ;                 A B N O R M A L   A L E R T   R P C S
"RTN","ORATR",17,0)
 ;=====================================================================
"RTN","ORATR",18,0)
PROVIDER(ORRET,ORUSR) ; RPC - ORATR PROVIDER
"RTN","ORATR",19,0)
 ; ORRET - Return array, passed by reference
"RTN","ORATR",20,0)
 ; ORUSR - IEN of provider (FILE 200)
"RTN","ORATR",21,0)
 ;
"RTN","ORATR",22,0)
 K ORRET
"RTN","ORATR",23,0)
 N ORX S ORUSR=$G(ORUSR),ORX=$$PROV^ORATRPC
"RTN","ORATR",24,0)
 I 'ORX S ORRET=0
"RTN","ORATR",25,0)
 Q
"RTN","ORATR",26,0)
 ;
"RTN","ORATR",27,0)
PATIENT(ORRET,ORDFN) ; RPC - ORATR PATIENT
"RTN","ORATR",28,0)
 ; ORRET - Return array, passed by reference
"RTN","ORATR",29,0)
 ; ORDFN - IEN of patient (FILE 2)
"RTN","ORATR",30,0)
 ;
"RTN","ORATR",31,0)
 K ORRET
"RTN","ORATR",32,0)
 N ORX S ORDFN=$G(ORDFN),ORX=$$PAT^ORATRPC
"RTN","ORATR",33,0)
 I 'ORX S ORRET=0
"RTN","ORATR",34,0)
 Q
"RTN","ORATR",35,0)
 ;
"RTN","ORATR",36,0)
TYPE(ORRET,ORIEN) ; RPC - ORATR ALERT TYPE
"RTN","ORATR",37,0)
 ; ORRET - Return array, passed by reference
"RTN","ORATR",38,0)
 ; ORIEN - IEN of VFD TAR CONTROL file
"RTN","ORATR",39,0)
 ;
"RTN","ORATR",40,0)
 ; TFF - ADDED A NEW RPC
"RTN","ORATR",41,0)
 ;
"RTN","ORATR",42,0)
 ; NAME: ORATR ALERT TYPE                TAG: TYPE
"RTN","ORATR",43,0)
 ; ROUTINE: ORATR                        RETURN VALUE TYPE: SINGLE VALUE
"RTN","ORATR",44,0)
 ; AVAILABILITY: SUBSCRIPTION
"RTN","ORATR",45,0)
 ;
"RTN","ORATR",46,0)
 ; DESCRIPTION:   
"RTN","ORATR",47,0)
 ; This RPC allows SMART Alerts to use ComObjects by identifing if a TIU 
"RTN","ORATR",48,0)
 ; Template is either a Reminder Dialog or ComObject.
"RTN","ORATR",49,0)
 ;
"RTN","ORATR",50,0)
 ; INPUT PARAMETER: ORIEN                PARAMETER TYPE: LITERAL
"RTN","ORATR",51,0)
 ; REQUIRED: YES                         SEQUENCE NUMBER: 1
"RTN","ORATR",52,0)
 ; DESCRIPTION:   
"RTN","ORATR",53,0)
 ; This is the IEN of the VFD TAR CONTROL file entry associated with the 
"RTN","ORATR",54,0)
 ; current OR Notification used to trigger the SMART Alert.
"RTN","ORATR",55,0)
 ;
"RTN","ORATR",56,0)
 ; RETURN PARAMETER DESCRIPTION:   
"RTN","ORATR",57,0)
 ; Will return a R for Reminder Dialog, C for ComObject or a -1 if neither 
"RTN","ORATR",58,0)
 ; is defined. Furthermore, if both a Reminder Dialog and ComObject are 
"RTN","ORATR",59,0)
 ; defined then the Reminder Dialog will take priority.
"RTN","ORATR",60,0)
 ;
"RTN","ORATR",61,0)
 N ORTIU S ORTIU=$$GET1^DIQ(21695.5,ORIEN,.02,"I")
"RTN","ORATR",62,0)
 I $$GET1^DIQ(8927,ORTIU,.15)'="" S ORRET="R" Q
"RTN","ORATR",63,0)
 I $$GET1^DIQ(8927,ORTIU,.17)'="" S ORRET="C" Q
"RTN","ORATR",64,0)
 S ORRET=-1
"RTN","ORATR",65,0)
 Q
"RTN","ORATR",66,0)
 ;
"RTN","ORATR",67,0)
NOTE(ORRET,ORNOTE) ; RPC - ORATR GET NOTE
"RTN","ORATR",68,0)
 ; ORRET  - Return string
"RTN","ORATR",69,0)
 ; ORNOTE - IEN in the VFD ATR CONTROL file (21695.5)
"RTN","ORATR",70,0)
 K ORRET
"RTN","ORATR",71,0)
 N ORX S ORNOTE=$G(ORNOTE),ORX=$$NOTE^ORATRPC
"RTN","ORATR",72,0)
 I ORX=-1 S ORRET="-1^Error"
"RTN","ORATR",73,0)
 Q
"RTN","ORATR",74,0)
 ;
"RTN","ORATR",75,0)
PARAM(ORRET,ORVAL) ; RPC - ORATR SET FILTER PARAM
"RTN","ORATR",76,0)
 ;PARAM NAME = ORATR FILTER TAR
"RTN","ORATR",77,0)
 D EN^XPAR("USR","ORATR FILTER TAR",,ORVAL,.ORRET)
"RTN","ORATR",78,0)
 Q
"RTN","ORATR",79,0)
 ;
"RTN","ORATR",80,0)
TEMPLATE(ORRET,ORRDIEN) ; RPC - ORATR GET TIU TEMPLATE
"RTN","ORATR",81,0)
 ; ORRET   - Return string
"RTN","ORATR",82,0)
 ; ORRDIEN - IEN in the TIU TEMPLATE file (#8927) ;TFF
"RTN","ORATR",83,0)
 K ORRET
"RTN","ORATR",84,0)
 N ORX S ORRDIEN=$G(ORRDIEN),ORX=$$TEMPLATE^ORATRPC
"RTN","ORATR",85,0)
 I 'ORX S ORRET="-1^Error"
"RTN","ORATR",86,0)
 Q
"RTN","ORATR",87,0)
 ;
"RTN","ORATR",88,0)
PROCESS(ORRET,ORIEN,ORPRO) ; RPC - ORATR SET ATR PROCESSING LEVEL
"RTN","ORATR",89,0)
 ; ORRET - Return String
"RTN","ORATR",90,0)
 ; ORIEN - IEN in the VFD ALERT TRACKING file (#21695.2)
"RTN","ORATR",91,0)
 ; ORPRO - Internal form of PROCESSED field (#1.05)
"RTN","ORATR",92,0)
 ;
"RTN","ORATR",93,0)
 ; 0 - Not Processed
"RTN","ORATR",94,0)
 ; 1 - Partially Processed
"RTN","ORATR",95,0)
 ; 2 - Completed
"RTN","ORATR",96,0)
 ; 3 - Transmitted
"RTN","ORATR",97,0)
 ;
"RTN","ORATR",98,0)
 K ORRET
"RTN","ORATR",99,0)
 D FOLLOWUP^ORATR2(ORIEN)
"RTN","ORATR",100,0)
 S ORRET=$$PROCESS^ORATRPC(ORIEN,ORPRO)
"RTN","ORATR",101,0)
 Q
"RTN","ORATR",102,0)
 ;
"RTN","ORATR",103,0)
RESULTS(ORRET,ORDATA) ; RPC - ORATR GET TEST RESULTS
"RTN","ORATR",104,0)
 ; ORRET  - Return array, passed by reference
"RTN","ORATR",105,0)
 ; ORDATA - Input array
"RTN","ORATR",106,0)
 ;     passed by reference
"RTN","ORATR",107,0)
 ;     format:  ORDATA(sub) = code ^ value   where
"RTN","ORATR",108,0)
 ;         code = PAT for patient (#2)
"RTN","ORATR",109,0)
 ;                ATR for notification (#21695.2)
"RTN","ORATR",110,0)
 ;        value = for code PAT - patient DFN
"RTN","ORATR",111,0)
 ;                for code ATR - IEN in VFD ALERT TRACKING (#21695.2)
"RTN","ORATR",112,0)
 K ORRET
"RTN","ORATR",113,0)
 D RESULTS^ORATRDO
"RTN","ORATR",114,0)
 I '$D(ORRET) S ORRET(1)="Input is invalid"
"RTN","ORATR",115,0)
 Q
"RTN","ORATR",116,0)
 ;
"RTN","ORATR",117,0)
SETNOTE(ORRET,ORIEN,ORNOTE) ; RPC - ORATR SET TIU NOTE
"RTN","ORATR",118,0)
 ; ORRET  - Return string, passed by reference
"RTN","ORATR",119,0)
 ; ORIEN  - IEN in the VFD ALERT TRACKING file (#21695.2)
"RTN","ORATR",120,0)
 ; ORNOTE - Pointer to the TIU DOCUMENT file (#8925)
"RTN","ORATR",121,0)
 N ORFDA,ORERR K ORRET
"RTN","ORATR",122,0)
 S ORNOTE=$S(ORNOTE:"`"_ORNOTE,ORNOTE="@":"@",1:-1)
"RTN","ORATR",123,0)
 S ORFDA(21695.2,ORIEN_",",1.07)=ORNOTE
"RTN","ORATR",124,0)
 L +^VFD(21695.2,ORIEN):$S($G(DILOCKTM)>0:DILOCKTM,1:5)
"RTN","ORATR",125,0)
 D UPDATE^DIE("E","ORFDA",,"ORERR")
"RTN","ORATR",126,0)
 L -^VFD(21695.2,ORIEN):$S($G(DILOCKTM)>0:DILOCKTM,1:5)
"RTN","ORATR",127,0)
 S ORRET=$S('$D(ORERR):1,1:-1)
"RTN","ORATR",128,0)
 Q
"RTN","ORATR",129,0)
 ;
"RTN","ORATR",130,0)
BCCCR(ORRET) ; RPC - ORATR BCCCR TRANSMIT
"RTN","ORATR",131,0)
 ; ORRET - Return array, passed by reference
"RTN","ORATR",132,0)
 N ORIEN,ORFLAG
"RTN","ORATR",133,0)
 K ORRET S ORIEN="",ORFLAG=0
"RTN","ORATR",134,0)
 F  S ORIEN=$O(^VFD(21695.2,"APROC",2,ORIEN)) Q:'ORIEN  D  Q:ORFLAG
"RTN","ORATR",135,0)
 .N ORTYPE S ORTYPE=$$GET1^DIQ(21695.2,ORIEN,1.09,"I")
"RTN","ORATR",136,0)
 .;I $$GET1^DIQ(21695.5,+ORTYPE,.01)'["BCCCR" D PROCESS^ORATRPC(ORIEN,3) Q
"RTN","ORATR",137,0)
 .I '$$GET1^DIQ(21695.5,ORTYPE,.06,"I") D PROCESS^ORATRPC(ORIEN,3) Q
"RTN","ORATR",138,0)
 .S ORFLAG=1
"RTN","ORATR",139,0)
 I ORIEN="" S ORRET(1)="-1^Error" Q
"RTN","ORATR",140,0)
 D BCCCR^ORATRPC(ORIEN)
"RTN","ORATR",141,0)
 I '$D(ORRET) S ORRET(1)="-1^Error"
"RTN","ORATR",142,0)
 Q
"RTN","ORATR",143,0)
 ;
"RTN","ORATR",144,0)
GETHF(ORRET,ORIEN,ORHF) ;
"RTN","ORATR",145,0)
 ; HEALTH FACTORS       ^AUTTHF(
"RTN","ORATR",146,0)
 ; V HEALTH FACTOR      ^AUPNVHF(
"RTN","ORATR",147,0)
 N X,Y,Z,ORERR S ORIEN=+$G(ORIEN)
"RTN","ORATR",148,0)
 N ZTIO,ZTRTN,ZTDTH,ZTSAVE,ZTDESC,ZTSYNC,ZTSK
"RTN","ORATR",149,0)
 S ZTRTN="GETHF^ORATRPC",ZTDTH=$H,$P(ZTDTH,",",2)=100+$P(ZTDTH,",",2)
"RTN","ORATR",150,0)
 S ZTDESC="Track Health Factors for SMART Notifications"
"RTN","ORATR",151,0)
 M ^TMP("ORATRHF",$$NOW^XLFDT,ORIEN)=ORHF
"RTN","ORATR",152,0)
 D ^%ZTLOAD I '$D(ZTSK) D GETHF^ORATRPC
"RTN","ORATR",153,0)
 S ORRET=1
"RTN","ORATR",154,0)
 Q 
"RTN","ORATR",155,0)
 ;
"RTN","ORATR",156,0)
 ;=====================================================================
"RTN","ORATR",157,0)
 ;                            U T I L I T E S
"RTN","ORATR",158,0)
 ;=====================================================================
"RTN","ORATR",159,0)
TRANSFER(ORATIEN) ;Transfer data from Alert Tracking to VFD Alert Tracking
"RTN","ORATR",160,0)
 ;asf 7/14/12
"RTN","ORATR",161,0)
 ;ORATIEN- IEN of file 8992.1
"RTN","ORATR",162,0)
 N X,%X,%Y,DA,DIK,ORATRFDA,ORDATA,ORFLAG,ORLOC,ORNOT,VFDNEWIEN,ORERR
"RTN","ORATR",163,0)
 S ORATIEN=+ORATIEN ;remove trailing comma asf 7/17
"RTN","ORATR",164,0)
 I '$D(^XTV(8992.1,ORATIEN)) Q -1  ;out--> bad ien
"RTN","ORATR",165,0)
 S ORDATA=$$GETIEN($$GET1^DIQ(8992.1,ORATIEN,.01,,,"ORERR"))
"RTN","ORATR",166,0)
 S VFDNEWIEN(1)=$P(ORDATA,U) I VFDNEWIEN(1)'>0 Q -1  ;Entry not made out-->
"RTN","ORATR",167,0)
 L +^VFD(21695.2,VFDNEWIEN(1)):$S($G(DILOCKTM)>0:DILOCKTM,1:5)
"RTN","ORATR",168,0)
 D SETUP(VFDNEWIEN(1),'$G(ORFLAG))
"RTN","ORATR",169,0)
 L -^VFD(21695.2,VFDNEWIEN(1)):$S($G(DILOCKTM)>0:DILOCKTM,1:5)
"RTN","ORATR",170,0)
 Q VFDNEWIEN(1)
"RTN","ORATR",171,0)
 ;
"RTN","ORATR",172,0)
GETIEN(ORNM) ;
"RTN","ORATR",173,0)
 ; ORNM is the .01 field in 8992.1
"RTN","ORATR",174,0)
 N ORATRFDA,ORERR,ORIEN,NEWIEN
"RTN","ORATR",175,0)
 S ORNM=$$TRNSFRM(ORNM) Q:ORNM="" -1
"RTN","ORATR",176,0)
 ; check inactive
"RTN","ORATR",177,0)
 Q:$$GET1^DIQ(21695.5,$P(ORNM,";",5),.04,"I") -1
"RTN","ORATR",178,0)
 S ORIEN=$$FIND1^DIC(21695.2,,"X",ORNM,,,"ORERR")
"RTN","ORATR",179,0)
 I ORIEN S ORFLAG=1 Q ORIEN_U_ORNM
"RTN","ORATR",180,0)
 S ORATRFDA(21695.2,"+1,",.01)=ORNM
"RTN","ORATR",181,0)
 D UPDATE^DIE("U","ORATRFDA","NEWIEN")
"RTN","ORATR",182,0)
 Q NEWIEN(1)_U_ORNM
"RTN","ORATR",183,0)
 ;
"RTN","ORATR",184,0)
TRNSFRM(ORNM) ; Transform the .01 field for an ATR notification
"RTN","ORATR",185,0)
 ;TFF - REMOVED THE DUPLICATE N OR ORFLAG
"RTN","ORATR",186,0)
 N ORX,ORDATA,ORDER,ORERR,ORFLAG,ORID,ORI,ORY,ORPAT,ORNOT
"RTN","ORATR",187,0)
 Q:$E(ORNM,1,2)'="OR" ""
"RTN","ORATR",188,0)
 S ORPAT=$$GET1^DIQ(8992.1,ORATIEN,.04,"I",,"ORERR")
"RTN","ORATR",189,0)
 S ORX=$P($P(ORNM,";"),",",3) Q:'ORX ""
"RTN","ORATR",190,0)
 Q:'$D(^VFD(21695.5,"AB",ORX)) ""  S ORNOT=ORX
"RTN","ORATR",191,0)
 S ORDATA=$$GET1^DIQ(8992.1,ORATIEN,2)
"RTN","ORATR",192,0)
 I ORDATA["@OR"&($D(^OR(100,+ORDATA))) S ORDER=+ORDATA_","
"RTN","ORATR",193,0)
 ;TFF - ADDED THE SET CONDITION FOR THE NEXT TWO LINES
"RTN","ORATR",194,0)
 E  S:$G(ORDATA)'="" ORDER=$$GETORDER(ORPAT,ORDATA)
"RTN","ORATR",195,0)
 D:$D(ORDER) GETS^DIQ(100,ORDER,".1*","I","ORDER","ORERR")
"RTN","ORATR",196,0)
 S ORX="ORDER" F  S ORX=$Q(@ORX) Q:ORX=""  D  Q:$D(ORID)
"RTN","ORATR",197,0)
 .;TFF - REBUILT THE C X-REF ^VFD(21695.5,"C",3028,1,2)="" TO
"RTN","ORATR",198,0)
 .; ^VFD(21695.5,"C",ORNOT,3028,1,2)="" WHERE ORNOT = OR NOTIFICATION
"RTN","ORATR",199,0)
 .; IF DIFFERENT OR NOTIFICATIONS CAN HAVE THE SAME ORDERS THEN LOOKING UP ON
"RTN","ORATR",200,0)
 .; ORDER ID ALONE WILL CAUSE TO ORID TO BE SET INCORRECTLY
"RTN","ORATR",201,0)
 .;
"RTN","ORATR",202,0)
 .I $D(^VFD(21695.5,"C",ORNOT,@ORX)) S ORID=$O(^(@ORX,""))
"RTN","ORATR",203,0)
 .I $D(ORID) S ORLOC=$$GET1^DIQ(100,+ORDER_",",6,"I",,"ORERR")
"RTN","ORATR",204,0)
 .;TFF - ADDED ORNOT TO $$LABTEST
"RTN","ORATR",205,0)
 .;TFF - WHY FIND ORID FROM AN ORDERABLE ITEM?
"RTN","ORATR",206,0)
 .I '$D(ORID) S ORID=$$LABTEST(ORATIEN,ORDATA,ORNOT)
"RTN","ORATR",207,0)
 ;TFF - ADDED $G TO ORID
"RTN","ORATR",208,0)
 ;Q:$G(ORID)="" "" ;COMMENTED THIS LINE OUT - SEE BELOW
"RTN","ORATR",209,0)
 ;TFF - IF THE ALERT IS CREATED WITH AN OR NOTIFICATION THAT'S IN THE CONTROL FILE
"RTN","ORATR",210,0)
 ; WITH AN ORDERABLE ITEM THAT IS NOT OR IS SET TO A DIFFERENT CONTROL TYPE THEN
"RTN","ORATR",211,0)
 ; THE WRONG IEN WILL BE SET TO PIECE 5 (ORID)
"RTN","ORATR",212,0)
 ;TFF - CHANGED THE FIFTH PIECE OF ORNM FROM ORID TO 
"RTN","ORATR",213,0)
 ;
"RTN","ORATR",214,0)
 ; XQAID=p1;p2..;p5;p6 where p1, p2,...p8 are:
"RTN","ORATR",215,0)
 ;     p1  := ATR , PATIENT , NOTIFICATION ID (pointer to 100.9)
"RTN","ORATR",216,0)
 ;     p2  := 10000 (constant)
"RTN","ORATR",217,0)
 ;     p3  := PATIENT
"RTN","ORATR",218,0)
 ;     p4  := date/time notification was sent
"RTN","ORATR",219,0)
 ;     p5  := type of ATR (pointer to VFD ATR CONTROL file #21695.5) - was incorrectly being set
"RTN","ORATR",220,0)
 ;     p6  := date/time of original order
"RTN","ORATR",221,0)
 ;     p7  := IEN in VFD ALERT TRACKING file (#21695.2)
"RTN","ORATR",222,0)
 ;     p8  := IEN of the associated TIU Note
"RTN","ORATR",223,0)
 ;
"RTN","ORATR",224,0)
 S ORNM="ATR,"_ORPAT_","_ORNOT_";10000;"_ORPAT_";"_$P(ORNM,";",3)_";"_$O(^VFD(21695.5,"AB",ORNOT,""))
"RTN","ORATR",225,0)
 S ORNM=ORNM_";"_$$GET1^DIQ(100,$G(ORDER),4,"I")
"RTN","ORATR",226,0)
 Q ORNM
"RTN","ORATR",227,0)
 ;
"RTN","ORATR",228,0)
GETORDER(ORPAT,ORDATA) ;
"RTN","ORATR",229,0)
 N ORX,ORY,ORIEN,TODAY
"RTN","ORATR",230,0)
 S TODAY=$$DT^XLFDT,ORDATA=$TR(ORDATA,"~","-")
"RTN","ORATR",231,0)
 K ^TMP($J,"RAE1")
"RTN","ORATR",232,0)
 D EN1^RAO7PC1(ORPAT,$$FMADD^XLFDT(TODAY,-60),TODAY,10)
"RTN","ORATR",233,0)
 Q:'$D(^TMP($J,"RAE1",ORPAT,ORDATA)) -1  S ORIEN=$P(^(ORDATA),U,11)
"RTN","ORATR",234,0)
 S ORIEN=ORIEN_"," K ^TMP($J,"RAE1")
"RTN","ORATR",235,0)
 Q ORIEN
"RTN","ORATR",236,0)
 ;
"RTN","ORATR",237,0)
LABTEST(ORATIEN,ORDATA,ORNOT) ;
"RTN","ORATR",238,0)
 ; TFF - ADDED ORNOT AS THE THIRD PARAMETER
"RTN","ORATR",239,0)
 N ORDT,ORSN,TEMP,OR,ORRET,LBTST S ORRET=""
"RTN","ORATR",240,0)
 I ORDATA'["|" Q ORRET
"RTN","ORATR",241,0)
 S ORDT=$P(ORDATA,";",2),ORSN=$P(ORDATA,";",3)
"RTN","ORATR",242,0)
 I 'ORDT!('ORSN) Q ORRET
"RTN","ORATR",243,0)
 K ^TMP("LRX",$J)
"RTN","ORATR",244,0)
 D 69^LR7OB69(ORDT,ORSN)
"RTN","ORATR",245,0)
 ;TFF - X-REF CHANGE FROM ^VFD(21695.5,"D",(LAB TEST)
"RTN","ORATR",246,0)
 ; (ORNOT = OR NOTIFICATION) TO ^VFD(21695.5,"D",ORNOT,(LAB TEST)
"RTN","ORATR",247,0)
 S TEMP=$NA(^TMP("LRX",$J,69)),OR=0
"RTN","ORATR",248,0)
 F  S OR=$O(@TEMP@(OR)) Q:'OR  S LBTST=+@TEMP@(OR) D  Q:ORRET
"RTN","ORATR",249,0)
 .Q:'$D(^VFD(21695.5,"D",ORNOT,LBTST))
"RTN","ORATR",250,0)
 .N RESULT,NODE S NODE=$O(@TEMP@(OR,63,"")) Q:NODE=""
"RTN","ORATR",251,0)
 .S RESULT=$P($G(@TEMP@(OR,63,NODE)),U,2) Q:RESULT=""
"RTN","ORATR",252,0)
 .I $$GET1^DIQ(8992.1,ORATIEN,1.01)[RESULT D
"RTN","ORATR",253,0)
 ..Q:'$D(^VFD(21695.5,"D",ORNOT,LBTST))
"RTN","ORATR",254,0)
 ..S ORRET=$O(^VFD(21695.5,"D",ORNOT,LBTST,""))
"RTN","ORATR",255,0)
 K ^TMP("LRX",$J)
"RTN","ORATR",256,0)
 Q ORRET
"RTN","ORATR",257,0)
 ;
"RTN","ORATR",258,0)
SETUP(ORIEN,ORNEW) ; Add data to the new entry in 21695.2
"RTN","ORATR",259,0)
 N ORCNT,ORDA,ORDATA,ORERR,ORFDA,ORNA,ORTEMP,ORX,ORGUID,ORIPT
"RTN","ORATR",260,0)
 S ORNA=$NA(ORFDA(21695.2,ORIEN_",")),ORCNT=1
"RTN","ORATR",261,0)
 I ORNEW D SETUP1(ORIEN)
"RTN","ORATR",262,0)
 D GETS^DIQ(8992.1,ORATIEN_",","20*","I","ORDATA","ORERR")
"RTN","ORATR",263,0)
 ; Update 21695.21 Multiple
"RTN","ORATR",264,0)
 S ORX="" F  S ORX=$O(ORDATA(8992.11,ORX)) Q:'ORX  D
"RTN","ORATR",265,0)
 .S ORDA=$$FIND1^DIC(21695.21,","_ORIEN_",","Q",ORDATA(8992.11,ORX,.01,"I"))
"RTN","ORATR",266,0)
 .S:'ORDA ORDA="+"_ORCNT,ORCNT=ORCNT+1
"RTN","ORATR",267,0)
 .D SETUP2(21695.21,8992.11,ORDA_","_ORIEN_",",ORX)
"RTN","ORATR",268,0)
 .S ORTEMP(+ORX)=ORDA
"RTN","ORATR",269,0)
 ; Update 21695.211 Multiple
"RTN","ORATR",270,0)
 S ORX="" F  S ORX=$O(ORDATA(8992.111,ORX)) Q:'ORX  D
"RTN","ORATR",271,0)
 .S ORDA=ORTEMP($P(ORX,",",2))
"RTN","ORATR",272,0)
 .I $E(ORDA,1)="+" S ORDA="+"_ORCNT_","_ORDA_","_ORIEN_",",ORCNT=ORCNT+1
"RTN","ORATR",273,0)
 .E  D
"RTN","ORATR",274,0)
 ..S ORDA(1)=$$FIND1^DIC(21695.211,","_ORDA_","_ORIEN_",","Q",ORDATA(8992.111,ORX,.01,"I"))
"RTN","ORATR",275,0)
 ..S:ORDA(1) ORDA=ORDA(1)_","_ORDA_","_ORIEN_","
"RTN","ORATR",276,0)
 ..S:'ORDA(1) ORDA="+"_ORCNT_","_ORDA_","_ORIEN_",",ORCNT=ORCNT+1
"RTN","ORATR",277,0)
 .D SETUP2(21695.211,8992.111,ORDA,ORX)
"RTN","ORATR",278,0)
 ; Update 21695.212 Multiple
"RTN","ORATR",279,0)
 S ORX="" F  S ORX=$O(ORDATA(8992.112,ORX)) Q:'ORX  D
"RTN","ORATR",280,0)
 .S ORDA=ORTEMP($P(ORX,",",2))
"RTN","ORATR",281,0)
 .I $E(ORDA,1)="+" S ORDA="+"_ORCNT_","_ORDA_","_ORIEN_",",ORCNT=ORCNT+1
"RTN","ORATR",282,0)
 .E  D
"RTN","ORATR",283,0)
 ..S ORDA(1)=$$FIND1^DIC(21695.212,","_ORDA_","_ORIEN_",","Q",ORDATA(8992.112,ORX,.01,"I"))
"RTN","ORATR",284,0)
 ..S:ORDA(1) ORDA=ORDA(1)_","_ORDA_","_ORIEN_","
"RTN","ORATR",285,0)
 ..S:'ORDA(1) ORDA="+"_ORCNT_","_ORDA_","_ORIEN_",",ORCNT=ORCNT+1
"RTN","ORATR",286,0)
 .D SETUP2(21695.212,8992.112,ORDA,ORX)
"RTN","ORATR",287,0)
 D UPDATE^DIE(,"ORFDA",,"ORERR")
"RTN","ORATR",288,0)
 Q
"RTN","ORATR",289,0)
 ;
"RTN","ORATR",290,0)
SETUP1(ORIEN) ; Set top level data
"RTN","ORATR",291,0)
 ; ORIEN - IEN in 21695.2
"RTN","ORATR",292,0)
 N ORDT,ORDUZ,ORERR,ORFDA,ORNA,ORDATA
"RTN","ORATR",293,0)
 D GETS^DIQ(8992.1,ORATIEN_",","*","I","ORDATA","ORERR")
"RTN","ORATR",294,0)
 S ORNA=$NA(ORFDA(21695.2,ORIEN_","))
"RTN","ORATR",295,0)
 S ORX=.01 F  S ORX=$O(ORDATA(8992.1,ORATIEN_",",ORX)) Q:'ORX  D
"RTN","ORATR",296,0)
 .Q:ORX=.08  S @ORNA@(ORX)=ORDATA(8992.1,ORATIEN_",",ORX,"I")
"RTN","ORATR",297,0)
 S ORDUZ=$$GET1^DIQ(8992.11,"1,"_ORATIEN_",",.01,"I",,"ORERR")
"RTN","ORATR",298,0)
 S ORDT=@ORNA@(.02)
"RTN","ORATR",299,0)
 S @ORNA@(.09)=ORATIEN
"RTN","ORATR",300,0)
 S:$G(ORNOT)'="" @ORNA@(.1)=ORNOT
"RTN","ORATR",301,0)
 I ORDUZ,ORDT D
"RTN","ORATR",302,0)
 .S @ORNA@(.11)=$$GET1^DIQ(8992.01,ORDT_","_ORDUZ,.1,"I",,"ORERR")
"RTN","ORATR",303,0)
 S:$G(ORLOC)'="" @ORNA@(.12)=ORLOC
"RTN","ORATR",304,0)
 S @ORNA@(1.05)=0
"RTN","ORATR",305,0)
 S @ORNA@(1.09)=$P($$GET1^DIQ(21695.2,ORIEN,.01),";",5)
"RTN","ORATR",306,0)
 D UPDATE^DIE(,"ORFDA",,"ORERR")
"RTN","ORATR",307,0)
 Q
"RTN","ORATR",308,0)
 ;
"RTN","ORATR",309,0)
SETUP2(ORNEW,OROLD,ORIENS,ORX) ;
"RTN","ORATR",310,0)
 N ORNA,ORY
"RTN","ORATR",311,0)
 S ORNA=$NA(ORFDA(ORNEW,ORIENS))
"RTN","ORATR",312,0)
 S ORY=0 F  S ORY=$O(ORDATA(OROLD,ORX,ORY)) Q:'ORY  D
"RTN","ORATR",313,0)
 .S @ORNA@(ORY)=ORDATA(OROLD,ORX,ORY,"I")
"RTN","ORATR",314,0)
 Q
"RTN","ORATR2")
0^5^B119831724
"RTN","ORATR2",1,0)
ORATR2 ; DSS/SMP/ASF - Abnormal Alert Utilities ; NOV 08, 2012
"RTN","ORATR2",2,0)
 ;;1.0;VENDOR - DOCUMENT STORAGE SYSTEMS;;7/17/2012;Build 3
"RTN","ORATR2",3,0)
 ;;;
"RTN","ORATR2",4,0)
 Q
"RTN","ORATR2",5,0)
 ;
"RTN","ORATR2",6,0)
 ; Documented API and ICRs
"RTN","ORATR2",7,0)
 ; -----------------------
"RTN","ORATR2",8,0)
 ; 1252      ^SDUTL3
"RTN","ORATR2",9,0)
 ; 2043      EN1^RAO7PC1
"RTN","ORATR2",10,0)
 ; 2051      FIND^DIC
"RTN","ORATR2",11,0)
 ; 2056      $$GET1^DIQ
"RTN","ORATR2",12,0)
 ; 2056      GETS^DIQ
"RTN","ORATR2",13,0)
 ; 2182      MAIN^PXRM
"RTN","ORATR2",14,0)
 ; 2263      ^XPAR
"RTN","ORATR2",15,0)
 ; 3315      UPDATE^DIE
"RTN","ORATR2",16,0)
 ; 10081     ^XQALERT    ACTION^XQALERT
"RTN","ORATR2",17,0)
 ; 10013     ^DIK
"RTN","ORATR2",18,0)
 ; 10103     ^XLFDT 
"RTN","ORATR2",19,0)
 ;
"RTN","ORATR2",20,0)
 ;=====================================================================
"RTN","ORATR2",21,0)
 ;         M A M M O G R A M   F O L L O W - U P   A L E R T S
"RTN","ORATR2",22,0)
 ;=====================================================================
"RTN","ORATR2",23,0)
1 ; Scheduled task that sends TAR alerts based on Clinical Reminders
"RTN","ORATR2",24,0)
 ;  Can be scheduled to run multiple times a day
"RTN","ORATR2",25,0)
 N DFN,ORNOT,PXRM,TYPE,ORIEN
"RTN","ORATR2",26,0)
 D PROCESS
"RTN","ORATR2",27,0)
 ;TFF - X-REF CHANGE FROM ^VFD(21695.5,"CR",(CLINICAL REMINDER)
"RTN","ORATR2",28,0)
 ; (ORNOT = OR NOTIFICATION) TO ^VFD(21695.5,"CR",ORNOT,(CLINICAL REMINDER)
"RTN","ORATR2",29,0)
 S ORNOT="" F  S ORNOT=$O(^VFD(21695.5,"AB",ORNOT)) Q:'ORNOT  D
"RTN","ORATR2",30,0)
 .S PXRM="" F  S PXRM=$O(^VFD(21695.5,"CR",ORNOT,PXRM)) Q:'PXRM  D
"RTN","ORATR2",31,0)
 ..S TYPE=$O(^VFD(21695.5,"CR",ORNOT,PXRM,""))
"RTN","ORATR2",32,0)
 ..Q:$$GET1^DIQ(21695.5,TYPE,.04,"I")
"RTN","ORATR2",33,0)
 ..D CHECKHF(PXRM,TYPE)
"RTN","ORATR2",34,0)
 Q
"RTN","ORATR2",35,0)
 ;
"RTN","ORATR2",36,0)
2 ; Scheduled task that runs once a day
"RTN","ORATR2",37,0)
 N DFN,ORNOT,PXRM,TYPE
"RTN","ORATR2",38,0)
 D PROCESS
"RTN","ORATR2",39,0)
 ;TFF - X-REF CHANGE FROM ^VFD(21695.5,"CR",(CLINICAL REMINDER)
"RTN","ORATR2",40,0)
 ; (ORNOT = OR NOTIFICATION) TO ^VFD(21695.5,"CR",ORNOT,(CLINICAL REMINDER)
"RTN","ORATR2",41,0)
 S ORNOT="" F  S ORNOT=$O(^VFD(21695.5,"AB",ORNOT)) Q:'ORNOT  D
"RTN","ORATR2",42,0)
 .S PXRM="" F  S PXRM=$O(^VFD(21695.5,"CR",ORNOT,PXRM)) Q:'PXRM  D
"RTN","ORATR2",43,0)
 ..S TYPE=$O(^VFD(21695.5,"CR",ORNOT,PXRM,""))
"RTN","ORATR2",44,0)
 ..Q:$$GET1^DIQ(21695.5,TYPE,.04,"I")
"RTN","ORATR2",45,0)
 ..S DFN=0 F  S DFN=$O(^DPT(DFN)) Q:'DFN  D
"RTN","ORATR2",46,0)
 ...Q:$$GET1^DIQ(2,DFN,.351,"I")
"RTN","ORATR2",47,0)
 ...K ^TMP("PXRHM",$J) D MAIN^PXRM(DFN,PXRM,0)
"RTN","ORATR2",48,0)
 ...I $D(^TMP("PXRHM",$J)) D SETUP(DFN,TYPE)
"RTN","ORATR2",49,0)
 K ^TMP("PXRHM",$J)
"RTN","ORATR2",50,0)
 Q
"RTN","ORATR2",51,0)
 ;
"RTN","ORATR2",52,0)
PROCESS ; Check current notificaitons
"RTN","ORATR2",53,0)
 N ORIEN
"RTN","ORATR2",54,0)
 S ORIEN=0 F  S ORIEN=$O(^VFD(21695.2,ORIEN)) Q:'ORIEN  D
"RTN","ORATR2",55,0)
 .D CLEANHF(ORIEN)
"RTN","ORATR2",56,0)
 .N ORPROC S ORPROC=$$GET1^DIQ(21695.2,ORIEN,1.05,"I")
"RTN","ORATR2",57,0)
 .I ORPROC=0 D CHECKDUE(ORIEN)
"RTN","ORATR2",58,0)
 .I ORPROC=1 D FOLLOWUP(ORIEN)
"RTN","ORATR2",59,0)
 .I ORPROC=3 D PURGE(ORIEN)
"RTN","ORATR2",60,0)
 Q
"RTN","ORATR2",61,0)
 ;
"RTN","ORATR2",62,0)
CHECKDUE(ORIEN) ;
"RTN","ORATR2",63,0)
 N ORDT,TODAY S TODAY=$$DT^XLFDT
"RTN","ORATR2",64,0)
 Q:$$GET1^DIQ(21695.2,ORIEN,1.05,"I")'=0
"RTN","ORATR2",65,0)
 S ORDT=$$GET1^DIQ(21695.2,ORIEN,.02,"I")
"RTN","ORATR2",66,0)
 I ORDT<$$FMADD^XLFDT(TODAY,$$GETDAYS) D SENDUP(ORIEN)
"RTN","ORATR2",67,0)
 Q
"RTN","ORATR2",68,0)
 ;
"RTN","ORATR2",69,0)
CHECKHF(PXRM,TYPE) ; 
"RTN","ORATR2",70,0)
 N DFN,HF,HFIEN,PATS
"RTN","ORATR2",71,0)
 ;^PXRMINDX(9000010.23,"IP",HF,DFN)
"RTN","ORATR2",72,0)
 D CHECKHF1
"RTN","ORATR2",73,0)
 S HFIEN="" F  S HFIEN=$O(HF(HFIEN)) Q:'HFIEN  D
"RTN","ORATR2",74,0)
 .S DFN="" F  S DFN=$O(^PXRMINDX(9000010.23,"IP",HFIEN,DFN)) Q:'DFN  D
"RTN","ORATR2",75,0)
 ..S PATS(DFN)=""
"RTN","ORATR2",76,0)
 S DFN=0 F  S DFN=$O(PATS(DFN)) Q:'DFN  D
"RTN","ORATR2",77,0)
 .K ^TMP("PXRHM",$J) D MAIN^PXRM(DFN,PXRM,0)
"RTN","ORATR2",78,0)
 .I $D(^TMP("PXRHM",$J)) D SETUP(DFN,TYPE)
"RTN","ORATR2",79,0)
 K ^TMP("PXRHM",$J)
"RTN","ORATR2",80,0)
 Q
"RTN","ORATR2",81,0)
 ;
"RTN","ORATR2",82,0)
CHECKHF1 ;
"RTN","ORATR2",83,0)
 N REM,TERM,DATA,ORDATA,ORX,ORY
"RTN","ORATR2",84,0)
 D GETS^DIQ(811.9,PXRM_",","20*","I","DATA")
"RTN","ORATR2",85,0)
 S ORX="" F  S ORX=$O(DATA(811.902,ORX)) Q:'ORX  D
"RTN","ORATR2",86,0)
 .S TERM=$G(DATA(811.902,ORX,.01,"I"))
"RTN","ORATR2",87,0)
 .I TERM["AUTTHF(" S HF(+TERM)="" Q
"RTN","ORATR2",88,0)
 .I TERM["PXRMD(811.5" D
"RTN","ORATR2",89,0)
 ..K ORDATA D GETS^DIQ(811.5,+TERM_",","20*","I","ORDATA")
"RTN","ORATR2",90,0)
 ..S ORY="" F  S ORY=$O(ORDATA(811.52,ORY)) Q:'ORY  D
"RTN","ORATR2",91,0)
 ...S TERM=$G(ORDATA(811.52,ORY,.01,"I"))
"RTN","ORATR2",92,0)
 ...I TERM["AUTTHF(" S HF(+TERM)="" Q
"RTN","ORATR2",93,0)
 Q
"RTN","ORATR2",94,0)
 ;
"RTN","ORATR2",95,0)
CHKSENT() ;
"RTN","ORATR2",96,0)
 N IEN,SENT S SENT=0
"RTN","ORATR2",97,0)
 S IEN=0 F  S IEN=$O(^VFD(21695.2,"C",PAT,IEN)) Q:'IEN  D  Q:SENT
"RTN","ORATR2",98,0)
 .S PROV=0 F  S PROV=$O(RECIP(PROV)) Q:'PROV  D
"RTN","ORATR2",99,0)
 ..Q:'$D(^VFD(21695.2,"R",PROV,IEN))
"RTN","ORATR2",100,0)
 ..I $P($$GET1^DIQ(21695.2,IEN,.01),";",5)'=TYPE Q
"RTN","ORATR2",101,0)
 ..S SENT=IEN_U_$$GET1^DIQ(21695.2,IEN,.02,"I")
"RTN","ORATR2",102,0)
 Q SENT
"RTN","ORATR2",103,0)
 ;
"RTN","ORATR2",104,0)
CLEANHF(TARIEN) ; Clean up Health Factor multiple
"RTN","ORATR2",105,0)
 N ORDATA,ORX,ORERR,ORFDA,NEWHF,ORY,VST,VHF
"RTN","ORATR2",106,0)
 D GETS^DIQ(21695.2,TARIEN_",","6*","I","ORDATA","ORERR")
"RTN","ORATR2",107,0)
 S ORX="" F  S ORX=$O(ORDATA(21695.26,ORX)) Q:'ORX  D
"RTN","ORATR2",108,0)
 .S VHF=$G(ORDATA(21695.26,ORX,.01,"I"))
"RTN","ORATR2",109,0)
 .I $D(^AUPNVHF(VHF)) S VST=$$GET1^DIQ(9000010.23,VHF,.03,"I")  D
"RTN","ORATR2",110,0)
 ..S ORY=0 F  S ORY=$O(^AUPNVHF("AD",VST,ORY)) Q:'ORY  D
"RTN","ORATR2",111,0)
 ...I '$D(^VFD(21695.2,TARIEN,6,"B",ORY)) S NEWHF(ORY)=""
"RTN","ORATR2",112,0)
 .I '$D(^AUPNVHF(VHF)) D CLEANHF1(ORX)
"RTN","ORATR2",113,0)
 Q:'$D(NEWHF)
"RTN","ORATR2",114,0)
 S ORX="" F ORY=1:1 S ORX=$O(NEWHF(ORX)) Q:'ORX  D
"RTN","ORATR2",115,0)
 .S ORFDA(21695.26,"+"_ORY_","_TARIEN_",",.01)=ORX
"RTN","ORATR2",116,0)
 L +^VFD(21695.2,TARIEN):$S($G(DILOCKTM)>0:DILOCKTM,1:5)
"RTN","ORATR2",117,0)
 D UPDATE^DIE(,"ORFDA",,"ORERR")
"RTN","ORATR2",118,0)
 L -^VFD(21695.2,TARIEN):$S($G(DILOCKTM)>0:DILOCKTM,1:5)
"RTN","ORATR2",119,0)
 Q
"RTN","ORATR2",120,0)
 ;
"RTN","ORATR2",121,0)
CLEANHF1(IENS) ;
"RTN","ORATR2",122,0)
 N ORFDA,ORERR Q:'IENS
"RTN","ORATR2",123,0)
 S ORFDA(21695.26,IENS,.04)=1
"RTN","ORATR2",124,0)
 L +^VFD(21695.2,TARIEN):$S($G(DILOCKTM)>0:DILOCKTM,1:5)
"RTN","ORATR2",125,0)
 D UPDATE^DIE(,"ORFDA",,"ORERR")
"RTN","ORATR2",126,0)
 L -^VFD(21695.2,TARIEN):$S($G(DILOCKTM)>0:DILOCKTM,1:5)
"RTN","ORATR2",127,0)
 Q
"RTN","ORATR2",128,0)
 ;
"RTN","ORATR2",129,0)
FOLLOWUP(TARIEN) ; Get follow-up orders based on health factors
"RTN","ORATR2",130,0)
 N CNT,DATE,HF,HFNM,NA,ORERR,ORFDA,ORIEN,PAT,VST
"RTN","ORATR2",131,0)
 S CNT=1,TARIEN=+$G(TARIEN)
"RTN","ORATR2",132,0)
 Q:'TARIEN!($$GET1^DIQ(21695.2,TARIEN,1.05,"I",,"ORERR")'=1)
"RTN","ORATR2",133,0)
 S PAT=$$GET1^DIQ(21695.2,TARIEN,.04,"I") Q:'PAT
"RTN","ORATR2",134,0)
 S HF="" F  S HF=$O(^VFD(21695.2,TARIEN,6,"B",HF)) Q:'HF  D
"RTN","ORATR2",135,0)
 .S HFNM=$$GET1^DIQ(9000010.23,HF,.01) Q:HFNM["PT CONTACT"
"RTN","ORATR2",136,0)
 .S VST=$$GET1^DIQ(9000010,$$GET1^DIQ(9000010.23,HF,.03,"I"),.01,"I")
"RTN","ORATR2",137,0)
 .S:VST DATE(VST)=""
"RTN","ORATR2",138,0)
 Q:'$D(DATE)
"RTN","ORATR2",139,0)
 S DATE=9999999-$P($O(DATE("")),"."),NA=$NA(^OR(100,"ACT",PAT_";DPT("))
"RTN","ORATR2",140,0)
 F  S NA=$Q(@NA) Q:$QS(NA,3)'[PAT!($QS(NA,4)>DATE)  D
"RTN","ORATR2",141,0)
 .S ORIEN=$QS(NA,6),ORIEN(1)=$QS(NA,7)
"RTN","ORATR2",142,0)
 .Q:$$GET1^DIQ(100.008,ORIEN(1)_","_ORIEN_",",2)'="NEW"
"RTN","ORATR2",143,0)
 .Q:$D(^VFD(21695.2,TARIEN,5,"B",ORIEN))
"RTN","ORATR2",144,0)
 .S ORFDA(21695.25,"+"_CNT_","_TARIEN_",",.01)=ORIEN,CNT=CNT+1
"RTN","ORATR2",145,0)
 I $D(ORFDA) D
"RTN","ORATR2",146,0)
 .L +^VFD(21695.2,TARIEN):$S($G(DILOCKTM)>0:DILOCKTM,1:5)
"RTN","ORATR2",147,0)
 .D UPDATE^DIE("U","ORFDA",,"ORERR")
"RTN","ORATR2",148,0)
 .L -^VFD(21695.2,TARIEN):$S($G(DILOCKTM)>0:DILOCKTM,1:5)
"RTN","ORATR2",149,0)
 Q
"RTN","ORATR2",150,0)
 ;
"RTN","ORATR2",151,0)
GETDATE(DFN,PXRM) ; 
"RTN","ORATR2",152,0)
 N X,DATE,FIND,SORT,RET S RET=0
"RTN","ORATR2",153,0)
 D FIDATA^PXRM(DFN,PXRM,.FIND)
"RTN","ORATR2",154,0)
 S X=0 F  S X=$O(FIND(X)) Q:'X  D
"RTN","ORATR2",155,0)
 .Q:$G(FIND(X,"TERM"))'["ORDER"
"RTN","ORATR2",156,0)
 .S DATE=$G(FIND(X,"DATE")) Q:'DATE
"RTN","ORATR2",157,0)
 .S SORT(9999999-DATE)=DATE
"RTN","ORATR2",158,0)
 I $D(SORT) S X=$O(SORT(X)),RET=SORT(X)
"RTN","ORATR2",159,0)
 Q RET
"RTN","ORATR2",160,0)
 ;
"RTN","ORATR2",161,0)
GETDAYS() ;
"RTN","ORATR2",162,0)
 N ORX
"RTN","ORATR2",163,0)
 D GETLST^XPAR(.ORX,"SYS","ORATR DAYS TO ROLL-UP","I")
"RTN","ORATR2",164,0)
 Q $S(ORX:-ORX(1),1:-14) ; Defaults to 14 days
"RTN","ORATR2",165,0)
 ;
"RTN","ORATR2",166,0)
GETORD(PAT) ;
"RTN","ORATR2",167,0)
 N ORATIEN,ORDER,ORIEN,ORNOT,TARIEN
"RTN","ORATR2",168,0)
 S TARIEN="" F  S TARIEN=$O(^VFD(21695.2,"C",PAT,TARIEN)) Q:'TARIEN  D
"RTN","ORATR2",169,0)
 .S ORIEN=$$GET1^DIQ(21695.2,TARIEN,2)
"RTN","ORATR2",170,0)
 .I ORIEN["~" D
"RTN","ORATR2",171,0)
 ..S ORIEN=+$$GETORDER^ORATR(PAT,$TR(ORIEN,"~","-"))
"RTN","ORATR2",172,0)
 ..S:ORIEN=-1 ORIEN=""
"RTN","ORATR2",173,0)
 .I ORIEN S ORDER=+ORIEN
"RTN","ORATR2",174,0)
 Q $G(ORDER)
"RTN","ORATR2",175,0)
 ;
"RTN","ORATR2",176,0)
GETRAD(PAT,TODAY) ; Get info on last mammogram screening
"RTN","ORATR2",177,0)
 N X,RET S RET=""
"RTN","ORATR2",178,0)
 K ^TMP($J,"RAE1")
"RTN","ORATR2",179,0)
 D EN1^RAO7PC1(PAT,$$FMADD^XLFDT(TODAY,-60),TODAY,10)
"RTN","ORATR2",180,0)
 S X="" F  S X=$O(^TMP($J,"RAE1",PAT,X)) Q:X=""  D  Q:RET'=""
"RTN","ORATR2",181,0)
 .Q:$P(^TMP($J,"RAE1",PAT,X),U)'="MAMMOGRAM SCREEENING"
"RTN","ORATR2",182,0)
 .S RET=X,ORD=$P(^TMP($J,"RAE1",PAT,X),U,11)
"RTN","ORATR2",183,0)
 .I +$$GET1^DIQ(100,ORD,.02,"I")'=PAT K ORD
"RTN","ORATR2",184,0)
 K ^TMP($J,"RAE1")
"RTN","ORATR2",185,0)
 Q $TR(RET,"-","~")
"RTN","ORATR2",186,0)
 ;
"RTN","ORATR2",187,0)
GETRECIP(DFN,TYPE) ;
"RTN","ORATR2",188,0)
 ; P (Primary Provider): deliver notification to 
"RTN","ORATR2",189,0)
 ; the patient's Primary Provider.  
"RTN","ORATR2",190,0)
 ; 
"RTN","ORATR2",191,0)
 ; A (Attending Physician): deliver notification
"RTN","ORATR2",192,0)
 ; to the patient's Attending Physician.  
"RTN","ORATR2",193,0)
 ; 
"RTN","ORATR2",194,0)
 ; T (Patient Care Team): deliver notification to
"RTN","ORATR2",195,0)
 ; the patient's  primary care Team.  
"RTN","ORATR2",196,0)
 ; 
"RTN","ORATR2",197,0)
 ; M (PCMM Team): deliver notification to
"RTN","ORATR2",198,0)
 ; users/providers linked to the patient via PCMM
"RTN","ORATR2",199,0)
 ; Team Position assignments.  
"RTN","ORATR2",200,0)
 ; 
"RTN","ORATR2",201,0)
 ; E (Encounter Provider): deliver notification to
"RTN","ORATR2",202,0)
 ; the encounter provider who is associated with
"RTN","ORATR2",203,0)
 ; the health factors generating this notification.
"RTN","ORATR2",204,0)
 ; 
"RTN","ORATR2",205,0)
 ; R (PCMM Primary Care Practitioner): deliver
"RTN","ORATR2",206,0)
 ; notification to the patient's PCMM Primary Care
"RTN","ORATR2",207,0)
 ; Practitioner.  
"RTN","ORATR2",208,0)
 ; 
"RTN","ORATR2",209,0)
 ; S (PCMM Associate Provider): deliver
"RTN","ORATR2",210,0)
 ; notification to the patient's PCMM Associate
"RTN","ORATR2",211,0)
 ; Provider.
"RTN","ORATR2",212,0)
 ;
"RTN","ORATR2",213,0)
 S RECIP=$$GET1^DIQ(21695.5,TYPE,.05)
"RTN","ORATR2",214,0)
 I RECIP["P" D P
"RTN","ORATR2",215,0)
 I RECIP["A" D A
"RTN","ORATR2",216,0)
 I RECIP["T" D T
"RTN","ORATR2",217,0)
 I RECIP["E" D E
"RTN","ORATR2",218,0)
 I RECIP["R" D R
"RTN","ORATR2",219,0)
 I RECIP["S" D S
"RTN","ORATR2",220,0)
 I RECIP["M" D M
"RTN","ORATR2",221,0)
 Q
"RTN","ORATR2",222,0)
 ;
"RTN","ORATR2",223,0)
PURGE(ORIEN) ; Purge transmitted notifications out of file 21695.2
"RTN","ORATR2",224,0)
 ; Only purge notifications that were marked "TRANSMITTED" after
"RTN","ORATR2",225,0)
 ; a specified period of time
"RTN","ORATR2",226,0)
 N ORDT,ORDAYS,ORX,TODAY S TODAY=$$DT^XLFDT
"RTN","ORATR2",227,0)
 Q:$$GET1^DIQ(21695.2,ORIEN,1.05,"I")'=3
"RTN","ORATR2",228,0)
 D GETLST^XPAR(.ORX,"SYS","ORATR DAYS TO PURGE","I")
"RTN","ORATR2",229,0)
 S ORDAYS=$S(ORX:-ORX(1),1:-30) ; Defaults to 30 days
"RTN","ORATR2",230,0)
 S ORDT=$$GET1^DIQ(21695.2,ORIEN,1.06,"I")
"RTN","ORATR2",231,0)
 I ORDT<$$FMADD^XLFDT(TODAY,ORDAYS) D
"RTN","ORATR2",232,0)
 .N DA,DIK S DA=ORIEN,DIK="^VFD(21695.2," D ^DIK
"RTN","ORATR2",233,0)
 Q
"RTN","ORATR2",234,0)
 ;
"RTN","ORATR2",235,0)
ROLLDUP(IEN,KEY) ;
"RTN","ORATR2",236,0)
 N ORX,DATA,ERR,NM,RET S RET=0
"RTN","ORATR2",237,0)
 D GETS^DIQ(21695.2,IEN_",","20*",,"DATA","ERR")
"RTN","ORATR2",238,0)
 S ORX="" F  S ORX=$O(DATA(21695.21,ORX)) Q:ORX=""  D
"RTN","ORATR2",239,0)
 .S NM=$G(DATA(21695.21,ORX,.01))
"RTN","ORATR2",240,0)
 .I $D(^VA(200,KEY,NM)) S RET=1
"RTN","ORATR2",241,0)
 Q RET
"RTN","ORATR2",242,0)
 ;
"RTN","ORATR2",243,0)
SEND(PAT,RECIP,TYPE,DATA) ;
"RTN","ORATR2",244,0)
 N NAME,NEWIEN,NOW,ORFDA,ORLOC,ORNA,SENT,TEXT,TODAY,ORX,ORCNT
"RTN","ORATR2",245,0)
 S SENT=$$CHKSENT,TODAY=$$DT^XLFDT
"RTN","ORATR2",246,0)
 I SENT D  Q
"RTN","ORATR2",247,0)
 .I $P(SENT,U,2)<$$FMADD^XLFDT(TODAY,$$GETDAYS) D SENDUP(+SENT)
"RTN","ORATR2",248,0)
 S NOW=$$NOW^XLFDT
"RTN","ORATR2",249,0)
 S NAME="ATR,"_PAT_",;10000;"_PAT_";"_NOW_";"_TYPE_";"
"RTN","ORATR2",250,0)
 I $G(ORD)'="" S NAME=NAME_$$GET1^DIQ(100,ORD,4,"I")
"RTN","ORATR2",251,0)
 I $G(ORD)=""  S NAME=NAME_+$G(DATE)
"RTN","ORATR2",252,0)
 S TEXT=$$GET1^DIQ(21695.5,TYPE,3),ORNA=$NA(ORFDA(21695.2,"+1,"))
"RTN","ORATR2",253,0)
 S @ORNA@(.01)=NAME,@ORNA@(.02)=NOW,@ORNA@(.04)=PAT
"RTN","ORATR2",254,0)
 S @ORNA@(1.01)=TEXT,@ORNA@(1.05)=0,@ORNA@(1.09)=TYPE
"RTN","ORATR2",255,0)
 I $G(ORD)'="" S ORLOC=+$$GET1^DIQ(100,ORD,6,"I",,"ORERR") D
"RTN","ORATR2",256,0)
 .I ORLOC S @ORNA@(.12)=+ORLOC
"RTN","ORATR2",257,0)
 I $G(DATA)'="" S @ORNA@(2)=DATA
"RTN","ORATR2",258,0)
 E  S:$G(ORD)'="" @ORNA@(2)=ORD_"@OR"
"RTN","ORATR2",259,0)
 S ORX=0,ORCNT=2 F  S ORX=$O(RECIP(ORX)) Q:'ORX  D
"RTN","ORATR2",260,0)
 .S ORFDA(21695.21,"+"_ORCNT_",+1,",.01)=ORX
"RTN","ORATR2",261,0)
 .S ORFDA(21695.211,"+"_(ORCNT+1)_",+"_ORCNT_",+1,",.01)=1
"RTN","ORATR2",262,0)
 .S ORCNT=ORCNT+2
"RTN","ORATR2",263,0)
 D UPDATE^DIE("U","ORFDA","NEWIEN")
"RTN","ORATR2",264,0)
 Q
"RTN","ORATR2",265,0)
 ;
"RTN","ORATR2",266,0)
SENDUP(ATRIEN) ; Send this alert to the holder of the key
"RTN","ORATR2",267,0)
 N I,RECIP,KEY,ORFDA,ORERR
"RTN","ORATR2",268,0)
 Q:$$GET1^DIQ(21695.2,ATRIEN,1.05,"I")>1
"RTN","ORATR2",269,0)
 S KEY="AK.ORATRC",RECIP=$NA(^VA(200,KEY))
"RTN","ORATR2",270,0)
 Q:$$ROLLDUP(ATRIEN,KEY)
"RTN","ORATR2",271,0)
 F I=1:1 S RECIP=$Q(@RECIP) Q:$QS(RECIP,2)'=KEY  D
"RTN","ORATR2",272,0)
 .N IENS S IENS="+"_I_","_ATRIEN_","
"RTN","ORATR2",273,0)
 .S ORFDA(21695.21,IENS,.01)=$QS(RECIP,4)
"RTN","ORATR2",274,0)
 .S I=I+1,ORFDA(21695.211,"+"_I_","_IENS,.01)=1
"RTN","ORATR2",275,0)
 L +^VFD(21695.2,ATRIEN):$S($G(DILOCKTM)>0:DILOCKTM,1:5)
"RTN","ORATR2",276,0)
 D UPDATE^DIE(,"ORFDA",,"ORERR")
"RTN","ORATR2",277,0)
 L -^VFD(21695.2,ATRIEN):$S($G(DILOCKTM)>0:DILOCKTM,1:5)
"RTN","ORATR2",278,0)
 Q
"RTN","ORATR2",279,0)
 ;
"RTN","ORATR2",280,0)
SETUP(DFN,TYPE) ;
"RTN","ORATR2",281,0)
 N DATA,PROV,ORD,DATE,RECIP,ORX
"RTN","ORATR2",282,0)
 I $$GET1^DIQ(21695.5,TYPE,.01)["PATIENT NOTIFICATION" D
"RTN","ORATR2",283,0)
 .S DATA=$$GETRAD(DFN,$$DT^XLFDT)
"RTN","ORATR2",284,0)
 I '$D(ORD) S ORD=$$GETORD(DFN)
"RTN","ORATR2",285,0)
 D GETRECIP(DFN,TYPE)
"RTN","ORATR2",286,0)
 I $D(RECIP)'>1 D
"RTN","ORATR2",287,0)
 .S ORX=$NA(^VA(200,"AK.ORATRC"))
"RTN","ORATR2",288,0)
 .F  S ORX=$Q(@ORX) Q:$QS(ORX,2)'="AK.ORATRC"  D
"RTN","ORATR2",289,0)
 ..S RECIP($QS(ORX,4))=""
"RTN","ORATR2",290,0)
 I $G(ORD)="" S DATE=$$GETDATE(DFN,PXRM)
"RTN","ORATR2",291,0)
 D SEND(DFN,.RECIP,TYPE,$G(DATA))
"RTN","ORATR2",292,0)
 Q
"RTN","ORATR2",293,0)
 ;
"RTN","ORATR2",294,0)
 ;=====================================================================
"RTN","ORATR2",295,0)
 ;                R E C I P I E N T   U T I L I T I E S
"RTN","ORATR2",296,0)
 ;=====================================================================
"RTN","ORATR2",297,0)
A ; Attending Physician
"RTN","ORATR2",298,0)
 N ORX,VAIN,VADM
"RTN","ORATR2",299,0)
 D OERR^VADPT
"RTN","ORATR2",300,0)
 S ORX=+$P(VAIN(11),U) I ORX S RECIP(ORX)=""
"RTN","ORATR2",301,0)
 Q
"RTN","ORATR2",302,0)
 ;
"RTN","ORATR2",303,0)
E ; Encounter Provider
"RTN","ORATR2",304,0)
 N DEFARR,FIEVAL,ORX,PROV,VHF
"RTN","ORATR2",305,0)
 D DEF^PXRMLDR(PXRM,.DEFARR)
"RTN","ORATR2",306,0)
 D EVAL^PXRM(DFN,.DEFARR,0,1,.FIEVAL)
"RTN","ORATR2",307,0)
 S ORX=0 F  S ORX=$O(FIEVAL(ORX)) Q:'ORX  D
"RTN","ORATR2",308,0)
 .Q:'$G(FIEVAL(ORX))!($G(FIEVAL(ORX,"FILE NUMBER"))'=9000010.23)
"RTN","ORATR2",309,0)
 .S VHF=$G(FIEVAL(ORX,"DAS")) Q:'VHF
"RTN","ORATR2",310,0)
 .S PROV=$$GET1^DIQ(9000010.23,VHF,1204,"I") S:PROV RECIP(PROV)=""
"RTN","ORATR2",311,0)
 Q
"RTN","ORATR2",312,0)
 ;
"RTN","ORATR2",313,0)
M ; PCMM Team
"RTN","ORATR2",314,0)
 N ORPCMM,ORX,ORLST,ORERR,ORTM K ^TMP("ORPCMM",$J)
"RTN","ORATR2",315,0)
 S ORPCMM=$$PRPT^SCAPMC(DFN,,,,,,"^TMP(""ORPCMM"",$J)",)  ;DBIA #1916
"RTN","ORATR2",316,0)
 S ORX=0 F  S ORX=$O(^TMP("ORPCMM",$J,"SCPR",ORX)) Q:'ORX  D
"RTN","ORATR2",317,0)
 .S RECIP(ORX)=""
"RTN","ORATR2",318,0)
 K ^TMP("ORPCMM",$J)
"RTN","ORATR2",319,0)
 ;
"RTN","ORATR2",320,0)
 S ORPCMM=$$TMPT^SCAPMC(DFN,,,"ORLST","ORERR")
"RTN","ORATR2",321,0)
 S ORTM=0 F  S ORTM=$O(ORLST(ORTM)) Q:'ORTM  D
"RTN","ORATR2",322,0)
 .N ORPROV S ORPROV=$$PRTM^SCAPMC(+ORLST(ORTM),,,,"ORPROV","ORERR")
"RTN","ORATR2",323,0)
 .S ORX=0 F  S ORX=$O(ORPROV("SCPR",ORX)) Q:'ORX  D
"RTN","ORATR2",324,0)
 ..S RECIP(ORX)=""
"RTN","ORATR2",325,0)
 Q
"RTN","ORATR2",326,0)
 ;
"RTN","ORATR2",327,0)
P ; Primary Provider
"RTN","ORATR2",328,0)
 N ORX,VAIN,VADM
"RTN","ORATR2",329,0)
 D OERR^VADPT
"RTN","ORATR2",330,0)
 S ORX=+$P(VAIN(2),U) I ORX S RECIP(ORX)=""
"RTN","ORATR2",331,0)
 Q
"RTN","ORATR2",332,0)
 ;
"RTN","ORATR2",333,0)
R ; PCMM Primary Care Practitioner
"RTN","ORATR2",334,0)
 N ORX
"RTN","ORATR2",335,0)
 S ORX=+$$OUTPTPR^SDUTL3(DFN,$$NOW^XLFDT,1)
"RTN","ORATR2",336,0)
 I ORX S RECIP(ORX)=""
"RTN","ORATR2",337,0)
 Q
"RTN","ORATR2",338,0)
 ;
"RTN","ORATR2",339,0)
S ; PCMM Associate Provider
"RTN","ORATR2",340,0)
 N ORX
"RTN","ORATR2",341,0)
 S ORX=+$$OUTPTAP^SDUTL3(DFN,$$NOW^XLFDT)
"RTN","ORATR2",342,0)
 I ORX S RECIP(ORX)=""
"RTN","ORATR2",343,0)
 Q
"RTN","ORATR2",344,0)
 ;
"RTN","ORATR2",345,0)
T ; Patient Care Team
"RTN","ORATR2",346,0)
 N ORLST,ORX
"RTN","ORATR2",347,0)
 D TMSPT^ORQPTQ1(.ORLST,DFN)
"RTN","ORATR2",348,0)
 S ORX=0 F  S ORX=$O(ORLST(ORX)) Q:'ORX  D
"RTN","ORATR2",349,0)
 .N ORTM,ORLST2 S ORTM=+ORLST(ORX) Q:'ORTM
"RTN","ORATR2",350,0)
 .D TEAMPROV^ORQPTQ1(.ORLST2,ORTM)
"RTN","ORATR2",351,0)
 .S ORY=0 F  S ORY=$O(ORLST2(ORY)) Q:'ORY  D
"RTN","ORATR2",352,0)
 ..I +ORLST2(ORY) S RECIP(+ORLST2(ORY))=""
"RTN","ORATR2",353,0)
 Q
"RTN","ORATR2",354,0)
 ;
"RTN","ORATR2",355,0)
TEST ;
"RTN","ORATR2",356,0)
 N OR S OR=0 F  S OR=$O(^VFD(21695.5,"AB",OR)) Q:'OR  D
"RTN","ORATR2",357,0)
 .N NA,ORIEN S NA=$NA(^XTV(8992.1,"PKGID","OR,"_OR)) Q:'$D(@NA)
"RTN","ORATR2",358,0)
 .S ORIEN=0 F  S ORIEN=$O(@NA@(ORIEN)) Q:'ORIEN  D
"RTN","ORATR2",359,0)
 ..Q:$$COMPLETE(ORIEN)  D TRANSFER^ORATR(ORIEN)
"RTN","ORATR2",360,0)
 Q
"RTN","ORATR2",361,0)
 ;
"RTN","ORATR2",362,0)
COMPLETE(ORIEN) ;
"RTN","ORATR2",363,0)
 N DATA,ORERR,FLAG,ORX S FLAG=0
"RTN","ORATR2",364,0)
 D GETS^DIQ(8992.1,ORIEN_",","20*",,"DATA","ORERR")
"RTN","ORATR2",365,0)
 S ORX="" F  S ORX=$O(DATA(8992.11,ORX)) Q:ORX=""  D
"RTN","ORATR2",366,0)
 .I $G(DATA(8992.11,ORX,.04))'="" S FLAG=1
"RTN","ORATR2",367,0)
 Q FLAG
"RTN","ORATR2",368,0)
 ;
"RTN","ORATRPC")
0^2^B64999387
"RTN","ORATRPC",1,0)
ORATRPC ; DSS/SMP - Abnormal Alert RPCs ; AUG 17, 2012
"RTN","ORATRPC",2,0)
 ;;1.0;VENDOR - DOCUMENT STORAGE SYSTEMS;;7/17/2012;Build 3
"RTN","ORATRPC",3,0)
 Q
"RTN","ORATRPC",4,0)
 ;
"RTN","ORATRPC",5,0)
 ; Documented API and ICRs
"RTN","ORATRPC",6,0)
 ; -----------------------
"RTN","ORATRPC",7,0)
 ; 2056      $$GET1^DIQ
"RTN","ORATRPC",8,0)
 ; 2056      GETS^DIQ
"RTN","ORATRPC",9,0)
 ; 10103     $$FMTE^XLFDT
"RTN","ORATRPC",10,0)
 ; XXXXX     $$NODEDATA^TIUSRVT
"RTN","ORATRPC",11,0)
 ;
"RTN","ORATRPC",12,0)
 ; Return Array Format For PAT and PROV
"RTN","ORATRPC",13,0)
 ;  ^ Piece
"RTN","ORATRPC",14,0)
 ;  1 - Info Flag
"RTN","ORATRPC",15,0)
 ;  2 - Patient Name ABC,PATIE (A4321)
"RTN","ORATRPC",16,0)
 ;  3 - Patient Location
"RTN","ORATRPC",17,0)
 ;  4 - Alert Urgency Level (HIGH, Moderate, low)
"RTN","ORATRPC",18,0)
 ;  5 - Alert Date/Time
"RTN","ORATRPC",19,0)
 ;  6 - Alert Message
"RTN","ORATRPC",20,0)
 ;  7 - Forwarded By/When
"RTN","ORATRPC",21,0)
 ;  8 - XQAID
"RTN","ORATRPC",22,0)
 ;  9 - null
"RTN","ORATRPC",23,0)
 ; 10 - Remove w/o Processing Flag
"RTN","ORATRPC",24,0)
 ; 11 - Forwarding Comments (if applicable)
"RTN","ORATRPC",25,0)
 ; 12 - Pointer to the Order File (#100)
"RTN","ORATRPC",26,0)
 ; 13 - Processing Level
"RTN","ORATRPC",27,0)
 ;
"RTN","ORATRPC",28,0)
 ; Return Array Example
"RTN","ORATRPC",29,0)
 ; RET(1)="^BHYHGDST  (B1022)^^HIGH^06/06/2012@10:15^BCCCR.^^ATR;10000;155^^"
"RTN","ORATRPC",30,0)
 ;
"RTN","ORATRPC",31,0)
PAT() ; RPC - ORATR PATIENT
"RTN","ORATRPC",32,0)
 N ORX,ORNA,ORCNT S ORCNT=1
"RTN","ORATRPC",33,0)
 S ORNA=$NA(^VFD(21695.2,"C",ORDFN)) Q:'$D(@ORNA) 0
"RTN","ORATRPC",34,0)
 S ORX=0 F  S ORX=$O(@ORNA@(ORX)) Q:'ORX  D
"RTN","ORATRPC",35,0)
 .N ORY D GETINFO(ORX) D:$G(ORY)'="" ADD(ORY)
"RTN","ORATRPC",36,0)
 Q 1
"RTN","ORATRPC",37,0)
 ;
"RTN","ORATRPC",38,0)
PROV() ; RPC - ORATR PROVIDER
"RTN","ORATRPC",39,0)
 N ORX,ORX2,ORNA,ORCNT S ORCNT=1
"RTN","ORATRPC",40,0)
 S ORNA=$NA(^VFD(21695.2,"R",ORUSR)) Q:'$D(@ORNA) 0
"RTN","ORATRPC",41,0)
 S ORX=0 F  S ORX=$O(@ORNA@(ORX)) Q:'ORX  D
"RTN","ORATRPC",42,0)
 .S ORX2=0 F  S ORX2=$O(@ORNA@(ORX,ORX2)) Q:'ORX2  D
"RTN","ORATRPC",43,0)
 ..N ORY D GETINFO(ORX,ORX2,1) D:$G(ORY)'="" ADD(ORY)
"RTN","ORATRPC",44,0)
 Q 1
"RTN","ORATRPC",45,0)
 ;
"RTN","ORATRPC",46,0)
NOTE() ; RPC - ORATR GET NOTE
"RTN","ORATRPC",47,0)
 N ORX,ORFLDS,ORIENS,ORDATA,ORERR,ORNA
"RTN","ORATRPC",48,0)
 Q:'$D(^VFD(21695.5,ORNOTE)) -1
"RTN","ORATRPC",49,0)
 S ORIENS=ORNOTE_",",ORFLDS=".02;.03"
"RTN","ORATRPC",50,0)
 D GETS^DIQ(21695.5,ORIENS,ORFLDS,"IE","ORDATA","ORERR")
"RTN","ORATRPC",51,0)
 Q:$D(ORERR) -1  S ORNA=$NA(ORDATA(21695.5,ORIENS))
"RTN","ORATRPC",52,0)
 S ORRET=$G(@ORNA@(.03,"I"))_U_$G(@ORNA@(.03,"E"))_U_$G(@ORNA@(.02,"I"))
"RTN","ORATRPC",53,0)
 Q 1
"RTN","ORATRPC",54,0)
 ;
"RTN","ORATRPC",55,0)
TEMPLATE() ; RPC - ORATR GET TIU TEMPLATE
"RTN","ORATRPC",56,0)
 ;TFF - GET THE TEMPLATE WITH THE PASSING IN OF THE TIU TEMPLATE IEN?
"RTN","ORATRPC",57,0)
 N ORX Q:'ORRDIEN 0
"RTN","ORATRPC",58,0)
 ;Q:'$D(^PXRMD(801.41,ORRDIEN)) 0
"RTN","ORATRPC",59,0)
 ;S ORX=0 F  S ORX=$O(^TIU(8927,ORX)) Q:'ORX  D  ;Q:$D(ORRET)
"RTN","ORATRPC",60,0)
 ;.Q:$P(^TIU(8927,ORX,0),U,15)'=ORRDIEN
"RTN","ORATRPC",61,0)
 ;.S ORRET=$$NODEDATA^TIUSRVT(ORX)
"RTN","ORATRPC",62,0)
 S ORRET=$$NODEDATA^TIUSRVT(ORRDIEN)
"RTN","ORATRPC",63,0)
 Q $D(ORRET)
"RTN","ORATRPC",64,0)
 ;
"RTN","ORATRPC",65,0)
PROCESS(ORIEN,ORPRO) ; RPC - ORATR SET ATR PROCESSING LEVEL
"RTN","ORATRPC",66,0)
 N ORFDA,ORERR
"RTN","ORATRPC",67,0)
 S ORFDA(21695.2,ORIEN_",",1.05)=ORPRO
"RTN","ORATRPC",68,0)
 ; if COMPLETED, put date/time in DATE COMPLETED field
"RTN","ORATRPC",69,0)
 I ORPRO=2 D
"RTN","ORATRPC",70,0)
 .S ORFDA(21695.2,ORIEN_",",1.08)=$$NOW^XLFDT
"RTN","ORATRPC",71,0)
 .N ALERT S ALERT=$$GET1^DIQ(21695.2,ORIEN,.09)
"RTN","ORATRPC",72,0)
 .I ALERT'="" D ACTION^XQALERT(ALERT)
"RTN","ORATRPC",73,0)
 ; if TRANSMITTED, put date in DATE TRANSMITTED field
"RTN","ORATRPC",74,0)
 I ORPRO=3 S ORFDA(21695.2,ORIEN_",",1.06)=$$DT^XLFDT
"RTN","ORATRPC",75,0)
 L +^VFD(21695.2,ORIEN):$S($G(DILOCKTM)>0:DILOCKTM,1:5)
"RTN","ORATRPC",76,0)
 D UPDATE^DIE("E","ORFDA",,"ORERR")
"RTN","ORATRPC",77,0)
 L -^VFD(21695.2,ORIEN):$S($G(DILOCKTM)>0:DILOCKTM,1:5)
"RTN","ORATRPC",78,0)
 Q $S('$D(ORERR):1,1:-1)
"RTN","ORATRPC",79,0)
 ;
"RTN","ORATRPC",80,0)
BCCCR(ORIEN) ; RPC - ORATR BCCCR TRANSMIT
"RTN","ORATRPC",81,0)
 ;  1     TAR IEN
"RTN","ORATRPC",82,0)
 ;  2     Patient DFN
"RTN","ORATRPC",83,0)
 ;  3     Site NUM
"RTN","ORATRPC",84,0)
 ;  4     Patient ICN
"RTN","ORATRPC",85,0)
 ;  5     HF Name
"RTN","ORATRPC",86,0)
 ;  6     HF Date
"RTN","ORATRPC",87,0)
 ;  7     HF Deleted (Yes/No)
"RTN","ORATRPC",88,0)
 ;  8     HF BI-RAD
"RTN","ORATRPC",89,0)
 ;  9     HF Contact Method
"RTN","ORATRPC",90,0)
 ; 10     HF Contact Individual
"RTN","ORATRPC",91,0)
 ; 11     Order IEN
"RTN","ORATRPC",92,0)
 ; 12     Order Date
"RTN","ORATRPC",93,0)
 ; 13     Orderable Item Name
"RTN","ORATRPC",94,0)
 ; 14     Orderable Item CPT Code
"RTN","ORATRPC",95,0)
 ; 15     Orderable Item Package
"RTN","ORATRPC",96,0)
 ; 16     Encounter Provider DUZ
"RTN","ORATRPC",97,0)
 ; 17     Ordering Provider DUZ
"RTN","ORATRPC",98,0)
 ;
"RTN","ORATRPC",99,0)
 N DATA,DFN,FLDS,IENS,NA,ORCNT,ORCPT,ORDER,ORERR,ORHF,ORX,ORY,SITE,TYPE
"RTN","ORATRPC",100,0)
 N STATION,ICN
"RTN","ORATRPC",101,0)
 S ORCNT=1,STATION=$P($$SITE^VASITE,U,3)
"RTN","ORATRPC",102,0)
 S IENS=ORIEN_",",FLDS=".01;.04;.12;2;5*;6*"
"RTN","ORATRPC",103,0)
 D GETS^DIQ(21695.2,IENS,FLDS,"I","DATA","ORERR")
"RTN","ORATRPC",104,0)
 ;D GETS^DIQ(21695.2,IENS,FLDS,"IE","DATA","ORERR")
"RTN","ORATRPC",105,0)
 S NA=$NA(DATA(21695.2,IENS)) Q:'$D(@NA)
"RTN","ORATRPC",106,0)
 S DFN=$G(@NA@(.04,"I")),ORX=$G(@NA@(2,"I"))
"RTN","ORATRPC",107,0)
 I $L($T(GETICN^MPIF001)) S ICN=$$GETICN^MPIF001(DFN)
"RTN","ORATRPC",108,0)
 ; GETICN returns ICN_"V"_CHECKSUM
"RTN","ORATRPC",109,0)
 I +ICN=-1 ;DO SOMETHING
"RTN","ORATRPC",110,0)
 S ID=ORIEN_U_DFN_U_STATION_U_ICN_U
"RTN","ORATRPC",111,0)
 S ORX="" F  S ORX=$O(DATA(21695.26,ORX)) Q:ORX=""  D
"RTN","ORATRPC",112,0)
 .D ADD(ID_$$HF(ORX))
"RTN","ORATRPC",113,0)
 S ORX="" F  S ORX=$O(DATA(21695.25,ORX)) Q:ORX=""  D
"RTN","ORATRPC",114,0)
 .N ORDER,ORDATA S ORDER=DATA(21695.25,ORX,.01,"I")
"RTN","ORATRPC",115,0)
 .D ORDATA(ORDER,ID)
"RTN","ORATRPC",116,0)
 Q
"RTN","ORATRPC",117,0)
 ;
"RTN","ORATRPC",118,0)
GETHF ; RPC - ORATR HEALTH FACTORS
"RTN","ORATRPC",119,0)
 ; HEALTH FACTORS       ^AUTTHF(
"RTN","ORATRPC",120,0)
 ; V HEALTH FACTOR      ^AUPNVHF(
"RTN","ORATRPC",121,0)
 N ORIEN,ORHF,ORX,HFIEN,ORFDA,ORERR,CNT,DFN,ORDT
"RTN","ORATRPC",122,0)
 S ORDT=$O(^TMP("ORATRHF","")) Q:'ORDT
"RTN","ORATRPC",123,0)
 S ORIEN=$O(^TMP("ORATRHF",ORDT,"")) Q:'ORIEN  S ORHF=$G(^(ORIEN))
"RTN","ORATRPC",124,0)
 S DFN=$$GET1^DIQ(21695.2,ORIEN,.04,"I"),ORIEN=ORIEN_",",CNT=1
"RTN","ORATRPC",125,0)
 F ORX=2:1:$L(ORHF,U) D
"RTN","ORATRPC",126,0)
 .K ORERR S HF=$$FIND1^DIC(9999999.64,,"X",$P(ORHF,U,ORX),,,"ORERR")
"RTN","ORATRPC",127,0)
 .I '$D(ORERR) S ORHF(HF)=$P(ORHF,U,ORX)
"RTN","ORATRPC",128,0)
 S HF="" F  S HF=$O(ORHF(HF)) Q:'HF  D
"RTN","ORATRPC",129,0)
 .N FLAG S VHF=""
"RTN","ORATRPC",130,0)
 .F  S VHF=$O(^AUPNVHF("B",HF,VHF),-1) Q:'VHF  D  Q:$D(FLAG)
"RTN","ORATRPC",131,0)
 ..Q:'$D(^AUPNVHF("C",DFN,VHF))
"RTN","ORATRPC",132,0)
 ..I $D(^VFD(21695.2,+ORIEN,6,"B",VHF)) S FLAG=1 Q
"RTN","ORATRPC",133,0)
 ..D GETHF1
"RTN","ORATRPC",134,0)
 D:$D(ORFDA)
"RTN","ORATRPC",135,0)
 .L +^VFD(21695.2,ORIEN):$S($G(DILOCKTM)>0:DILOCKTM,1:5)
"RTN","ORATRPC",136,0)
 .D UPDATE^DIE(,"ORFDA",,"ORERR")
"RTN","ORATRPC",137,0)
 .L -^VFD(21695.2,ORIEN):$S($G(DILOCKTM)>0:DILOCKTM,1:5)
"RTN","ORATRPC",138,0)
 I '$D(ORERR) K ^TMP("ORATRHF",ORDT,+ORIEN)
"RTN","ORATRPC",139,0)
 D FOLLOWUP^ORATR2(+ORIEN)
"RTN","ORATRPC",140,0)
 Q
"RTN","ORATRPC",141,0)
 ;
"RTN","ORATRPC",142,0)
 ;=====================================================================
"RTN","ORATRPC",143,0)
 ;                      R P C   U T I L I T I E S
"RTN","ORATRPC",144,0)
 ;=====================================================================
"RTN","ORATRPC",145,0)
 ;
"RTN","ORATRPC",146,0)
GETINFO(ORIEN,ORSUB,ORPROV) ; gets info for alert at ^VFD(21695.2,ORIEN,"XQA",ORSUB)
"RTN","ORATRPC",147,0)
 ; TOP LEVEL INFORMATION
"RTN","ORATRPC",148,0)
 ; PATIENT               .04
"RTN","ORATRPC",149,0)
 ; ALERT DATE/TIME       .01 (can be obtained thru .01 field)
"RTN","ORATRPC",150,0)
 ; ALERT MESSAGE        1.01
"RTN","ORATRPC",151,0)
 ; XQAID                 .01
"RTN","ORATRPC",152,0)
 ; URGNECY               .1  (can be obtained thru .1 field)
"RTN","ORATRPC",153,0)
 ; CAN DELETE...         .11
"RTN","ORATRPC",154,0)
 ; PATIENT LOCATION      .12
"RTN","ORATRPC",155,0)
 ; DATA FOR PROCESSING  2
"RTN","ORATRPC",156,0)
 ; PROCESSED            1.05
"RTN","ORATRPC",157,0)
 ;
"RTN","ORATRPC",158,0)
 ;
"RTN","ORATRPC",159,0)
 N X,ORX,OROUT,ORIENS,ORFLDS,ORERR,ORSSN,ORNA,ORURG
"RTN","ORATRPC",160,0)
 S ORFLDS=".01;.04;.1;.11;.12;1.01;1.05;1.07;2",ORIENS=ORIEN_","
"RTN","ORATRPC",161,0)
 D GETS^DIQ(21695.2,ORIENS,ORFLDS,"IE","OROUT","ORERR")
"RTN","ORATRPC",162,0)
 S ORNA=$NA(OROUT(21695.2,ORIENS))
"RTN","ORATRPC",163,0)
 ; Patient Name/SSN
"RTN","ORATRPC",164,0)
 S ORX=$G(@ORNA@(.04,"I"))_U_$G(@ORNA@(.04,"E"))
"RTN","ORATRPC",165,0)
 I ORX S ORSSN=$$GET1^DIQ(2,+ORX,.09,"E") D
"RTN","ORATRPC",166,0)
 .S ORX=$E($P(ORX,U,2),1,9)_" (",ORX=ORX_$E(ORX,1)_$E(ORSSN,6,9)_")"
"RTN","ORATRPC",167,0)
 .S $P(ORY,U,2)=ORX
"RTN","ORATRPC",168,0)
 ; Patient Location
"RTN","ORATRPC",169,0)
 S $P(ORY,U,3)=$G(@ORNA@(.12,"E"))
"RTN","ORATRPC",170,0)
 ; Alert Urgency Level
"RTN","ORATRPC",171,0)
 S ORX=$G(@ORNA@(.1,"I"))
"RTN","ORATRPC",172,0)
 I ORX D URGENCY^ORQORB(.ORURG,ORX) S ORURG=$S($G(ORURG)>0:ORURG,1:2) D
"RTN","ORATRPC",173,0)
 .S $P(ORY,U,4)=$S(ORURG=1:"HIGH",ORURG=2:"Moderate",1:"low")
"RTN","ORATRPC",174,0)
 ; Alert Date/Time
"RTN","ORATRPC",175,0)
 S ORX=$P($G(@ORNA@(.01,"I")),";",4)
"RTN","ORATRPC",176,0)
 S $P(ORY,U,5)=$$FMTE^XLFDT(ORX,"7M")
"RTN","ORATRPC",177,0)
 ; Alert Message
"RTN","ORATRPC",178,0)
 S ORX=$G(@ORNA@(1.01,"E")) I $G(ORPROV),$L(ORX,"):")>1 S ORX=$P(ORX,": ",2,99)
"RTN","ORATRPC",179,0)
 S $P(ORY,U,6)=ORX
"RTN","ORATRPC",180,0)
 ; XQAID
"RTN","ORATRPC",181,0)
 ;============================================
"RTN","ORATRPC",182,0)
 ;    Set ORX to the TIU DOCUMENT POINTER
"RTN","ORATRPC",183,0)
 ;============================================
"RTN","ORATRPC",184,0)
 S ORX=$G(@ORNA@(1.07,"I"))
"RTN","ORATRPC",185,0)
 S $P(ORY,U,8)=$G(@ORNA@(.01,"E"))_";"_ORIEN_";"_ORX_U
"RTN","ORATRPC",186,0)
 ; Remove w/o Processing Flag
"RTN","ORATRPC",187,0)
 S $P(ORY,U,10)=$G(@ORNA@(.11,"I"))
"RTN","ORATRPC",188,0)
 ; Pointer to the Order File (#100)
"RTN","ORATRPC",189,0)
 S ORX=$G(@ORNA@(2,"E")) I ORX["@OR" D
"RTN","ORATRPC",190,0)
 .S $P(ORY,U,12)=+ORX
"RTN","ORATRPC",191,0)
 ; Processing Level
"RTN","ORATRPC",192,0)
 S $P(ORY,U,13)=$G(@ORNA@(1.05,"I"))
"RTN","ORATRPC",193,0)
 ; Get latest forwarding information
"RTN","ORATRPC",194,0)
 I '$D(ORSUB) S ORSUB=$$GETSUB(ORIEN)
"RTN","ORATRPC",195,0)
 S ORX=$O(^VFD(21695.2,ORIEN,20,ORSUB,2,"A"),-1)
"RTN","ORATRPC",196,0)
 K @ORNA S ORIENS=ORX_","_ORSUB_","_ORIEN_",",ORFLDS=".01;.03;1.01"
"RTN","ORATRPC",197,0)
 I ORX D GETS^DIQ(21695.212,ORIENS,ORFLDS,"IE","OROUT","ORERR") D
"RTN","ORATRPC",198,0)
 .S ORNA=$NA(OROUT(21695.212,ORIENS))
"RTN","ORATRPC",199,0)
 .; Forwarded by/when
"RTN","ORATRPC",200,0)
 .S ORX=$G(@ORNA@(.03,"E"))_";"_$$FMTE^XLFDT($G(@ORNA@(.01,"I")),"7M")
"RTN","ORATRPC",201,0)
 .S $P(ORY,U,7)=ORX
"RTN","ORATRPC",202,0)
 .; Forwarding Comments (if applicable)
"RTN","ORATRPC",203,0)
 .S $P(ORY,U,11)=$G(@ORNA@(1.01,"E"))
"RTN","ORATRPC",204,0)
 Q
"RTN","ORATRPC",205,0)
 ;
"RTN","ORATRPC",206,0)
GETHF1 ;
"RTN","ORATRPC",207,0)
 N VST,VSTDT
"RTN","ORATRPC",208,0)
 S VST=$$GET1^DIQ(9000010.23,VHF,.03,"I")
"RTN","ORATRPC",209,0)
 S VSTDT=$$GET1^DIQ(9000010,VST,.01,"I")
"RTN","ORATRPC",210,0)
 S ORFDA(21695.26,"+"_CNT_","_ORIEN,.01)=VHF
"RTN","ORATRPC",211,0)
 S ORFDA(21695.26,"+"_CNT_","_ORIEN,.02)=$$GET1^DIQ(9999999.64,HF,.03,"I")
"RTN","ORATRPC",212,0)
 S ORFDA(21695.26,"+"_CNT_","_ORIEN,.03)=ORHF(HF)
"RTN","ORATRPC",213,0)
 S ORFDA(21695.26,"+"_CNT_","_ORIEN,1)=VSTDT
"RTN","ORATRPC",214,0)
 S CNT=CNT+1,FLAG=1
"RTN","ORATRPC",215,0)
 Q
"RTN","ORATRPC",216,0)
 ;
"RTN","ORATRPC",217,0)
ADD(ORSTR) ;
"RTN","ORATRPC",218,0)
 S ORRET(ORCNT)=ORSTR,ORCNT=ORCNT+1
"RTN","ORATRPC",219,0)
 Q
"RTN","ORATRPC",220,0)
 ;
"RTN","ORATRPC",221,0)
GETSUB(ORIEN) ;
"RTN","ORATRPC",222,0)
 N ORX,RET
"RTN","ORATRPC",223,0)
 S ORX=0 F  S ORX=$O(^VFD(21695.2,ORIEN,20,ORX)) Q:'ORX  D
"RTN","ORATRPC",224,0)
 .I $D(^VFD(21695.2,ORIEN,20,ORX,2)) S RET=ORX
"RTN","ORATRPC",225,0)
 Q $G(RET,-1)
"RTN","ORATRPC",226,0)
 ;
"RTN","ORATRPC",227,0)
 ;=====================================================================
"RTN","ORATRPC",228,0)
 ;     U S E D   W I T H   O R A T R   B C C C R   T R A N S M I T
"RTN","ORATRPC",229,0)
 ;=====================================================================
"RTN","ORATRPC",230,0)
 ;
"RTN","ORATRPC",231,0)
HF(IENS) ; Returns information relating to a health factor
"RTN","ORATRPC",232,0)
 ;  5     HF Name
"RTN","ORATRPC",233,0)
 ;  6     HF Date
"RTN","ORATRPC",234,0)
 ;  7     HF Deleted (Yes/No)
"RTN","ORATRPC",235,0)
 ;  8     HF BI-RAD
"RTN","ORATRPC",236,0)
 ;  9     HF Contact Method
"RTN","ORATRPC",237,0)
 ; 10     HF Contact Individual
"RTN","ORATRPC",238,0)
 ; 16     Encounter Provider DUZ
"RTN","ORATRPC",239,0)
 N X,DEL,FLDS,HF,HFDATA,HFERR,PROV,RET,VST
"RTN","ORATRPC",240,0)
 S HF(1)=$G(DATA(21695.26,IENS,.03,"I"))
"RTN","ORATRPC",241,0)
 S HF(2)=$G(DATA(21695.26,IENS,1,"I"))
"RTN","ORATRPC",242,0)
 S DEL=+$G(DATA(21695.26,IENS,.04,"I"))
"RTN","ORATRPC",243,0)
 S HF=$G(DATA(21695.26,IENS,.01,"I"))_",",FLDS=".01;.03;1201;1204;81101"
"RTN","ORATRPC",244,0)
 I 'DEL D
"RTN","ORATRPC",245,0)
 .D GETS^DIQ(9000010.23,HF,FLDS,"IE","HFDATA","HFERR")
"RTN","ORATRPC",246,0)
 S HF(3)=$S('DEL:"No",1:"Yes")
"RTN","ORATRPC",247,0)
 I HF(1)["BI-RAD" S HF(4)=+$P(HF(1),"RAD ",2)
"RTN","ORATRPC",248,0)
 I HF(1)["CONTACT METHOD" D
"RTN","ORATRPC",249,0)
 .S HF(5)=$P(HF(1),":",2)
"RTN","ORATRPC",250,0)
 .S HF(6)=$G(HFDATA(9000010.23,HF,81101,"E"))
"RTN","ORATRPC",251,0)
 S X="" F  S X=$O(HF(X)) Q:'X  S $P(RET,U,X)=HF(X)
"RTN","ORATRPC",252,0)
 S PROV=$G(HFDATA(9000010.23,HF,1204,"I"))
"RTN","ORATRPC",253,0)
 S $P(RET,U,12)=PROV
"RTN","ORATRPC",254,0)
 Q RET
"RTN","ORATRPC",255,0)
 ;
"RTN","ORATRPC",256,0)
ORDATA(IEN,ID) ; Gathers information relating to an order
"RTN","ORATRPC",257,0)
 ; 11     Order IEN
"RTN","ORATRPC",258,0)
 ; 12     Order Date
"RTN","ORATRPC",259,0)
 ; 13     Orderable Item Name
"RTN","ORATRPC",260,0)
 ; 14     Orderable Item CPT Code
"RTN","ORATRPC",261,0)
 ; 15     Orderable Item Package
"RTN","ORATRPC",262,0)
 ; 17     Ordering Provider
"RTN","ORATRPC",263,0)
 N CPT,ORDATA,ORITEM,ORX,PROV S $P(ID,U,11)=IEN
"RTN","ORATRPC",264,0)
 D GETS^DIQ(100,IEN_",",".1*;1;4","IE","ORDATA","ORERR")
"RTN","ORATRPC",265,0)
 S $P(ID,U,12)=$G(ORDATA(100,IEN_",",4,"I"))
"RTN","ORATRPC",266,0)
 S PROV=$G(ORDATA(100,IEN_",",1,"I"))
"RTN","ORATRPC",267,0)
 S ORY="" F  S ORY=$O(ORDATA(100.001,ORY)) Q:ORY=""  D
"RTN","ORATRPC",268,0)
 .N ORX S ORX=ID,ORITEM=ORDATA(100.001,ORY,.01,"I")
"RTN","ORATRPC",269,0)
 .S $P(ORX,U,13)=ORDATA(100.001,ORY,.01,"E")
"RTN","ORATRPC",270,0)
 .S ORX=ORX_U_$$GETORITM(ORITEM),$P(ORX,U,17)=PROV
"RTN","ORATRPC",271,0)
 .D ADD(ORX)
"RTN","ORATRPC",272,0)
 Q
"RTN","ORATRPC",273,0)
 ;
"RTN","ORATRPC",274,0)
GETORITM(ORITEM) ;
"RTN","ORATRPC",275,0)
 N CPT,IENS,ORERR,ORINFO,RET S IENS=ORITEM_","
"RTN","ORATRPC",276,0)
 D GETS^DIQ(101.43,IENS,"1.1;3;4",,"ORINFO","ORERR")
"RTN","ORATRPC",277,0)
 I $G(ORINFO(101.43,IENS,4))["CPT" D
"RTN","ORATRPC",278,0)
 .S CPT=$G(ORINFO(101.43,IENS,3))
"RTN","ORATRPC",279,0)
 .Q:$$GET1^DIQ(81,CPT,5,"I")
"RTN","ORATRPC",280,0)
 .S RET=CPT
"RTN","ORATRPC",281,0)
 S $P(RET,U,2)=$G(ORINFO(101.43,IENS,1.1))
"RTN","ORATRPC",282,0)
 Q RET
"RTN","ORATRPC",283,0)
 ;
"RTN","ORWDX")
0^4^B68176473
"RTN","ORWDX",1,0)
ORWDX ; SLC/KCM/REV/JLI - Order dialog utilities ;12/14/12  09:24
"RTN","ORWDX",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,125,131,132,141,164,178,187,190,195,215,246,243,283,296,280,306**;Dec 17, 1997;Build 3
"RTN","ORWDX",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","ORWDX",4,0)
 ;Reference to DIC(9.4 supported by IA #2058
"RTN","ORWDX",5,0)
 ;
"RTN","ORWDX",6,0)
ORDITM(Y,FROM,DIR,XREF) ; Subset of orderable items
"RTN","ORWDX",7,0)
 ; Y(n)=IEN^.01 Name^.01 Name  -or-  IEN^Synonym <.01 Name>^.01 Name
"RTN","ORWDX",8,0)
 N I,IEN,CNT,X,DTXT,CURTM,DEFROUTE
"RTN","ORWDX",9,0)
 S DEFROUTE=""
"RTN","ORWDX",10,0)
 S I=0,CNT=44,CURTM=$$NOW^XLFDT
"RTN","ORWDX",11,0)
 F  Q:I'<CNT  S FROM=$O(^ORD(101.43,XREF,FROM),DIR) Q:FROM=""  D
"RTN","ORWDX",12,0)
 . S IEN="" F  S IEN=$O(^ORD(101.43,XREF,FROM,IEN),DIR) Q:'IEN  D
"RTN","ORWDX",13,0)
 . . S X=^ORD(101.43,XREF,FROM,IEN)
"RTN","ORWDX",14,0)
 . . I +$P(X,U,3),$P(X,U,3)<CURTM Q
"RTN","ORWDX",15,0)
 . . Q:$P(X,U,5)  S I=I+1
"RTN","ORWDX",16,0)
 . . I 'X S Y(I)=IEN_U_$P(X,U,2)_U_$P(X,U,2)
"RTN","ORWDX",17,0)
 . . E  S Y(I)=IEN_U_$P(X,U,2)_$C(9)_"<"_$P(X,U,4)_">"_U_$P(X,U,4)
"RTN","ORWDX",18,0)
 Q
"RTN","ORWDX",19,0)
ODITMBC(Y,XREF,ODLST) ;
"RTN","ORWDX",20,0)
 N CNT,NM,XRF
"RTN","ORWDX",21,0)
 S CNT=0,NM=0,XRF=XREF
"RTN","ORWDX",22,0)
 F  S CNT=$O(ODLST(CNT)) Q:'CNT  D FNDINFO(.Y,ODLST(CNT))
"RTN","ORWDX",23,0)
 Q
"RTN","ORWDX",24,0)
FNDINFO(Y,ODIEN) ;
"RTN","ORWDX",25,0)
 D FNDINFO^ORWDX1(.Y,.ODIEN)
"RTN","ORWDX",26,0)
 Q
"RTN","ORWDX",27,0)
DLGDEF(LST,DLG) ; Format mapping for a dlg
"RTN","ORWDX",28,0)
 D DLGDEF^ORWDX1(.LST,.DLG)
"RTN","ORWDX",29,0)
 Q
"RTN","ORWDX",30,0)
DLGQUIK(LST,QO) ;(NOT USED)
"RTN","ORWDX",31,0)
 D LOADRSP(.LST,QO)
"RTN","ORWDX",32,0)
 Q
"RTN","ORWDX",33,0)
LOADRSP(LST,RSPID,TRANS)      ; Load responses from 101.41 or 100
"RTN","ORWDX",34,0)
 ; RSPID:  C123456;1-3243 = cached copy,   134-3234 = cached quick
"RTN","ORWDX",35,0)
 ;         X123456;1      = change order,  134      = quick dialog
"RTN","ORWDX",36,0)
 N I,J,DLG,INST,ID,VAL,ILST,ROOT,ORLOC S ROOT=""
"RTN","ORWDX",37,0)
 I RSPID["-" S ROOT="^TMP(""ORWDXMQ"",$J,"""_RSPID_""")" G XROOT^ORWDX2
"RTN","ORWDX",38,0)
 I $E(RSPID)="X" S ROOT="^OR(100,"_+$P(RSPID,"X",2)_",4.5)"  G XROOT^ORWDX2
"RTN","ORWDX",39,0)
 I +RSPID=RSPID  S ROOT="^ORD(101.41,"_+RSPID_",6)" G XROOT^ORWDX2
"RTN","ORWDX",40,0)
 Q:ROOT=""
"RTN","ORWDX",41,0)
 G XROOT^ORWDX2
"RTN","ORWDX",42,0)
SAVE(REC,ORVP,ORNP,ORL,DLG,ORDG,ORIT,ORIFN,ORDIALOG,ORDEA,ORAPPT,ORSRC,OREVTDF) ;
"RTN","ORWDX",43,0)
 ; ORVP=DFN, ORNP=Provider, ORL=Location, DLG=Order Dialog,
"RTN","ORWDX",44,0)
 ; ORDG=Display Group, ORIT=Quick Order Dialog, ORAPPT=Appointment
"RTN","ORWDX",45,0)
 N ORDUZ,ORSTS,OREVENT,ORCAT,ORDA,ORTS,ORNEW,ORCHECK,ORLOG,ORLEAD,ORTRAIL,ORPKG,ORWP94,ORCATFN,OREVTYPE,ONPASS
"RTN","ORWDX",46,0)
 N XCNT,XCOMM,XDONE,XX  ;SBR
"RTN","ORWDX",47,0)
 S (XCOMM,XCNT)=""  ;SBR
"RTN","ORWDX",48,0)
 I $G(ORIFN)'="" D  ;SBR problem only occurs on change or renew orders
"RTN","ORWDX",49,0)
 . S XCNT=$O(^OR(100,+ORIFN,4.5,"ID","COMMENT",XCNT))  ;SBR
"RTN","ORWDX",50,0)
 . I XCNT'="" S XCOMM=$P($G(^OR(100,+ORIFN,4.5,XCNT,0)),"^",2)  ;SBR
"RTN","ORWDX",51,0)
 . I XCOMM'="" S XDONE=0,XX="" F  S XX=$O(ORDIALOG("WP",XCOMM,1,XX)) Q:XX=""  D  ;SBR
"RTN","ORWDX",52,0)
 . . I ORDIALOG("WP",XCOMM,1,XX,0)'="" S XDONE=1 Q  ;SBR
"RTN","ORWDX",53,0)
 . I XCOMM'="",'$G(XDONE),$D(ORDIALOG("WP",XCOMM)) K ORDIALOG("WP",XCOMM)  ;SBR
"RTN","ORWDX",54,0)
 S ORCATFN="" I $L($P(DLG,U,2)) S ORCATFN=$P(DLG,U,2),DLG=$P(DLG,U,1)
"RTN","ORWDX",55,0)
 ;Remove treating facility if inpatient and IMO order 26.42
"RTN","ORWDX",56,0)
 I $G(^DPT(ORVP,.1))'="",$P($G(^ORD(100.98,ORDG,0)),U)="CLINIC ORDERS" K ORDIALOG("ORTS")
"RTN","ORWDX",57,0)
 I $G(ORDIALOG("ORTS")) S ORTS=ORDIALOG("ORTS") K ORDIALOG("ORTS")
"RTN","ORWDX",58,0)
 I $G(ORDIALOG("ORSLOG")) S ORLOG=ORDIALOG("ORSLOG") K ORDIALOG("ORSLOG")
"RTN","ORWDX",59,0)
 I $D(ORDIALOG("OREVENT")) S OREVENT=ORDIALOG("OREVENT") K ORDIALOG("OREVENT")
"RTN","ORWDX",60,0)
 ;=====================================================
"RTN","ORWDX",61,0)
 ; Changed for v26.27 (RV)
"RTN","ORWDX",62,0)
 S ORCAT=$$INPT^ORCD,ORCAT=$S(ORCAT=1:"I",1:"O")
"RTN","ORWDX",63,0)
 ;I $L($G(OREVENT)) D
"RTN","ORWDX",64,0)
 ;. S ONPASS=0
"RTN","ORWDX",65,0)
 ;. S OREVTYPE=$$TYPE^OREVNTX(OREVENT)
"RTN","ORWDX",66,0)
 ;. I OREVTYPE="T" D ISPASS^OREVNTX1(.ONPASS,+OREVENT,"T")
"RTN","ORWDX",67,0)
 ;. S ORCAT=$S(OREVTYPE="A":"I",OREVTYPE="T":"I",ONPASS=1:"O",1:"O")
"RTN","ORWDX",68,0)
 ;E  S ORCAT=$S($L($P($G(^DPT(+ORVP,.1)),U)):"I",1:"O")
"RTN","ORWDX",69,0)
 ;=====================================================
"RTN","ORWDX",70,0)
 I DLG="PS MEDS" S ORWP94=1 D
"RTN","ORWDX",71,0)
 . I ORIT=$O(^ORD(101.41,"AB","PSO SUPPLY",0)) S DLG="PSO SUPPLY"
"RTN","ORWDX",72,0)
 . I ORIT=$O(^ORD(101.41,"AB","PSO OERR",0)) S DLG="PSO OERR"
"RTN","ORWDX",73,0)
 . I ORIT=$O(^ORD(101.41,"AB","PSJ OR PAT OE",0)) S DLG="PSJ OR PAT OE"
"RTN","ORWDX",74,0)
 I DLG="PSO OERR" S ORCAT="O" I $G(OREVENT("EFFECTIVE")) D
"RTN","ORWDX",75,0)
 . S ORDIALOG($O(^ORD(101.41,"B","OR GTX START DATE"_$S($G(ORWP94):"/TIME",1:""),0)),1)=OREVENT("EFFECTIVE")
"RTN","ORWDX",76,0)
 I DLG="PSJ OR PAT OE" S ORCAT="I"
"RTN","ORWDX",77,0)
 S:DLG="FHW1" ORCAT="I" S:DLG?1"FHW "2.7U1" MEAL" ORCAT="O"
"RTN","ORWDX",78,0)
 S ORVP=ORVP_";DPT(",ORL(2)=ORL_";SC(",ORL=ORL(2)
"RTN","ORWDX",79,0)
 I ORDG=$O(^ORD(100.98,"B","LAB",0)) D  ;use section
"RTN","ORWDX",80,0)
 . N OI,SUB S OI=+$G(ORDIALOG($$PTR^ORCD("OR GTX ORDERABLE ITEM"),1))
"RTN","ORWDX",81,0)
 . S SUB=$P($G(^ORD(101.43,OI,"LR")),U,6),ORDG=$$DGRP^ORMLR(SUB)
"RTN","ORWDX",82,0)
 K:'ORDG ORDG K:'ORIT ORIT ; Dgrp & Quick must be non-zero
"RTN","ORWDX",83,0)
 M ORCHECK=ORDIALOG("ORCHECK") K ORDIALOG("ORCHECK")
"RTN","ORWDX",84,0)
 S ORDIALOG=$O(^ORD(101.41,"AB",DLG,0))
"RTN","ORWDX",85,0)
 I 'ORDIALOG S ORDIALOG=$O(^ORD(101.41,"B",DLG,0))
"RTN","ORWDX",86,0)
 I $D(ORDIALOG("ORLEAD")) S ORLEAD=ORDIALOG("ORLEAD")
"RTN","ORWDX",87,0)
 I $D(ORDIALOG("ORTRAIL")) S ORTRAIL=ORDIALOG("ORTRAIL")
"RTN","ORWDX",88,0)
 D GETDLG1^ORCD(ORDIALOG)
"RTN","ORWDX",89,0)
 I $L(ORCATFN) S ORCAT=ORCATFN
"RTN","ORWDX",90,0)
 I $G(ORWP94) D
"RTN","ORWDX",91,0)
 . N SIGPRMT S SIGPRMT=$O(^ORD(101.41,"B","OR GTX SIG",0))
"RTN","ORWDX",92,0)
 . N INSPRMT S INSPRMT=$O(^ORD(101.41,"B","OR GTX INSTRUCTIONS",0))
"RTN","ORWDX",93,0)
 . I $L($G(ORDIALOG(SIGPRMT,1))) S ORDIALOG(INSPRMT,"FORMAT")="@"
"RTN","ORWDX",94,0)
 . I ORCAT="O" S ORPKG=$O(^DIC(9.4,"C","PSO",0))
"RTN","ORWDX",95,0)
 . I ORCAT="I" S ORPKG=$O(^DIC(9.4,"C","PSJ",0))
"RTN","ORWDX",96,0)
 S ORSRC=$G(ORSRC)
"RTN","ORWDX",97,0)
 D DELPI^ORWDX1 ;delete empty PI
"RTN","ORWDX",98,0)
 I $G(ORIFN)="" D  ; new order
"RTN","ORWDX",99,0)
 . D EN^ORCSAVE
"RTN","ORWDX",100,0)
 . S REC="" I ORIFN D GETBYIFN^ORWORR(.REC,ORIFN)
"RTN","ORWDX",101,0)
 . I '$D(^TMP("ORECALL",$J,ORDIALOG)) M ^TMP("ORECALL",$J,ORDIALOG)=ORDIALOG
"RTN","ORWDX",102,0)
 E  D
"RTN","ORWDX",103,0)
 . N OR0
"RTN","ORWDX",104,0)
 . S OR0=$G(^OR(100,+ORIFN,0)),ORSTS=$P($G(^(3)),U,3),ORDG=$P(OR0,U,11)
"RTN","ORWDX",105,0)
 . I $L($P(OR0,U,17)),ORSTS=10 S OREVENT=$P(OR0,U,17),OREVENT("TS")=$P(OR0,U,13)
"RTN","ORWDX",106,0)
 . D XX^ORCSAVE ; edit order
"RTN","ORWDX",107,0)
 . S REC="" S ORIFN=+ORIFN_";"_ORDA D GETBYIFN^ORWORR(.REC,ORIFN)
"RTN","ORWDX",108,0)
 Q
"RTN","ORWDX",109,0)
SENDED(ORWLST,ORIENS,TS,LOC) ; Release EDOs to svc
"RTN","ORWDX",110,0)
 N OK,ORVP,ORWERR,ORSIGST,ORDA,ORNATURE,ORIX,X,PTEVT,ORIFN,J,EVENT,LOCK,OR3
"RTN","ORWDX",111,0)
 S ORWERR="",ORIX=0,LOC=LOC_";SC("
"RTN","ORWDX",112,0)
 F  S ORIX=$O(ORIENS(ORIX)) Q:'ORIX  D  Q:ORWERR]""
"RTN","ORWDX",113,0)
 . S (ORIFN,ORWLST(ORIX))=ORIENS(ORIX)
"RTN","ORWDX",114,0)
 . S PTEVT=$P(^OR(100,+ORIFN,0),U,17)
"RTN","ORWDX",115,0)
 . I PTEVT D
"RTN","ORWDX",116,0)
 .. I $D(EVENT(PTEVT)) S LOCK=1 Q
"RTN","ORWDX",117,0)
 .. S LOCK=$$LCKEVT^ORX2(PTEVT) S:LOCK EVENT(PTEVT)=""
"RTN","ORWDX",118,0)
 . I 'LOCK S ORWERR="1^delayed event is locked - another user is processing orders for this event" S ORWLST(ORIX)=ORWLST(ORIX)_"^E^"_ORWERR Q
"RTN","ORWDX",119,0)
 . S ORDA=$P(ORIFN,";",2) S:'ORDA ORDA=1
"RTN","ORWDX",120,0)
 . S ORVP=$P($G(^OR(100,+ORIFN,0)),U,2)
"RTN","ORWDX",121,0)
 . I $D(^OR(100,+ORIFN,8,ORDA,0)) D
"RTN","ORWDX",122,0)
 .. S ORSIGST=$P($G(^(0)),U,4),ORNATURE=$P($G(^(0)),U,12) ;naked references refer to OR(100,+ORIFN,8,ORDA on line above
"RTN","ORWDX",123,0)
 . S OK=$$LOCK1^ORX2(ORIFN) I 'OK S ORWERR="1^"_$P(OK,U,2)
"RTN","ORWDX",124,0)
 . I OK,$G(LOCK) D
"RTN","ORWDX",125,0)
 .. S OR3=$G(^OR(100,+ORIFN,3)) I $P(OR3,"^",3)'=10!($P(OR3,"^",9)]"") D UNLK1^ORX2(ORIENS(ORIX)) Q  ;order already released or has a parent
"RTN","ORWDX",126,0)
 .. S:$G(LOC) $P(^OR(100,+ORIFN,0),U,10)=LOC ;set location
"RTN","ORWDX",127,0)
 .. S:$G(TS) $P(^OR(100,+ORIFN,0),U,13)=TS ;set specialty
"RTN","ORWDX",128,0)
 .. D EN2^ORCSEND(ORIENS(ORIX),ORSIGST,ORNATURE,.ORWERR),UNLK1^ORX2(ORIENS(ORIX)) ;add ,LOCK to if statement for 195
"RTN","ORWDX",129,0)
 . I $L(ORWERR) S ORWLST(ORIX)=ORWLST(ORIX)_"^E^"_ORWERR Q
"RTN","ORWDX",130,0)
 . E  D
"RTN","ORWDX",131,0)
 .. S PTEVT=$P($G(^OR(100,+ORIENS(ORIX),0)),U,17)
"RTN","ORWDX",132,0)
 .. D:$$TYPE^OREVNTX(PTEVT)="M" SAVE^ORMEVNT1(ORIENS(ORIX),PTEVT,2)
"RTN","ORWDX",133,0)
 . S X="RS"
"RTN","ORWDX",134,0)
 . S $P(ORWLST(ORIX),U,2)=X
"RTN","ORWDX",135,0)
 S J=0 F  S J=$O(EVENT(J)) Q:'+J  D UNLEVT^ORX2(J) ;195
"RTN","ORWDX",136,0)
 Q
"RTN","ORWDX",137,0)
SEND(ORWLST,DFN,ORNP,ORL,ES,ORWREC) ; Sign
"RTN","ORWDX",138,0)
 ; DFN=Patient, ORNP=Provider, ORL=Location, ES=Encrypted ES code
"RTN","ORWDX",139,0)
 ; ORWREC(n)=ORIFN;Action^Signature Sts^Release Sts^Nature of Order
"RTN","ORWDX",140,0)
SEND1 N ORVP,ORWI,ORWERR,ORWREL,ORWSIG,ORWNATR,ORDERID,ORBEF,ORLR,ORLAB,X,I
"RTN","ORWDX",141,0)
 S ORVP=DFN_";DPT(",ORL=ORL_";SC(",ORL(2)=ORL,ORWLST=0
"RTN","ORWDX",142,0)
 F I="LR","VBEC" S X=+$O(^DIC(9.4,"C",I,0)) S:X ORLR(X)=1
"RTN","ORWDX",143,0)
 S ORWI=0 F  S ORWI=$O(ORWREC(ORWI)) Q:'ORWI  D
"RTN","ORWDX",144,0)
 . S X=ORWREC(ORWI),ORWERR=""
"RTN","ORWDX",145,0)
 . S ORDERID=$P(X,U),ORWSIG=$P(X,U,2),ORWREL=$P(X,U,3),ORWNATR=$P(X,U,4)
"RTN","ORWDX",146,0)
 . S ORBEF=0
"RTN","ORWDX",147,0)
 . I '$D(^OR(100,+ORDERID,0)) Q
"RTN","ORWDX",148,0)
 . I $D(^OR(100,+ORDERID,8,+$P(ORDERID,";",2),0)) S ORBEF=$P(^OR(100,+ORDERID,8,+$P(ORDERID,";",2),0),U,15)
"RTN","ORWDX",149,0)
 . S:$D(^OR(100,+ORDERID,8,+$P(ORDERID,";",2),0)) ORWNATR=$S($P(^OR(100,+ORDERID,8,+$P(ORDERID,";",2),0),"^",4)=3:"",1:ORWNATR)
"RTN","ORWDX",150,0)
 . S ORWERR=$$CHKACT^ORWDXR(ORDERID,ORWSIG,ORWREL,ORWNATR)
"RTN","ORWDX",151,0)
 . I $L(ORWERR) S ORWERR="1^"_ORWERR
"RTN","ORWDX",152,0)
 . I '$L(ORWERR) D
"RTN","ORWDX",153,0)
 .. I $G(ORLR(+$P(^OR(100,+ORDERID,0),U,14))),'$G(ORLAB) D  ; lab batch start
"RTN","ORWDX",154,0)
 ... I $L($T(BHS^ORMBLD)) D BHS^ORMBLD(ORVP) S ORLAB=1
"RTN","ORWDX",155,0)
 .. N OK S OK=$$LOCK1^ORX2(ORDERID) I 'OK S ORWERR="1^"_$P(OK,U,2)
"RTN","ORWDX",156,0)
 .. I OK D EN^ORCSEND(ORDERID,"",ORWSIG,ORWREL,ORWNATR,"",.ORWERR),UNLK1^ORX2(ORDERID)
"RTN","ORWDX",157,0)
 . S ORWLST(ORWI)=ORDERID,X=""
"RTN","ORWDX",158,0)
 . I $L(ORWERR) S ORWLST(ORWI)=ORWLST(ORWI)_"^E^"_ORWERR Q
"RTN","ORWDX",159,0)
 . I ORWREL,((ORBEF=10)!(ORBEF=11)),($P(^OR(100,+ORDERID,3),U,3)'=10) S X="R"
"RTN","ORWDX",160,0)
 . I ORWSIG'=2 S X=X_"S"
"RTN","ORWDX",161,0)
 . S $P(ORWLST(ORWI),U,2)=X
"RTN","ORWDX",162,0)
 I $G(ORLAB) D BTS^ORMBLD(ORVP)
"RTN","ORWDX",163,0)
 ;DSS/SMP - BEGIN MOD - for Order Group ID call
"RTN","ORWDX",164,0)
 I $L(ES)>1,$T(ORDERID^ORATRORG)'="" D
"RTN","ORWDX",165,0)
 .N VFDOID S VFDOID=$$ORDERID^ORATRORG(.ORWREC,1)
"RTN","ORWDX",166,0)
 ;DSS/SMP - END MOD
"RTN","ORWDX",167,0)
 I $D(ORWLST)>9 D
"RTN","ORWDX",168,0)
 . N I,A
"RTN","ORWDX",169,0)
 . S I=0 F  S I=$O(ORWLST(I)) Q:I=""  S A=$G(ORWLST(I)) I A["Invalid Procedure, Inactive, no Imaging Type" D SM^ORWDX2(A)
"RTN","ORWDX",170,0)
  Q
"RTN","ORWDX",171,0)
DLGID(VAL,ORIFN) ; return dlg IEN for order
"RTN","ORWDX",172,0)
 S VAL=$P(^OR(100,+ORIFN,0),U,5)
"RTN","ORWDX",173,0)
 S VAL=$S($P(VAL,";",2)="ORD(101.41,":+VAL,1:0)
"RTN","ORWDX",174,0)
 Q
"RTN","ORWDX",175,0)
FORMID(VAL,ORIFN) ; Base dlg FormID for an order
"RTN","ORWDX",176,0)
 N DLG
"RTN","ORWDX",177,0)
 S VAL=0,DLG=$P(^OR(100,+ORIFN,0),U,5)
"RTN","ORWDX",178,0)
 Q:$P(DLG,";",2)'="ORD(101.41,"
"RTN","ORWDX",179,0)
 D FORMID^ORWDXM(.VAL,+DLG)
"RTN","ORWDX",180,0)
 Q
"RTN","ORWDX",181,0)
AGAIN(VAL,DLG) ; return true to keep dlg for another order
"RTN","ORWDX",182,0)
 S VAL=''$P($G(^ORD(101.41,DLG,0)),U,9)
"RTN","ORWDX",183,0)
 Q
"RTN","ORWDX",184,0)
DGRP(VAL,DLG) ; Display grp pointer for a dlg
"RTN","ORWDX",185,0)
 S DLG=$S($E(DLG)="`":+$P(DLG,"`",2),1:$O(^ORD(101.41,"AB",DLG,0))) ;kcm
"RTN","ORWDX",186,0)
 S VAL=$P($G(^ORD(101.41,DLG,0)),U,5)
"RTN","ORWDX",187,0)
 Q
"RTN","ORWDX",188,0)
DGNM(VAL,NM) ; Display grp pointer for name
"RTN","ORWDX",189,0)
 S VAL=$O(^ORD(100.98,"B",NM,0))
"RTN","ORWDX",190,0)
 Q
"RTN","ORWDX",191,0)
WRLST(LST,LOC) ; List of dlgs for writing orders
"RTN","ORWDX",192,0)
 G WRLST1^ORWDX1
"RTN","ORWDX",193,0)
MSG(LST,IEN) ; Msg text for orderable item
"RTN","ORWDX",194,0)
 N I
"RTN","ORWDX",195,0)
 S I=0 F  S I=$O(^ORD(101.43,IEN,8,I)) Q:I'>0  S LST(I)=^(I,0)
"RTN","ORWDX",196,0)
 Q
"RTN","ORWDX",197,0)
DISMSG(VAL,IEN) ; Disabled mge for ordering dlg
"RTN","ORWDX",198,0)
 S VAL=$P($G(^ORD(101.41,+IEN,0)),U,3)
"RTN","ORWDX",199,0)
 Q
"RTN","ORWDX",200,0)
LOCK(OK,DFN) ; Attempt to lock pt for ordering
"RTN","ORWDX",201,0)
 S OK=$$LOCK^ORX2(DFN)
"RTN","ORWDX",202,0)
 Q
"RTN","ORWDX",203,0)
UNLOCK(OK,DFN) ; Unlock pt for ordering
"RTN","ORWDX",204,0)
 D UNLOCK^ORX2(DFN) S OK=1
"RTN","ORWDX",205,0)
 Q
"RTN","ORWDX",206,0)
LOCKORD(OK,ORIFN) ; Attempt to lock order
"RTN","ORWDX",207,0)
 S OK=$$LOCK1^ORX2(ORIFN)
"RTN","ORWDX",208,0)
 Q
"RTN","ORWDX",209,0)
UNLKORD(OK,ORIFN) ; Unlock order
"RTN","ORWDX",210,0)
 D UNLK1^ORX2(ORIFN) S OK=1
"RTN","ORWDX",211,0)
 Q
"RTN","ORWDX",212,0)
UNLKOTH(OK,ORIFN) ; Unlock pt not by this session
"RTN","ORWDX",213,0)
 K ^XTMP("ORPTLK-"_ORIFN) S OK=1
"RTN","ORWDX",214,0)
 Q
"RTN","XQALSET")
0^3^B73846237
"RTN","XQALSET",1,0)
XQALSET ;ISC-SF.SEA/JLI - SETUP ALERTS ;4/10/07  14:06
"RTN","XQALSET",2,0)
 ;;8.0;KERNEL;**1,6,65,75,114,125,173,207,285,443,602**;Jul 10, 1995;Build 3
"RTN","XQALSET",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified
"RTN","XQALSET",4,0)
 ;;
"RTN","XQALSET",5,0)
 Q
"RTN","XQALSET",6,0)
 ; Original entry point - throw away return value since no value expected
"RTN","XQALSET",7,0)
SETUP ;
"RTN","XQALSET",8,0)
 N I S I=$$SETUP1() K XQALERR
"RTN","XQALSET",9,0)
 Q
"RTN","XQALSET",10,0)
 ;
"RTN","XQALSET",11,0)
SETUP1() ; .SR Returns a string beginning with 1 if successful, 0 if not successful, the second piece is the IEN in the Alert Tracking File and the third piece is the value of XQAID.
"RTN","XQALSET",12,0)
 ; If not successful XQALERR is defined and contains reason for failure.
"RTN","XQALSET",13,0)
 K XQALERR
"RTN","XQALSET",14,0)
 I $O(XQA(0))="" S XQALERR="No recipient list in XQA array" Q 0
"RTN","XQALSET",15,0)
 I '($D(XQAMSG)#2)!($G(XQAMSG)="") S XQALERR="No valid XQAMSG for display" Q 0
"RTN","XQALSET",16,0)
 N X,XQI,XQJ,XQX,XQK,XQACOMNT,XQARESET,DA,XQADA,XQALTYPE
"RTN","XQALSET",17,0)
 S XQALTYPE="INITIAL RECIPIENT"
"RTN","XQALSET",18,0)
 S XQAOPT1=$S('($D(XQAROU)#2):U,XQAROU'[U:U_XQAROU,1:XQAROU),XQAOPT1=$S(XQAOPT1'=U:XQAOPT1,$D(XQAOPT)#2:XQAOPT_U,1:XQAOPT1) S:XQAOPT1=U XQAOPT1=U_" "
"RTN","XQALSET",19,0)
NOW S XQX=$$NOW^XLFDT()
"RTN","XQALSET",20,0)
 S:$S('$D(XQAID):1,XQAID="":1,1:0) XQAID="NO-ID" S:XQAID[";" XQAID=$P(XQAID,";") S XQA1=XQAID,XQI=XQX
"RTN","XQALSET",21,0)
 S XQAID=$$SETIEN(XQA1,XQX),XQADA=""
"RTN","XQALSET",22,0)
 Q $$REENT()
"RTN","XQALSET",23,0)
 ;
"RTN","XQALSET",24,0)
REENT() ; Entry for forwarding, etc.
"RTN","XQALSET",25,0)
 N RETVAL S RETVAL=1
"RTN","XQALSET",26,0)
 K ^TMP("XQAGROUP",$J) ; P443 - clear location for storage of groups processed
"RTN","XQALSET",27,0)
 N XQADATIM,XQALIST,XQALIST1,XQNRECIP S XQNRECIP=0 S XQADATIM=$$NOW^XLFDT()
"RTN","XQALSET",28,0)
 S XQALIN1=$S($D(XQAID)#2:XQAID,1:"")_U_$E(XQAMSG,1,80)_"^1^"_$S(XQAOPT1=U:"D",1:"R")_U_$S($D(XQACTMSG):$E(XQACTMSG,1,40),1:"")_U_XQAOPT1
"RTN","XQALSET",29,0)
 S:$D(XQACNDEL) $P(XQALIN1,U,9)=1 S:$D(XQASURO) $P(XQALIN1,U,12)=XQASURO S:$D(XQASUPV) $P(XQALIN1,U,13)=XQASUPV S:$D(XQAREVUE) $P(XQALIN1,U,14)=XQAREVUE
"RTN","XQALSET",30,0)
 S XQALIN=XQX_U_XQALIN1,XQJ=0
"RTN","XQALSET",31,0)
 K XQALIN1 S:$D(XQADATA) XQALIN1=XQADATA
"RTN","XQALSET",32,0)
LOOP1 S XQJ=$O(XQA(" ")) I XQJ'="" K:"G.g."'[$E(XQJ_",,",1,2) XQA(XQJ) D:$D(XQA(XQJ)) GROUP^XQALSET1 G LOOP1
"RTN","XQALSET",33,0)
LOOP2 ; RE-ENTRY FOR FORWARDING IF ALL RECIPIENTS ARE UNDELIVERABLE
"RTN","XQALSET",34,0)
 N:'$D(XQAUSER) XQAUSER M XQALIST=XQA F I=0:0 S I=$O(XQALIST(I)) Q:I'>0  S XQALIST(I,XQALTYPE)="" I '$D(XQAUSER) S XQAUSER=I ; SAVE ORIGINAL LIST OF RECIPIENTS AND REASON
"RTN","XQALSET",35,0)
 ; The following section of code was added to provide a generalized way to handle surrogates
"RTN","XQALSET",36,0)
 F XQJ=0:0 S XQJ=$O(XQA(XQJ)) Q:XQJ=""  D
"RTN","XQALSET",37,0)
 . N X S X=$$ACTVSURO^XQALSURO(XQJ) I X>0 D  ; Modified to get final surrogate if a sequence of them
"RTN","XQALSET",38,0)
 . . S XQA(X)="" K XQA(XQJ) ; Add Surrogate to XQA array, delete XQJ entry
"RTN","XQALSET",39,0)
 . . S XQALIST(X,$O(XQALIST(XQJ,""))_"-SURROGATE")="" ; Add Surrogate to XQALIST with same type as original
"RTN","XQALSET",40,0)
 . . S XQALIST(X,"z AS_SURO",XQJ)="" ; Mark user as in list as a surrogate, subscript for surrogate to
"RTN","XQALSET",41,0)
 . . S XQALIST(XQJ,"z TO_SURO",X)=""
"RTN","XQALSET",42,0)
 . . Q
"RTN","XQALSET",43,0)
 . Q
"RTN","XQALSET",44,0)
 ;
"RTN","XQALSET",45,0)
 S XQJ=0
"RTN","XQALSET",46,0)
LOOP ;
"RTN","XQALSET",47,0)
 S XQJ=$O(XQA(XQJ)) G:XQJ="" WRAP
"RTN","XQALSET",48,0)
 ;
"RTN","XQALSET",49,0)
 I '(+$$ACTIVE^XUSER(XQJ)) K XQA(XQJ) N XX S XX=$O(XQALIST(XQJ,"")) K XQALIST(XQJ,XX) S XQALIST(XQJ,XX_"-UNDELIVERABLE")="" G LOOP ;Don't send to users that can't sign-on
"RTN","XQALSET",50,0)
 ;
"RTN","XQALSET",51,0)
 I '$D(^XTV(8992,XQJ,0)) D  I '$D(^XTV(8992,XQJ,0)) S ^(0)=XQJ
"RTN","XQALSET",52,0)
 . N FDA,IENS
"RTN","XQALSET",53,0)
 . F  D  Q:'$D(DIERR)  Q:'$D(^TMP("DIERR",$J,"E",110))&'$D(^TMP("DIERR",$J,"E",111))
"RTN","XQALSET",54,0)
 . . K DIERR,^TMP("DIERR",$J)
"RTN","XQALSET",55,0)
 . . S FDA=$NA(^TMP($J,"XQALSET")) K @FDA S @FDA@(8992,"+1,",.01)=XQJ
"RTN","XQALSET",56,0)
 . . S IENS(1)=XQJ
"RTN","XQALSET",57,0)
 . . D UPDATE^DIE("S",FDA,"IENS")
"RTN","XQALSET",58,0)
 . . Q
"RTN","XQALSET",59,0)
 . Q
"RTN","XQALSET",60,0)
 L +^XTV(8992,XQJ):10 S XQXI=XQX S:'$D(^XTV(8992,XQJ,"XQA",0)) ^(0)="^8992.01DA^"
"RTN","XQALSET",61,0)
REP I $D(^XTV(8992,XQJ,"XQA",XQXI,0)) S XQXI=XQXI+.00000001 G REP
"RTN","XQALSET",62,0)
 S ^XTV(8992,XQJ,"XQA",XQXI,0)=XQALIN S:$D(XQALIN1) ^(1)=XQALIN1 S:$D(XQAGUID)!$D(XQADFN) ^(3)=$G(XQAGUID)_U_$G(XQADFN) S:$D(XQARESET) ^(2)=XQAUSER_U_XQX_U_$G(XQACOMNT) S ^(0)=$P(^XTV(8992,XQJ,"XQA",0),U,1,2)_U_XQXI_U_($P(^(0),U,4)+1)
"RTN","XQALSET",63,0)
 I $D(XQATEXT) S:($D(XQATEXT)#2) XQATEXT(.1)=XQATEXT D WP^DIE(8992.01,(XQXI_","_XQJ_","),4,"","XQATEXT") ; P443 PUT DATA IN XQATEXT INTO ARRAY
"RTN","XQALSET",64,0)
 L -^XTV(8992,XQJ)
"RTN","XQALSET",65,0)
 K XQA(XQJ) S:XQAID'="" ^XTV(8992,"AXQA",XQAID,XQJ,XQXI)="",^XTV(8992,"AXQAN",XQA1,XQJ,XQXI)=""
"RTN","XQALSET",66,0)
 S XQNRECIP=XQNRECIP+1
"RTN","XQALSET",67,0)
 G LOOP
"RTN","XQALSET",68,0)
 ;
"RTN","XQALSET",69,0)
WRAP ;
"RTN","XQALSET",70,0)
 M XQALIST1=XQALIST
"RTN","XQALSET",71,0)
 I XQNRECIP=0,'$$SNDNACTV(XQAID) S RETVAL=0,XQALERR="NO ACTIVE RECIPIENTS - OLDER TIU ALERTS"
"RTN","XQALSET",72,0)
 E  I XQNRECIP=0 D  I $D(XQA) S XQACOMNT=$E("None of recipients were active users. "_$G(XQACOMNT),1,245),XQNRECIP=1,XQARESET=1 K XQALIST G LOOP2 ; SET NUMBER OF RECIPIENTS TO 1 SO WE WON'T COME HERE AGAIN
"RTN","XQALSET",73,0)
 . N XQAA,XQJ F XQI=0:0 S XQI=$O(XQALIST(XQI)) Q:XQI'>0  D GETBKUP^XQALDEL(.XQAA,XQI) S XQALTYPE="BACKUP REVIEWER" F XQJ=0:0 S XQJ=$O(XQAA(XQJ)) Q:XQJ'>0  S XQA(XQAA(XQJ))=""
"RTN","XQALSET",74,0)
 . I $D(XQA) D CHEKACTV^XQALSET1(.XQA)
"RTN","XQALSET",75,0)
 . I '$D(XQA) S XQJ="G.XQAL UNPROCESSED ALERTS" D GROUP^XQALSET1 S XQALTYPE="UNPROCESSED ALERTS MAIL GROUP" ;D GETMLGRP(.XQA,XQI) ; COULDN'T FIND ANY BACKUP, GET A MAILGROUP AND MEMBERS TO SEND IT TO
"RTN","XQALSET",76,0)
 . I '$D(XQA) S XQJ="G.PATCHES" D GROUP^XQALSET1 S XQALTYPE="LAST HOPE" ; Last gasp, send it to G.PATCHES
"RTN","XQALSET",77,0)
 . I '$D(XQA) S XQJ="G.PATCH" D GROUP^XQALSET1 S XQALTYPE="LAST HOPE" ; Last gasp, send it to G.PATCH
"RTN","XQALSET",78,0)
 . I '$D(XQA) S RETVAL=0,XQALERR="Could not find any active user to send it to" ; Should not get here, this is only if all backups and mail groups tried don't have any active users
"RTN","XQALSET",79,0)
 . Q
"RTN","XQALSET",80,0)
 ; END OF JLI 030129 INSERTION P285
"RTN","XQALSET",81,0)
 ; moved recording of users in Alert Tracking file to here to include all of them  030220
"RTN","XQALSET",82,0)
 ; modified code to use FM calls instead of direct global references
"RTN","XQALSET",83,0)
 I RETVAL,$G(XQADA)'>0,XQAID'="" D SETTRACK ; moved to here to avoid tracking entries with no users
"RTN","XQALSET",84,0)
 ;
"RTN","XQALSET",85,0)
 I RETVAL,$G(XQADA)>0 L +^XTV(8992.1,XQADA):10 D  L -^XTV(8992.1,XQADA) ; 030131
"RTN","XQALSET",86,0)
 . F XQJ=0:0 S XQJ=$O(XQALIST1(XQJ)) Q:XQJ'>0  D
"RTN","XQALSET",87,0)
 . . N NCOUNT,SUBSCRPT,SUBSCRPN,KCNT,IENVAL
"RTN","XQALSET",88,0)
 . . S IENVAL=XQADA_",",KCNT=$$FIND1^DIC(8992.11,","_IENVAL,"Q",XQJ)
"RTN","XQALSET",89,0)
 . . S FDA=$NA(^TMP($J,"XQALSET")) K @FDA I KCNT=0 S @FDA@(8992.11,"+1,"_IENVAL,.01)=XQJ,KCNT="+1"
"RTN","XQALSET",90,0)
 . . S IENVAL=","_KCNT_","_IENVAL,NCOUNT=1 S SUBSCRPT="" F  S SUBSCRPT=$O(XQALIST1(XQJ,SUBSCRPT)) Q:SUBSCRPT=""  I $E(SUBSCRPT,1)'="z" D
"RTN","XQALSET",91,0)
 . . . S SUBSCRPN=$$FIND1^DIC(8992.2,"","X",SUBSCRPT) I SUBSCRPN'>0 D
"RTN","XQALSET",92,0)
 . . . . N FDA1,IENROOT S FDA1=$NA(^TMP($J,"XQALSET1")) K @FDA1 S @FDA1@(8992.2,"+1,",.01)=SUBSCRPT D UPDATE^DIE("",FDA1,"IENROOT") S SUBSCRPN=$G(IENROOT(1))
"RTN","XQALSET",93,0)
 . . . . Q
"RTN","XQALSET",94,0)
 . . . S NCOUNT=NCOUNT+1,@FDA@(8992.111,"+"_NCOUNT_IENVAL,.01)=SUBSCRPN,@FDA@(8992.111,"+"_NCOUNT_IENVAL,.04)=XQADATIM
"RTN","XQALSET",95,0)
 . . . Q
"RTN","XQALSET",96,0)
 . . I $D(XQALIST1(XQJ,"z TO_SURO")) S @FDA@(8992.111,"+"_NCOUNT_IENVAL,.02)=$O(XQALIST1(XQJ,"z TO_SURO",0))
"RTN","XQALSET",97,0)
 . . I $D(XQALIST1(XQJ,"z AS_SURO")) D
"RTN","XQALSET",98,0)
 . . . S @FDA@(8992.111,"+"_NCOUNT_IENVAL,.03)="Y"
"RTN","XQALSET",99,0)
 . . . N XQK S NCOUNT=NCOUNT+1 F XQK=0:0 S XQK=$O(XQALIST1(XQJ,"z AS_SURO",XQK)) Q:XQK'>0  S @FDA@(8992.113,"+"_NCOUNT_IENVAL,.01)=XQK,@FDA@(8992.113,"+"_NCOUNT_IENVAL,.02)=XQADATIM
"RTN","XQALSET",100,0)
 . . . Q
"RTN","XQALSET",101,0)
 . . S SUBSCRPT=$O(XQALIST1(XQJ,"")) I SUBSCRPT'["INITIAL" S SUBSCRPT=$P(SUBSCRPT,"-") D  ; FORWARDING
"RTN","XQALSET",102,0)
 . . . S SUBSCRPN=$$FIND1^DIC(8992.2,"","X",SUBSCRPT) I SUBSCRPN'>0 D
"RTN","XQALSET",103,0)
 . . . . N FDA1,IENROOT S FDA1=$NA(^TMP($J,"XQALSET1")) K @FDA1 S @FDA1@(8992.2,"+1,",.01)=SUBSCRPT D UPDATE^DIE("",FDA1,"IENROOT") S SUBSCRPN=$G(IENROOT(1))
"RTN","XQALSET",104,0)
 . . . . Q
"RTN","XQALSET",105,0)
 . . . S NCOUNT=NCOUNT+1,@FDA@(8992.112,"+"_NCOUNT_IENVAL,.01)=XQADATIM,@FDA@(8992.112,"+"_NCOUNT_IENVAL,.02)=SUBSCRPN I $G(XQACOMNT)'="" S @FDA@(8992.112,"+"_NCOUNT_IENVAL,1.01)=XQACOMNT
"RTN","XQALSET",106,0)
 . . . I $G(XQAUSER)>0 S @FDA@(8992.112,"+"_NCOUNT_IENVAL,.03)=XQAUSER
"RTN","XQALSET",107,0)
 . . . Q
"RTN","XQALSET",108,0)
 . . N IENSTR D UPDATE^DIE("",FDA,"IENSTR")
"RTN","XQALSET",109,0)
 . . ;DSS/SMP Begin Mod - 07/17/2012
"RTN","XQALSET",110,0)
 . . D TRANSFER^ORATR(XQADA)
"RTN","XQALSET",111,0)
 . . ;DSS/SMP End Mod - 07/17/2012
"RTN","XQALSET",112,0)
 . . Q
"RTN","XQALSET",113,0)
 . Q
"RTN","XQALSET",114,0)
 ;
"RTN","XQALSET",115,0)
 I RETVAL S RETVAL=RETVAL_U_$G(XQADA)_U_XQAID
"RTN","XQALSET",116,0)
 K:XQAID'="" ^XTV(8992,"AXQA",XQAID,0,0)
"RTN","XQALSET",117,0)
 K ^TMP("XQAGROUP",$J) ; P443 - clear global used to track processing of groups
"RTN","XQALSET",118,0)
 K XQA,XQALIN,XQALIN1,XQAMSG,XQAID,XQAFLG,XQAOPT,XQAOPT1,XQAROU,XQADATA,XQI,XQX,XQJ,XQK,XQA1,XQACTMSG,XQJ,XQXI,XQAARCH,XQACNDEL,XQAREVUE,XQASUPV,XQASURO,XQATEXT
"RTN","XQALSET",119,0)
 Q RETVAL
"RTN","XQALSET",120,0)
 ;
"RTN","XQALSET",121,0)
SNDNACTV(XQAID) ; Determine if we go ahead and send alerts addressed only to inactive users to backup reviewers
"RTN","XQALSET",122,0)
 N XVAL
"RTN","XQALSET",123,0)
 I $E(XQAID,1,3)="TIU" S XVAL=$E($P(XQAID,";"),4,99),XVAL=$$GET1^DIQ(8925,XVAL_",",1201,"I") I XVAL>0,$$FMDIFF^XLFDT(DT,XVAL)>60 Q 0
"RTN","XQALSET",124,0)
 Q 1
"RTN","XQALSET",125,0)
 ;
"RTN","XQALSET",126,0)
SETIEN(XQA1,XQI) ; determine unique XQAID value for alert
"RTN","XQALSET",127,0)
 N XQAID
"RTN","XQALSET",128,0)
 S:$G(XQA1)="" XQA1="NO-ID" F  S XQAID=XQA1_";"_DUZ_";"_XQI L +^XTV(8992,"AXQA",XQAID):10 D  L -^XTV(8992,"AXQA",XQAID) Q:XQI=""  S XQI=XQI+.00000001
"RTN","XQALSET",129,0)
 . I $D(^XTV(8992,"AXQA",XQAID)) Q
"RTN","XQALSET",130,0)
 . S ^XTV(8992,"AXQA",XQAID,0,0)="",XQI=""
"RTN","XQALSET",131,0)
 . Q
"RTN","XQALSET",132,0)
 Q XQAID
"RTN","XQALSET",133,0)
 ;
"RTN","XQALSET",134,0)
SETTRACK ; Setup entry in Alert Tracking file
"RTN","XQALSET",135,0)
 ; Note: if there are error messages or we can't create an entry for some reason, it simply returns and continues
"RTN","XQALSET",136,0)
 N FDA,IENS,XQA2,DIERR
"RTN","XQALSET",137,0)
 S XQADA=0
"RTN","XQALSET",138,0)
 S XQA2=XQA1 I XQA2[",",$P(XQA2,",",3)'="" S XQA2=$P(XQA2,",")_","_$P(XQA2,",",3)
"RTN","XQALSET",139,0)
 F  D  Q:'$D(DIERR)  Q:'$D(^TMP("DIERR",$J,"E",111))
"RTN","XQALSET",140,0)
 . K DIERR,^TMP("DIERR",$J)
"RTN","XQALSET",141,0)
 . S FDA=$NA(^TMP($J,"XQALSET")) K @FDA
"RTN","XQALSET",142,0)
 . S @FDA@(8992.1,"+1,",.01)=XQAID D UPDATE^DIE("",FDA,"IENS")
"RTN","XQALSET",143,0)
 . K @FDA
"RTN","XQALSET",144,0)
 . Q
"RTN","XQALSET",145,0)
 I $D(DIERR) Q  ;S XQDIERR1=DIERR M XQDIERR=^TMP("DIERR",$J) Q
"RTN","XQALSET",146,0)
 Q:IENS(1)'>0  S (DA,XQADA)=IENS(1)
"RTN","XQALSET",147,0)
 S IENS=IENS(1)_",",@FDA@(8992.1,IENS,.02)=XQX,^(.03)=XQA2,^(.05)=DUZ,^(1.01)=XQAMSG
"RTN","XQALSET",148,0)
 I $D(XQAARCH) S X=$$FMADD^XLFDT(DT,XQAARCH) I X>DT S @FDA@(8992.1,IENS,.08)=X
"RTN","XQALSET",149,0)
 I $P(XQA1,",")="OR",$P(XQA1,",",2)>0 S @FDA@(8992.1,IENS,.04)=$P(XQA1,",",2)
"RTN","XQALSET",150,0)
 I $D(ZTQUEUED) S @FDA@(8992.1,IENS,.06)=1
"RTN","XQALSET",151,0)
 I $D(XQAOPT)#2 S @FDA@(8992.1,IENS,1.02)=XQAOPT
"RTN","XQALSET",152,0)
 I $D(XQAROU)#2 N XQAXX S XQAXX=$S(XQAROU[U:XQAROU,1:U_XQAROU) I $P(XQAXX,U,2)'="" S:$P(XQAXX,U)'="" @FDA@(8992.1,IENS,1.03)=$P(XQAXX,U) S @FDA@(8992.1,IENS,1.04)=$P(XQAXX,U,2)
"RTN","XQALSET",153,0)
 I $D(XQACTMSG) S @FDA@(8992.1,IENS,1.05)=XQACTMSG
"RTN","XQALSET",154,0)
 I $D(XQADATA) S @FDA@(8992.1,IENS,2)=XQADATA
"RTN","XQALSET",155,0)
 I $D(XQAGUID) S @FDA@(8992.1,IENS,3.01)=XQAGUID
"RTN","XQALSET",156,0)
 I $D(XQADFN) S @FDA@(8992.1,IENS,.04)=XQADFN
"RTN","XQALSET",157,0)
 D FILE^DIE("KS",FDA)
"RTN","XQALSET",158,0)
 I $D(XQATEXT) D WP^DIE(8992.1,IENS,4,"","XQATEXT")
"RTN","XQALSET",159,0)
 Q
"RTN","XQALSET",160,0)
 ;
"RTN","XQALSET",161,0)
CHEKUSER(XQAUSER) ; .SR Returns 0 if no valid user or surrogate, otherwise returns IEN of user or surrogate
"RTN","XQALSET",162,0)
 Q $$CHEKUSER^XQALSET1(XQAUSER)
"RTN","XQALSET",163,0)
 ;
"SEC","^DIC",21695.5,21695.5,0,"AUDIT")
@
"SEC","^DIC",21695.5,21695.5,0,"DD")
@
"SEC","^DIC",21695.5,21695.5,0,"DEL")
@
"SEC","^DIC",21695.5,21695.5,0,"LAYGO")
@
"SEC","^DIC",21695.5,21695.5,0,"RD")
@
"SEC","^DIC",21695.5,21695.5,0,"WR")
@
"VER")
8.0^22.0
"^DD",21695.5,21695.5,0)
FIELD^^.02^11
"^DD",21695.5,21695.5,0,"DDA")
N
"^DD",21695.5,21695.5,0,"DT")
3131212
"^DD",21695.5,21695.5,0,"IX","AB",21695.52,.01)

"^DD",21695.5,21695.5,0,"IX","AC",21695.52,.01)

"^DD",21695.5,21695.5,0,"IX","B",21695.5,.01)

"^DD",21695.5,21695.5,0,"IX","C",21695.51,.01)

"^DD",21695.5,21695.5,0,"IX","CR",21695.55,.01)

"^DD",21695.5,21695.5,0,"IX","D",21695.54,.01)

"^DD",21695.5,21695.5,0,"NM","VFD TAR CONTROL")

"^DD",21695.5,21695.5,0,"PT",21695.2,1.09)

"^DD",21695.5,21695.5,.01,0)
TYPE^RF^^0;1^K:$L(X)>50!($L(X)<3)!'(X'?1P.E) X
"^DD",21695.5,21695.5,.01,1,0)
^.1
"^DD",21695.5,21695.5,.01,1,1,0)
21695.5^B
"^DD",21695.5,21695.5,.01,1,1,1)
S ^VFD(21695.5,"B",$E(X,1,30),DA)=""
"^DD",21695.5,21695.5,.01,1,1,2)
K ^VFD(21695.5,"B",$E(X,1,30),DA)
"^DD",21695.5,21695.5,.01,3)
Answer must be 3-50 characters in length.
"^DD",21695.5,21695.5,.01,21,0)
^^2^2^3120917^
"^DD",21695.5,21695.5,.01,21,1,0)
This is the type of TAR (Tracking of Abnormal Results) notification that 
"^DD",21695.5,21695.5,.01,21,2,0)
will be generated.
"^DD",21695.5,21695.5,.01,"DT")
3120917
"^DD",21695.5,21695.5,.02,0)
TIU TEMPLATE^*P8927'^TIU(8927,^0;2^S DIC("S")="I $P(^(0),U,15)'=""""!($P(^(0),U,17)'="""")" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",21695.5,21695.5,.02,3)
Enter a TIU TEMPLATE defined as a Reminder Dialog or ComObject.
"^DD",21695.5,21695.5,.02,12)
Only REMINDER DIALOG or COM OBJECT type TIU TEMPLATES.
"^DD",21695.5,21695.5,.02,12.1)
S DIC("S")="I $P(^(0),U,15)'=""""!($P(^(0),U,17)'="""")"
"^DD",21695.5,21695.5,.02,21,0)
^.001^2^2^3131212^^^
"^DD",21695.5,21695.5,.02,21,1,0)
Select the TIU TEMPLATE that will be executed for this type of SMART 
"^DD",21695.5,21695.5,.02,21,2,0)
Alert. This TIU Templates are defined as Reminder Dialogs or ComObjects.
"^DD",21695.5,21695.5,.02,"DT")
3131212
"^DD",21695.5,21695.5,.03,0)
INITIAL NOTE^P8925.1'^TIU(8925.1,^0;3^Q
"^DD",21695.5,21695.5,.03,3)
Enter the name of a TIU NOTE.
"^DD",21695.5,21695.5,.03,21,0)
^^1^1^3120917^
"^DD",21695.5,21695.5,.03,21,1,0)
This is the name of the note used as the initial plan of care.
"^DD",21695.5,21695.5,.03,"DT")
3120917
"^DD",21695.5,21695.5,.04,0)
INACTIVE^S^0:NO;1:YES;^0;4^Q
"^DD",21695.5,21695.5,.04,3)
Is this type of TAR Notificaation inactive?
"^DD",21695.5,21695.5,.04,21,0)
^^3^3^3121012^
"^DD",21695.5,21695.5,.04,21,1,0)
This is a flag to turn off this particular type of TAR Notification.  If an
"^DD",21695.5,21695.5,.04,21,2,0)
entry is marked as INACTIVE, TAR Notifcations matching the entry will not be 
"^DD",21695.5,21695.5,.04,21,3,0)
generated.
"^DD",21695.5,21695.5,.04,"DT")
3121012
"^DD",21695.5,21695.5,.05,0)
RECIPIENTS^F^^0;5^K:$L(X)>8!($L(X)<1) X
"^DD",21695.5,21695.5,.05,3)
Answer must be 1-8 characters in length.
"^DD",21695.5,21695.5,.05,21,0)
^^24^24^3121107^
"^DD",21695.5,21695.5,.05,21,1,0)
Set of codes indicating default provider recipients of a notification by 
"^DD",21695.5,21695.5,.05,21,2,0)
their title or relationship to the patient.  Notifications can be set up 
"^DD",21695.5,21695.5,.05,21,3,0)
with any or all of the following codes:
"^DD",21695.5,21695.5,.05,21,4,0)
 
"^DD",21695.5,21695.5,.05,21,5,0)
P (Primary Provider): deliver notification to  the patient's Primary 
"^DD",21695.5,21695.5,.05,21,6,0)
Provider.  
"^DD",21695.5,21695.5,.05,21,7,0)
 
"^DD",21695.5,21695.5,.05,21,8,0)
A (Attending Physician): deliver notification to the patient's Attending 
"^DD",21695.5,21695.5,.05,21,9,0)
Physician.
"^DD",21695.5,21695.5,.05,21,10,0)
 
"^DD",21695.5,21695.5,.05,21,11,0)
T (Patient Care Team): deliver notification to the patient's  primary 
"^DD",21695.5,21695.5,.05,21,12,0)
care Team.
"^DD",21695.5,21695.5,.05,21,13,0)
 
"^DD",21695.5,21695.5,.05,21,14,0)
M (PCMM Team): deliver notification to users/providers linked to the 
"^DD",21695.5,21695.5,.05,21,15,0)
patient via PCMM Team Position assignments.
"^DD",21695.5,21695.5,.05,21,16,0)
 
"^DD",21695.5,21695.5,.05,21,17,0)
E (Encounter Provider): deliver notification to the encounter provider 
"^DD",21695.5,21695.5,.05,21,18,0)
who is associated with the health factors generating this notification.
"^DD",21695.5,21695.5,.05,21,19,0)
 
"^DD",21695.5,21695.5,.05,21,20,0)
R (PCMM Primary Care Practitioner): deliver notification to the patient's 
"^DD",21695.5,21695.5,.05,21,21,0)
PCMM Primary Care Practitioner.
"^DD",21695.5,21695.5,.05,21,22,0)
 
"^DD",21695.5,21695.5,.05,21,23,0)
S (PCMM Associate Provider): deliver notification to the patient's PCMM 
"^DD",21695.5,21695.5,.05,21,24,0)
Associate Provider.
"^DD",21695.5,21695.5,.05,"DT")
3121107
"^DD",21695.5,21695.5,.06,0)
TRANSMIT TO BCR^S^1:YES;0:NO;^0;6^Q
"^DD",21695.5,21695.5,.06,21,0)
^^3^3^3121120^
"^DD",21695.5,21695.5,.06,21,1,0)
If this field is marked YES, all the collected information for this type 
"^DD",21695.5,21695.5,.06,21,2,0)
of notification will be transmitted to the Breast Care Registry (BCR).  
"^DD",21695.5,21695.5,.06,21,3,0)
Otherwise, no information will be transmitted.
"^DD",21695.5,21695.5,.06,"DT")
3121120
"^DD",21695.5,21695.5,1,0)
ORDERABLE ITEM^21695.51P^^1;0
"^DD",21695.5,21695.5,1,21,0)
^^2^2^3120917^
"^DD",21695.5,21695.5,1,21,1,0)
This multiple contains ORDERABLE ITEMS that identify an alert as an
"^DD",21695.5,21695.5,1,21,2,0)
abnormal alert.
"^DD",21695.5,21695.5,1,"DT")
3120618
"^DD",21695.5,21695.5,2,0)
OR NOTIFICATIONS^21695.52IP^^2;0
"^DD",21695.5,21695.5,2,21,0)
^.001^2^2^3131212^^^^
"^DD",21695.5,21695.5,2,21,1,0)
This multiple contains OR/EE NOTIFICATIONS that are used to trigger this
"^DD",21695.5,21695.5,2,21,2,0)
type of TAR notification.
"^DD",21695.5,21695.5,2,"DT")
3131212
"^DD",21695.5,21695.5,3,0)
DEFAULT TEXT^F^^3;1^K:$L(X)>200!($L(X)<1) X
"^DD",21695.5,21695.5,3,3)
Answer must be 1-200 characters in length.
"^DD",21695.5,21695.5,3,21,0)
^^2^2^3120917^
"^DD",21695.5,21695.5,3,21,1,0)
This is the default text for a TAR notification and will only be used
"^DD",21695.5,21695.5,3,21,2,0)
if there is no other text associated with the notification.
"^DD",21695.5,21695.5,3,"DT")
3121003
"^DD",21695.5,21695.5,4,0)
LAB TEST^21695.54PA^^4;0
"^DD",21695.5,21695.5,4,21,0)
^.001^2^2^3120919^^
"^DD",21695.5,21695.5,4,21,1,0)
This multiple contains LABORATORY TESTS that are associated with this type
"^DD",21695.5,21695.5,4,21,2,0)
of TAR notification.
"^DD",21695.5,21695.5,5,0)
REMINDER DEFINITION^21695.55PA^^5;0
"^DD",21695.5,21695.5,5,21,0)
^.001^2^2^3120919^^
"^DD",21695.5,21695.5,5,21,1,0)
This multiple contains REMINDER DEFINITIONS that are associated with this 
"^DD",21695.5,21695.5,5,21,2,0)
type of TAR notification.
"^DD",21695.5,21695.51,0)
ORDERABLE ITEM SUB-FIELD^^.01^1
"^DD",21695.5,21695.51,0,"DT")
3120718
"^DD",21695.5,21695.51,0,"IX","B",21695.51,.01)

"^DD",21695.5,21695.51,0,"NM","ORDERABLE ITEM")

"^DD",21695.5,21695.51,0,"UP")
21695.5
"^DD",21695.5,21695.51,.01,0)
ORDERABLE ITEM^MP101.43'X^ORD(101.43,^0;1^K:+$P($G(^VFD(21695.5,DA(1),2,0)),U,4)<1 X
"^DD",21695.5,21695.51,.01,1,0)
^.1
"^DD",21695.5,21695.51,.01,1,1,0)
21695.51^B
"^DD",21695.5,21695.51,.01,1,1,1)
S ^VFD(21695.5,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",21695.5,21695.51,.01,1,1,2)
K ^VFD(21695.5,DA(1),1,"B",$E(X,1,30),DA)
"^DD",21695.5,21695.51,.01,1,2,0)
21695.5^C^MUMPS
"^DD",21695.5,21695.51,.01,1,2,1)
I +$P($G(^VFD(21695.5,DA(1),2,0)),U,4)>0 N Z S Z="" F  S Z=$O(^VFD(21695.5,DA(1),2,"B",Z)) Q:Z=""  S ^VFD(21695.5,"C",Z,X,DA(1),DA)=""
"^DD",21695.5,21695.51,.01,1,2,2)
N Z S Z="" F  S Z=$O(^VFD(21695.5,DA(1),2,"B",Z)) Q:Z=""  K ^VFD(21695.5,"C",Z,X)
"^DD",21695.5,21695.51,.01,1,2,"DT")
3140106
"^DD",21695.5,21695.51,.01,3)
Enter an ORDERABLE ITEM that will trigger this type of TAR notification.
"^DD",21695.5,21695.51,.01,21,0)
^^2^2^3120917^
"^DD",21695.5,21695.51,.01,21,1,0)
This is the name of an orderable item that is associated with this type 
"^DD",21695.5,21695.51,.01,21,2,0)
of TAR notification.
"^DD",21695.5,21695.51,.01,"DT")
3140106
"^DD",21695.5,21695.52,0)
OR NOTIFICATIONS SUB-FIELD^^.01^1
"^DD",21695.5,21695.52,0,"DT")
3131212
"^DD",21695.5,21695.52,0,"IX","B",21695.52,.01)

"^DD",21695.5,21695.52,0,"NM","OR NOTIFICATIONS")

"^DD",21695.5,21695.52,0,"UP")
21695.5
"^DD",21695.5,21695.52,.01,0)
OR NOTIFICATIONS^M*P100.9'^ORD(100.9,^0;1^S DIC("S")="I '$D(^VFD(21695.5,""AB"",Y))" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",21695.5,21695.52,.01,1,0)
^.1
"^DD",21695.5,21695.52,.01,1,1,0)
21695.52^B
"^DD",21695.5,21695.52,.01,1,1,1)
S ^VFD(21695.5,DA(1),2,"B",$E(X,1,30),DA)=""
"^DD",21695.5,21695.52,.01,1,1,2)
K ^VFD(21695.5,DA(1),2,"B",$E(X,1,30),DA)
"^DD",21695.5,21695.52,.01,1,2,0)
21695.5^AB
"^DD",21695.5,21695.52,.01,1,2,1)
S ^VFD(21695.5,"AB",$E(X,1,30),DA(1),DA)=""
"^DD",21695.5,21695.52,.01,1,2,2)
K ^VFD(21695.5,"AB",$E(X,1,30),DA(1),DA)
"^DD",21695.5,21695.52,.01,1,2,"DT")
3120928
"^DD",21695.5,21695.52,.01,1,3,0)
21695.5^AC^MUMPS
"^DD",21695.5,21695.52,.01,1,3,1)
N C,O,S F C="1^C","5^CR","4^D" S O="" F  S O=$O(^VFD(21695.5,DA(1),2,"B",O)) Q:O=""  S S="" F  S S=$O(^VFD(21695.5,DA(1),+C,"B",S)) Q:S=""  S ^VFD(21695.5,$P(C,U,2),O,S,DA(1),$O(^VFD(21695.5,DA(1),+C,"B",S,"")))=""
"^DD",21695.5,21695.52,.01,1,3,2)
N Z F Z="C","CR","D" K ^VFD(21695.5,Z,X)
"^DD",21695.5,21695.52,.01,1,3,"DT")
3140107
"^DD",21695.5,21695.52,.01,3)
Enter an OR/EE Notification.
"^DD",21695.5,21695.52,.01,12)
OR NOTIFICATIONS can only be assigned to one control type.
"^DD",21695.5,21695.52,.01,12.1)
S DIC("S")="I '$D(^VFD(21695.5,""AB"",Y))"
"^DD",21695.5,21695.52,.01,21,0)
^.001^1^1^3131212^^^^
"^DD",21695.5,21695.52,.01,21,1,0)
This is an OR/EE NOTIFICATION that is associated with this type of TAR notification.
"^DD",21695.5,21695.52,.01,"DT")
3140107
"^DD",21695.5,21695.54,0)
LAB TEST SUB-FIELD^^.01^1
"^DD",21695.5,21695.54,0,"DT")
3120911
"^DD",21695.5,21695.54,0,"IX","B",21695.54,.01)

"^DD",21695.5,21695.54,0,"NM","LAB TEST")

"^DD",21695.5,21695.54,0,"UP")
21695.5
"^DD",21695.5,21695.54,.01,0)
LAB TEST^MP60'X^LAB(60,^0;1^K:+$P($G(^VFD(21695.5,DA(1),2,0)),U,4)<1 X
"^DD",21695.5,21695.54,.01,1,0)
^.1
"^DD",21695.5,21695.54,.01,1,1,0)
21695.54^B
"^DD",21695.5,21695.54,.01,1,1,1)
S ^VFD(21695.5,DA(1),4,"B",$E(X,1,30),DA)=""
"^DD",21695.5,21695.54,.01,1,1,2)
K ^VFD(21695.5,DA(1),4,"B",$E(X,1,30),DA)
"^DD",21695.5,21695.54,.01,1,2,0)
21695.5^D^MUMPS
"^DD",21695.5,21695.54,.01,1,2,1)
I +$P($G(^VFD(21695.5,DA(1),2,0)),U,4)>0 N Z S Z="" F  S Z=$O(^VFD(21695.5,DA(1),2,"B",Z)) Q:Z=""  S ^VFD(21695.5,"D",Z,X,DA(1),DA)=""
"^DD",21695.5,21695.54,.01,1,2,2)
N Z S Z="" F  S Z=$O(^VFD(21695.5,DA(1),2,"B",Z)) Q:Z=""  K ^VFD(21695.5,"D",Z,X)
"^DD",21695.5,21695.54,.01,1,2,"DT")
3140106
"^DD",21695.5,21695.54,.01,3)
Enter a lab test to be tracked.
"^DD",21695.5,21695.54,.01,21,0)
^.001^2^2^3120919^^
"^DD",21695.5,21695.54,.01,21,1,0)
This is a LABORATORY TEST that is associated with this type of TAR 
"^DD",21695.5,21695.54,.01,21,2,0)
notification.
"^DD",21695.5,21695.54,.01,"DT")
3140106
"^DD",21695.5,21695.55,0)
REMINDER DEFINITION SUB-FIELD^^.01^1
"^DD",21695.5,21695.55,0,"DT")
3120919
"^DD",21695.5,21695.55,0,"IX","B",21695.55,.01)

"^DD",21695.5,21695.55,0,"NM","REMINDER DEFINITION")

"^DD",21695.5,21695.55,0,"UP")
21695.5
"^DD",21695.5,21695.55,.01,0)
REMINDER DEFINITION^MP811.9'X^PXD(811.9,^0;1^K:+$P($G(^VFD(21695.5,DA(1),2,0)),U,4)<1 X
"^DD",21695.5,21695.55,.01,1,0)
^.1
"^DD",21695.5,21695.55,.01,1,1,0)
21695.55^B
"^DD",21695.5,21695.55,.01,1,1,1)
S ^VFD(21695.5,DA(1),5,"B",$E(X,1,30),DA)=""
"^DD",21695.5,21695.55,.01,1,1,2)
K ^VFD(21695.5,DA(1),5,"B",$E(X,1,30),DA)
"^DD",21695.5,21695.55,.01,1,2,0)
21695.5^CR^MUMPS
"^DD",21695.5,21695.55,.01,1,2,1)
I +$P($G(^VFD(21695.5,DA(1),2,0)),U,4)>0 N Z S Z="" F  S Z=$O(^VFD(21695.5,DA(1),2,"B",Z)) Q:Z=""  S ^VFD(21695.5,"CR",Z,X,DA(1),DA)=""
"^DD",21695.5,21695.55,.01,1,2,2)
N Z S Z="" F  S Z=$O(^VFD(21695.5,DA(1),2,"B",Z)) Q:Z=""  K ^VFD(21695.5,"CR",Z,X)
"^DD",21695.5,21695.55,.01,1,2,"DT")
3140106
"^DD",21695.5,21695.55,.01,3)
Enter a reminder definition to be evaluated.
"^DD",21695.5,21695.55,.01,21,0)
^.001^2^2^3120919^^
"^DD",21695.5,21695.55,.01,21,1,0)
This is a REMINDER DEFINITION that is associated with this type of TAR.  
"^DD",21695.5,21695.55,.01,21,2,0)
If this reminder is true, a notification will be sent.
"^DD",21695.5,21695.55,.01,"DT")
3140106
"^DIC",21695.5,21695.5,0)
VFD TAR CONTROL^21695.5
"^DIC",21695.5,21695.5,0,"GL")
^VFD(21695.5,
"^DIC",21695.5,21695.5,"%",0)
^1.005^^0
"^DIC",21695.5,21695.5,"%D",0)
^1.001^2^2^3131212^^^^
"^DIC",21695.5,21695.5,"%D",1,0)
This file is used to screen what constitutes a trackable abnormal test
"^DIC",21695.5,21695.5,"%D",2,0)
result.
"^DIC",21695.5,"B","VFD TAR CONTROL",21695.5)

**END**
**END**
