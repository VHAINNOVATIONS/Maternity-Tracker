KIDS Distribution saved on Apr 17, 2014@13:18:15
DSIO 1.0 S9 B1
**KIDS**:DSIO 1.0^

**INSTALL NAME**
DSIO 1.0
"BLD",9691,0)
DSIO 1.0^^0^3140417^n
"BLD",9691,4,0)
^9.64PA^19641^3
"BLD",9691,4,19641,0)
19641
"BLD",9691,4,19641,222)
y^y^f^^^^n
"BLD",9691,4,19641.11,0)
19641.11
"BLD",9691,4,19641.11,222)
y^y^f^^^^n
"BLD",9691,4,19641.6,0)
19641.6
"BLD",9691,4,19641.6,222)
y^y^f^^^^n
"BLD",9691,4,"B",19641,19641)

"BLD",9691,4,"B",19641.11,19641.11)

"BLD",9691,4,"B",19641.6,19641.6)

"BLD",9691,6.3)
25
"BLD",9691,"INID")
^
"BLD",9691,"INIT")

"BLD",9691,"KRN",0)
^9.67PA^779.2^20
"BLD",9691,"KRN",.4,0)
.4
"BLD",9691,"KRN",.401,0)
.401
"BLD",9691,"KRN",.402,0)
.402
"BLD",9691,"KRN",.403,0)
.403
"BLD",9691,"KRN",.403,"NM",0)
^9.68A^^
"BLD",9691,"KRN",.5,0)
.5
"BLD",9691,"KRN",.84,0)
.84
"BLD",9691,"KRN",3.6,0)
3.6
"BLD",9691,"KRN",3.8,0)
3.8
"BLD",9691,"KRN",9.2,0)
9.2
"BLD",9691,"KRN",9.8,0)
9.8
"BLD",9691,"KRN",9.8,"NM",0)
^9.68A^7^7
"BLD",9691,"KRN",9.8,"NM",1,0)
DSIO2^^0^B8542444
"BLD",9691,"KRN",9.8,"NM",2,0)
DSIO3^^0^B175783687
"BLD",9691,"KRN",9.8,"NM",3,0)
DSIO4^^0^B19271651
"BLD",9691,"KRN",9.8,"NM",4,0)
DSIO3A^^0^B16113575
"BLD",9691,"KRN",9.8,"NM",5,0)
DSIO3V1^^0^B34559170
"BLD",9691,"KRN",9.8,"NM",6,0)
DSIO3V2^^0^B108695401
"BLD",9691,"KRN",9.8,"NM",7,0)
DSIO3V3^^0^B38841252
"BLD",9691,"KRN",9.8,"NM","B","DSIO2",1)

"BLD",9691,"KRN",9.8,"NM","B","DSIO3",2)

"BLD",9691,"KRN",9.8,"NM","B","DSIO3A",4)

"BLD",9691,"KRN",9.8,"NM","B","DSIO3V1",5)

"BLD",9691,"KRN",9.8,"NM","B","DSIO3V2",6)

"BLD",9691,"KRN",9.8,"NM","B","DSIO3V3",7)

"BLD",9691,"KRN",9.8,"NM","B","DSIO4",3)

"BLD",9691,"KRN",19,0)
19
"BLD",9691,"KRN",19,"NM",0)
^9.68A^1^1
"BLD",9691,"KRN",19,"NM",1,0)
DSIO GUI CONTEXT^^0
"BLD",9691,"KRN",19,"NM","B","DSIO GUI CONTEXT",1)

"BLD",9691,"KRN",19.1,0)
19.1
"BLD",9691,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",9691,"KRN",101,0)
101
"BLD",9691,"KRN",409.61,0)
409.61
"BLD",9691,"KRN",409.61,"NM",0)
^9.68A^^
"BLD",9691,"KRN",771,0)
771
"BLD",9691,"KRN",779.2,0)
779.2
"BLD",9691,"KRN",870,0)
870
"BLD",9691,"KRN",8989.51,0)
8989.51
"BLD",9691,"KRN",8989.51,"NM",0)
^9.68A^^0
"BLD",9691,"KRN",8989.52,0)
8989.52
"BLD",9691,"KRN",8989.52,"NM",0)
^9.68A^^
"BLD",9691,"KRN",8994,0)
8994
"BLD",9691,"KRN",8994,"NM",0)
^9.68A^3^3
"BLD",9691,"KRN",8994,"NM",1,0)
DSIO CREATE A NOTE^^0
"BLD",9691,"KRN",8994,"NM",2,0)
DSIO VPR GET PATIENT DATA^^0
"BLD",9691,"KRN",8994,"NM",3,0)
DSIO GET SINGLE VALUE^^0
"BLD",9691,"KRN",8994,"NM","B","DSIO CREATE A NOTE",1)

"BLD",9691,"KRN",8994,"NM","B","DSIO GET SINGLE VALUE",3)

"BLD",9691,"KRN",8994,"NM","B","DSIO VPR GET PATIENT DATA",2)

"BLD",9691,"KRN","B",.4,.4)

"BLD",9691,"KRN","B",.401,.401)

"BLD",9691,"KRN","B",.402,.402)

"BLD",9691,"KRN","B",.403,.403)

"BLD",9691,"KRN","B",.5,.5)

"BLD",9691,"KRN","B",.84,.84)

"BLD",9691,"KRN","B",3.6,3.6)

"BLD",9691,"KRN","B",3.8,3.8)

"BLD",9691,"KRN","B",9.2,9.2)

"BLD",9691,"KRN","B",9.8,9.8)

"BLD",9691,"KRN","B",19,19)

"BLD",9691,"KRN","B",19.1,19.1)

"BLD",9691,"KRN","B",101,101)

"BLD",9691,"KRN","B",409.61,409.61)

"BLD",9691,"KRN","B",771,771)

"BLD",9691,"KRN","B",779.2,779.2)

"BLD",9691,"KRN","B",870,870)

"BLD",9691,"KRN","B",8989.51,8989.51)

"BLD",9691,"KRN","B",8989.52,8989.52)

"BLD",9691,"KRN","B",8994,8994)

"BLD",9691,"PRE")

"BLD",9691,"PRET")

"BLD",9691,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",9691,"QUES",0)
^9.62^^
"BLD",9691,"REQB",0)
^9.611^^
"FIA",19641)
DSIO PATIENT
"FIA",19641,0)
^DSIO(19641,
"FIA",19641,0,0)
19641P
"FIA",19641,0,1)
y^y^f^^^^n
"FIA",19641,0,10)

"FIA",19641,0,11)

"FIA",19641,0,"RLRO")

"FIA",19641,19641)
0
"FIA",19641,19641.01)
0
"FIA",19641.11)
DSIO PERSONS
"FIA",19641.11,0)
^DSIO(19641.11,
"FIA",19641.11,0,0)
19641.11OI
"FIA",19641.11,0,1)
y^y^f^^^^n
"FIA",19641.11,0,10)

"FIA",19641.11,0,11)

"FIA",19641.11,0,"RLRO")

"FIA",19641.11,19641.11)
0
"FIA",19641.6)
DSIO IHE DOCUMENT
"FIA",19641.6,0)
^DSIO(19641.6,
"FIA",19641.6,0,0)
19641.6P
"FIA",19641.6,0,1)
y^y^f^^^^n
"FIA",19641.6,0,10)

"FIA",19641.6,0,11)

"FIA",19641.6,0,"RLRO")

"FIA",19641.6,19641.6)
0
"FIA",19641.6,19641.62)
0
"FIA",19641.6,19641.622)
0
"IX",19641,19641,"AC",0)
19641^AC^Create a Tracking Entry when .02 changes.^MU^^F^IR^I^19641^^^^^A
"IX",19641,19641,"AC",1)
D TRAK^DSIO2(DA,X(1))
"IX",19641,19641,"AC",2)
Q
"IX",19641,19641,"AC",11.1,0)
^.114IA^1^1
"IX",19641,19641,"AC",11.1,1,0)
1^F^19641^.02^^^F
"IX",19641,19641,"AC","NOREINDEX")
1
"IX",19641.6,19641.6,"C",0)
19641.6^C^KEY OF GUID(.01) FOR WHOLE FILE^R^^F^IR^W^19641.62^^^^^LS
"IX",19641.6,19641.6,"C",1)
S ^DSIO(19641.6,"C",X,DA(1),DA)=""
"IX",19641.6,19641.6,"C",2)
K ^DSIO(19641.6,"C",X,DA(1),DA)
"IX",19641.6,19641.6,"C",2.5)
K ^DSIO(19641.6,"C")
"IX",19641.6,19641.6,"C",11.1,0)
^.114IA^1^1
"IX",19641.6,19641.6,"C",11.1,1,0)
1^F^19641.62^.01^^1^F
"IX",19641.6,19641.6,"C",11.1,1,3)

"IX",19641.6,19641.62,"P",0)
19641.62^P^DESCENDING IMPORT DATE^R^^F^IR^I^19641.62^^^^^LS
"IX",19641.6,19641.62,"P",1)
S ^DSIO(19641.6,DA(1),1,"P",X,DA)=""
"IX",19641.6,19641.62,"P",2)
K ^DSIO(19641.6,DA(1),1,"P",X,DA)
"IX",19641.6,19641.62,"P",2.5)
K ^DSIO(19641.6,DA(1),1,"P")
"IX",19641.6,19641.62,"P",11.1,0)
^.114IA^1^1
"IX",19641.6,19641.62,"P",11.1,1,0)
1^F^19641.62^.03^^1^B
"IX",19641.6,19641.62,"P",11.1,1,3)

"KRN",19,14687,-1)
0^1
"KRN",19,14687,0)
DSIO GUI CONTEXT^MCC DASHBOARD RPCS^^B^^^^^^^^
"KRN",19,14687,"RPC",0)
^19.05P^35^33
"KRN",19,14687,"RPC",1,0)
DSIO CREATE TRACKING LOG
"KRN",19,14687,"RPC",2,0)
DSIO FEMALE PATIENT FIND
"KRN",19,14687,"RPC",3,0)
DSIO FEMALE PATIENT SEARCH
"KRN",19,14687,"RPC",4,0)
DSIO GET TRACKING
"KRN",19,14687,"RPC",6,0)
DSIO SELECT LIST
"KRN",19,14687,"RPC",7,0)
ORWU HASKEY
"KRN",19,14687,"RPC",8,0)
DG SENSITIVE RECORD ACCESS
"KRN",19,14687,"RPC",9,0)
DG SENSITIVE RECORD BULLETIN
"KRN",19,14687,"RPC",10,0)
TIU DOCUMENTS BY CONTEXT
"KRN",19,14687,"RPC",11,0)
ORWPT SELECT
"KRN",19,14687,"RPC",12,0)
ORWU USERINFO
"KRN",19,14687,"RPC",13,0)
DSIO GET SINGLE VALUE
"KRN",19,14687,"RPC",14,0)
DSIO SAVE NON VA ENTITY
"KRN",19,14687,"RPC",15,0)
DSIO RETURN ENTITY
"KRN",19,14687,"RPC",16,0)
DSIO CREATE A NOTE
"KRN",19,14687,"RPC",17,0)
DSIO UPDATE A NOTE
"KRN",19,14687,"RPC",18,0)
DSIO MAKE ADDENDUM
"KRN",19,14687,"RPC",19,0)
DSIO GET RECORD TEXT
"KRN",19,14687,"RPC",20,0)
DSIO DELETE A NOTE
"KRN",19,14687,"RPC",21,0)
DSIO SIGN A NOTE
"KRN",19,14687,"RPC",22,0)
DSIO NOTES BY DFN AND TITLE
"KRN",19,14687,"RPC",23,0)
DSIO GET NOTE ELEMENT
"KRN",19,14687,"RPC",24,0)
DSIO IS IT CONTROLLED?
"KRN",19,14687,"RPC",26,0)
XUS CVC
"KRN",19,14687,"RPC",27,0)
TIU GET RECORD TEXT
"KRN",19,14687,"RPC",28,0)
TIU AUTHORIZATION
"KRN",19,14687,"RPC",29,0)
DSIO IHE SAVE
"KRN",19,14687,"RPC",30,0)
VPR DATA VERSION
"KRN",19,14687,"RPC",31,0)
VPR GET PATIENT DATA
"KRN",19,14687,"RPC",32,0)
DSIO IHE PATIENT LIST
"KRN",19,14687,"RPC",33,0)
DSIO IHE GET DOC
"KRN",19,14687,"RPC",34,0)
ORWU1 NEWLOC
"KRN",19,14687,"RPC",35,0)
DSIO VPR GET PATIENT DATA
"KRN",19,14687,"U")
MCC DASHBOARD RPCS
"KRN",8994,3950,-1)
0^3
"KRN",8994,3950,0)
DSIO GET SINGLE VALUE^GET^DSIO4^1
"KRN",8994,3950,2,0)
^8994.02A^1^1
"KRN",8994,3950,2,1,0)
DFN^1^^1^1
"KRN",8994,3950,2,1,1,0)
^8994.021^1^1^3140205^^
"KRN",8994,3950,2,1,1,1,0)
PATIENT IEN
"KRN",8994,3950,2,"B","DFN",1)

"KRN",8994,3950,2,"PARAMSEQ",1,1)

"KRN",8994,3950,3,0)
^8994.03^1^1^3140205^^
"KRN",8994,3950,3,1,0)
EXTERANL DATE FORMAT OR NULL
"KRN",8994,3953,-1)
0^1
"KRN",8994,3953,0)
DSIO CREATE A NOTE^CREATE^DSIO3^1
"KRN",8994,3953,2,0)
^8994.02A^5^5
"KRN",8994,3953,2,1,0)
DFN^1^^1^1
"KRN",8994,3953,2,1,1,0)
^8994.021^1^1^3140411^^
"KRN",8994,3953,2,1,1,1,0)
PATIENT IEN
"KRN",8994,3953,2,2,0)
TITLE^1^^1^2
"KRN",8994,3953,2,2,1,0)
^8994.021^1^1^3140411^^
"KRN",8994,3953,2,2,1,1,0)
THE PROGRESS NOTE TITLE
"KRN",8994,3953,2,3,0)
NOTE^2^^1^3
"KRN",8994,3953,2,3,1,0)
^8994.021^1^1^3140411^^
"KRN",8994,3953,2,3,1,1,0)
THE PROGESS NOTE AS AN ARRAY.
"KRN",8994,3953,2,4,0)
DATA^2^^^4
"KRN",8994,3953,2,4,1,0)
^8994.021^2^2^3140411^^^
"KRN",8994,3953,2,4,1,1,0)
DISCREET DATA ELEMENTS TO BE SAVED AND ASSOCIATED WITH THIS NOTE. THE 
"KRN",8994,3953,2,4,1,2,0)
ARRAY MUST BE LIST(#)=FIELD^VALUE
"KRN",8994,3953,2,5,0)
SUBJ^1^^^5
"KRN",8994,3953,2,"B","DATA",4)

"KRN",8994,3953,2,"B","DFN",1)

"KRN",8994,3953,2,"B","NOTE",3)

"KRN",8994,3953,2,"B","SUBJ",5)

"KRN",8994,3953,2,"B","TITLE",2)

"KRN",8994,3953,2,"PARAMSEQ",1,1)

"KRN",8994,3953,2,"PARAMSEQ",2,2)

"KRN",8994,3953,2,"PARAMSEQ",3,3)

"KRN",8994,3953,2,"PARAMSEQ",4,4)

"KRN",8994,3953,2,"PARAMSEQ",5,5)

"KRN",8994,3953,3,0)
^8994.03^5^5^3140411^^^
"KRN",8994,3953,3,1,0)
 If successful:
"KRN",8994,3953,3,2,0)
  <IEN in TIU DOCUMENT FILE>^<LAST_PAGE_RECEIVED>^<TOTAL_PAGES_EXPECTED>
"KRN",8994,3953,3,3,0)
  
"KRN",8994,3953,3,4,0)
 If unsuccessful:
"KRN",8994,3953,3,5,0)
  0^0^0^Explanatory text
"KRN",8994,3974,-1)
0^2
"KRN",8994,3974,0)
DSIO VPR GET PATIENT DATA^GET^DSIO3V1^4^^^^1^^^1
"KRN",8994,3974,1,0)
^^2^2^3140410^
"KRN",8994,3974,1,1,0)
This RPC retrieves the requested data from VistA, and returns it in
"KRN",8994,3974,1,2,0)
^TMP("VPR",$J,n) as XML.
"KRN",8994,3974,2,0)
^8994.02A^7^7
"KRN",8994,3974,2,1,0)
DFN^1^20^1^1
"KRN",8994,3974,2,1,1,0)
^^2^2^3140410^
"KRN",8994,3974,2,1,1,1,0)
 Internal entry number from Patient file #2
"KRN",8994,3974,2,1,1,2,0)
 [optionally DFN;ICN for remote calls]
"KRN",8994,3974,2,2,0)
TYPE^1^100^0^2
"KRN",8994,3974,2,2,1,0)
^^4^4^3140410^
"KRN",8994,3974,2,2,1,1,0)
 The kind(s) of data to return, which may include:
"KRN",8994,3974,2,2,1,2,0)
   demographics;reactions;problems;vitals;labs;meds;
"KRN",8994,3974,2,2,1,3,0)
   immunizations;visits;appointments;documents;
"KRN",8994,3974,2,2,1,4,0)
   procedures;consults
"KRN",8994,3974,2,3,0)
START^1^20^0^3
"KRN",8994,3974,2,3,1,0)
^^1^1^3140410^
"KRN",8994,3974,2,3,1,1,0)
The date/time from which to begin searching for data [optional].
"KRN",8994,3974,2,4,0)
STOP^1^20^0^4
"KRN",8994,3974,2,4,1,0)
^^1^1^3140410^
"KRN",8994,3974,2,4,1,1,0)
The date/time at which to end searching for data [optional].
"KRN",8994,3974,2,5,0)
MAX^1^7^0^5
"KRN",8994,3974,2,5,1,0)
^^1^1^3140410^
"KRN",8994,3974,2,5,1,1,0)
The maximum number of items to return per data type [optional].
"KRN",8994,3974,2,6,0)
ITEM^1^30^0^6
"KRN",8994,3974,2,6,1,0)
^^2^2^3140410^
"KRN",8994,3974,2,6,1,1,0)
 The identifier of a single item to return [optional, but TYPE must
"KRN",8994,3974,2,6,1,2,0)
 also be defined when used].
"KRN",8994,3974,2,7,0)
FILTER^2^^0^7
"KRN",8994,3974,2,7,1,0)
^^1^1^3140410^
"KRN",8994,3974,2,7,1,1,0)
 List of name-value pairs, further refining the search.
"KRN",8994,3974,2,"B","DFN",1)

"KRN",8994,3974,2,"B","FILTER",7)

"KRN",8994,3974,2,"B","ITEM",6)

"KRN",8994,3974,2,"B","MAX",5)

"KRN",8994,3974,2,"B","START",3)

"KRN",8994,3974,2,"B","STOP",4)

"KRN",8994,3974,2,"B","TYPE",2)

"KRN",8994,3974,2,"PARAMSEQ",1,1)

"KRN",8994,3974,2,"PARAMSEQ",2,2)

"KRN",8994,3974,2,"PARAMSEQ",3,3)

"KRN",8994,3974,2,"PARAMSEQ",4,4)

"KRN",8994,3974,2,"PARAMSEQ",5,5)

"KRN",8994,3974,2,"PARAMSEQ",6,6)

"KRN",8994,3974,2,"PARAMSEQ",7,7)

"KRN",8994,3974,3,0)
^^1^1^3140410^
"KRN",8994,3974,3,1,0)
 Text array formatted as XML
"MBREQ")
0
"ORD",16,8994)
8994;16;1;;;;;;;RPCDEL^XPDIA1
"ORD",16,8994,0)
REMOTE PROCEDURE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
7
"RTN","DSIO2")
0^1^B8542444
"RTN","DSIO2",1,0)
DSIO2 ;DSS/TFF - DSIO X-REFERENCES AND UTILITIES;06/28/2013 15:19
"RTN","DSIO2",2,0)
 ;;1.0;DSS,INC OPEN SOURCE;;28 Jan 2013;Build 25
"RTN","DSIO2",3,0)
 ;Copyright 1995-2014,Document Storage Systems Inc. All Rights Reserved
"RTN","DSIO2",4,0)
 ;
"RTN","DSIO2",5,0)
 ;
"RTN","DSIO2",6,0)
 ; Documented API and ICRs
"RTN","DSIO2",7,0)
 ; -----------------------
"RTN","DSIO2",8,0)
 ;
"RTN","DSIO2",9,0)
 Q
"RTN","DSIO2",10,0)
 ;
"RTN","DSIO2",11,0)
 ;=====================================================================
"RTN","DSIO2",12,0)
 ;                       X - R E F  S U P P O R T
"RTN","DSIO2",13,0)
 ;=====================================================================
"RTN","DSIO2",14,0)
 ;
"RTN","DSIO2",15,0)
TRAK(DFN,ANS) ; CREATE A TRACKING ENTRY FROM DSIO PATIENT WHEN THE
"RTN","DSIO2",16,0)
 ;              CURRENTLY TRACKING STATUS CHANGES (.02)
"RTN","DSIO2",17,0)
 ;
"RTN","DSIO2",18,0)
 Q:$G(ANS)=""
"RTN","DSIO2",19,0)
 N FM,IPT,DIC,DA,DG,DLAYGO,DR,N,X,Y,IEN S DLAYGO=19641.2
"RTN","DSIO2",20,0)
 S FM(1)=$$FIND1^DIC(19641.22,,"O","FILEMAN")
"RTN","DSIO2",21,0)
 I FM(1)<1 K FM D
"RTN","DSIO2",22,0)
 .S IPT(19641.22,"?+1,",.01)="FILEMAN" D UPDATE^DIE(,"IPT","FM") K IPT
"RTN","DSIO2",23,0)
 .S IPT(19641.22,FM(1)_",",.02)=1 D FILE^DIE("I","IPT") K IPT
"RTN","DSIO2",24,0)
 S DIC="^DSIO(19641.2,",DIC(0)="XL",X="`"_DFN D ^DIC I +Y>0 D
"RTN","DSIO2",25,0)
 .S IPT(19641.24,"+1,"_DFN_",",.01)=$$NOW^XLFDT D UPDATE^DIE(,"IPT","IEN")
"RTN","DSIO2",26,0)
 .K IPT I $D(IEN(1)) D
"RTN","DSIO2",27,0)
 ..K ^TMP($J,"DSIO TRAK") S ^TMP($J,"DSIO TRAK")=IEN(1)
"RTN","DSIO2",28,0)
 ..S IPT(19641.24,IEN(1)_","_DFN_",",.02)=ANS
"RTN","DSIO2",29,0)
 ..S IPT(19641.24,IEN(1)_","_DFN_",",.03)=DUZ
"RTN","DSIO2",30,0)
 ..S IPT(19641.24,IEN(1)_","_DFN_",",.04)="FILEMAN"
"RTN","DSIO2",31,0)
 ..D FILE^DIE("I","IPT") K IPT
"RTN","DSIO2",32,0)
 Q
"RTN","DSIO2",33,0)
 ;
"RTN","DSIO2",34,0)
SERVICE(SHW,VAL) ; SET OF CODES FOR DSIO TITLE CONFIGURATION .03 FROM
"RTN","DSIO2",35,0)
 ;                 ^DD(9000010,.07,0) VISIT FILE - SERVICE CATEGORY
"RTN","DSIO2",36,0)
 ;
"RTN","DSIO2",37,0)
 N LST,SC,DIR,X,Y,FLG S SHW=$G(SHW),LST=$P(^DD(9000010,.07,0),U,3)
"RTN","DSIO2",38,0)
 W:SHW !,?5,"Select one of the following:",!!
"RTN","DSIO2",39,0)
 S DIR(0)="S^" F SC=1:1:$L(LST,";")-1 D  Q:$D(FLG)
"RTN","DSIO2",40,0)
 .I SHW W ?10,$P($P(LST,";",SC),":"),?20,$P($P(LST,";",SC),":",2),! Q
"RTN","DSIO2",41,0)
 .I $G(VAL)=$P($P(LST,";",SC),":") S FLG=VAL
"RTN","DSIO2",42,0)
 .S DIR(0)=DIR(0)_$P($P(LST,";",SC),":")_":"_$P($P(LST,";",SC),":",2)_$S(SC<($L(LST,";")-1):";",1:"")
"RTN","DSIO2",43,0)
 Q:SHW ""  Q:$D(FLG) FLG
"RTN","DSIO2",44,0)
 S DIR("A")="SERVICE CATEGORY" D ^DIR
"RTN","DSIO2",45,0)
 I Y'?1.1A S Y=""
"RTN","DSIO2",46,0)
 Q Y
"RTN","DSIO2",47,0)
 ;
"RTN","DSIO2",48,0)
 ;=====================================================================
"RTN","DSIO2",49,0)
 ;                         U T I L I T I E S
"RTN","DSIO2",50,0)
 ;=====================================================================
"RTN","DSIO2",51,0)
 ;
"RTN","DSIO2",52,0)
FN(P,C) ; GET THE NEXT RECORD BY DASHBOARD PAGE AND COUNT FORWARDS
"RTN","DSIO2",53,0)
 Q:P<2 0
"RTN","DSIO2",54,0)
 Q C*(P-1)
"RTN","DSIO2",55,0)
 ;
"RTN","DSIO2",56,0)
NAME(NAM) ; TRANSFORM NAME,NAME TO TITLE CASE THATS - Name,Name
"RTN","DSIO2",57,0)
 N RET S RET=""
"RTN","DSIO2",58,0)
 S RET=$$TITLE^XLFSTR($P(NAM,","))_","_$$TITLE^XLFSTR($P(NAM,",",2))
"RTN","DSIO2",59,0)
 Q RET
"RTN","DSIO2",60,0)
 ;
"RTN","DSIO2",61,0)
DT(VAL) ; TRANSLATE EXTERNAL DATE TIME TO FM DATE TIME
"RTN","DSIO2",62,0)
 ;
"RTN","DSIO2",63,0)
 ; Converts these 9/23/2004 10:53:25 AM
"RTN","DSIO2",64,0)
 ;                2009-10-22 05:00:00.0
"RTN","DSIO2",65,0)
 ;
"RTN","DSIO2",66,0)
 ; THE FM CALL BELOW DOES NOT WORK WITH THE ABOVE FORMAT
"RTN","DSIO2",67,0)
 ; -----------------------------------------------------
"RTN","DSIO2",68,0)
 ; D DT^DILF("E","DEC 12,2014",.RESULT) 
"RTN","DSIO2",69,0)
 ; RESULT=3141212
"RTN","DSIO2",70,0)
 ; RESULT(0)="DEC 12, 2014"
"RTN","DSIO2",71,0)
 ;
"RTN","DSIO2",72,0)
 N D,RET,YR,YRP,MH,MHP,DY,DYP,TM,SEC,MIN,HR,I S RET=-1
"RTN","DSIO2",73,0)
 I VAL["/" S D="/",YRP=3,MHP=1,DYP=2
"RTN","DSIO2",74,0)
 I VAL["-" S D="-",YRP=1,MHP=2,DYP=3
"RTN","DSIO2",75,0)
 I '$D(D) D DT^DILF("E",VAL,.RET) I RET=-1 Q RET_U_VAL
"RTN","DSIO2",76,0)
 S YR=$P($P(VAL,D,YRP)," ")-1700
"RTN","DSIO2",77,0)
 S MH=$P($P(VAL,D,MHP)," ") I $L(MH)=1 S MH=0_MH
"RTN","DSIO2",78,0)
 S DY=$P($P(VAL,D,DYP)," ") I $L(DY)=1 S DY=0_DY
"RTN","DSIO2",79,0)
 ;
"RTN","DSIO2",80,0)
 ;TIME
"RTN","DSIO2",81,0)
 S TM="" I VAL[":" S TM=$P($P(VAL," ",2),".") D
"RTN","DSIO2",82,0)
 .S SEC=$P(TM,":",3) S:$L(SEC)=1 SEC=0_SEC
"RTN","DSIO2",83,0)
 .S MIN=$P(TM,":",2) S:$L(MIN)=1 MIN=0_MIN
"RTN","DSIO2",84,0)
 .S HR=$P(TM,":") S:$L(HR)=1 HR=0_HR
"RTN","DSIO2",85,0)
 .I $P(VAL," ",3)="AM"&(HR=12) S HR="00"
"RTN","DSIO2",86,0)
 .I $P(VAL," ",3)="PM"&(HR<12) S HR=HR+12
"RTN","DSIO2",87,0)
 .S TM=HR_MIN_SEC
"RTN","DSIO2",88,0)
 .F I=$L(TM):-1:1 Q:$E(TM,I)'=0  I $E(TM,I)=0 S TM=$E(TM,1,I-1)
"RTN","DSIO2",89,0)
 ;
"RTN","DSIO2",90,0)
 S RET=YR_MH_DY_"."_TM
"RTN","DSIO2",91,0)
 Q RET
"RTN","DSIO3")
0^2^B175783687
"RTN","DSIO3",1,0)
DSIO3 ;DSS/TFF - DSIO TIU SUPPORT;06/28/2013 15:19
"RTN","DSIO3",2,0)
 ;;1.0;DSS,INC OPEN SOURCE;;28 Jan 2013;Build 25
"RTN","DSIO3",3,0)
 ;Copyright 1995-2014,Document Storage Systems Inc. All Rights Reserved
"RTN","DSIO3",4,0)
 ;
"RTN","DSIO3",5,0)
 ;
"RTN","DSIO3",6,0)
 ; Documented API and ICRs
"RTN","DSIO3",7,0)
 ; -----------------------
"RTN","DSIO3",8,0)
 ;
"RTN","DSIO3",9,0)
 Q
"RTN","DSIO3",10,0)
 ;
"RTN","DSIO3",11,0)
CREATE(RET,DFN,TITLE,NOTE,DATA,SUBJ) ; RPC: DSIO CREATE A NOTE
"RTN","DSIO3",12,0)
 ;
"RTN","DSIO3",13,0)
 ; Visit information will come out of a configuration file
"RTN","DSIO3",14,0)
 ;
"RTN","DSIO3",15,0)
 ; ADDITIONAL PARAMETER TO SAVE DISCREET INFORMATION
"RTN","DSIO3",16,0)
 ; ARRAY(#)=LABEL/FIELD^VALUE
"RTN","DSIO3",17,0)
 ;
"RTN","DSIO3",18,0)
 ;  TIUX(.02)=PATIENT                       -UPDATE,ADDENDA
"RTN","DSIO3",19,0)
 ; TIUX(1202)=AUTHOR/DICTATOR
"RTN","DSIO3",20,0)
 ; TIUX(1205)=HOSPITAL LOCATION
"RTN","DSIO3",21,0)
 ; TIUX(1208)=EXPECTED COSIGNER
"RTN","DSIO3",22,0)
 ; TIUX(1301)=REFERENCE DATE/DT OF ENTRY    -UPDATE,ADDENDA
"RTN","DSIO3",23,0)
 ; TIUX(1302)=ENTERED BY                    -UPDATE,ADDENDA
"RTN","DSIO3",24,0)
 ; TIUX(1405)=PKGREF
"RTN","DSIO3",25,0)
 ; TIUX(1701)=SUBJECT
"RTN","DSIO3",26,0)
 ; TIUX(2101)=IDPARENT
"RTN","DSIO3",27,0)
 ;
"RTN","DSIO3",28,0)
 ; ORDER:
"RTN","DSIO3",29,0)
 ; CREATE - BOILER - LOCK - UPDATE - SET - UNLOCK
"RTN","DSIO3",30,0)
 ;
"RTN","DSIO3",31,0)
 ; RETURN: LITERAL
"RTN","DSIO3",32,0)
 ;
"RTN","DSIO3",33,0)
 N VSTR,DTIUX,IEN,TMP,BLR S RET="0^Title not found."
"RTN","DSIO3",34,0)
 S TITLE=$$FIND1^DIC(8925.1,,"O",TITLE) Q:TITLE=0
"RTN","DSIO3",35,0)
 S VSTR=$$VISIT(TITLE) I +VSTR<1 Q
"RTN","DSIO3",36,0)
 S DTIUX(1202)=DUZ,DTIUX(1701)=$G(SUBJ)
"RTN","DSIO3",37,0)
 S DTIUX(1205)=$P(VSTR,";"),DTIUX(1301)=$P(VSTR,";",2)
"RTN","DSIO3",38,0)
 ; MAKE^TIUSRVP(.IEN,DFN,TITLE,VDT,VLOC,VSIT,TIUX,VSTR,SUPPRESS,NOASF)
"RTN","DSIO3",39,0)
 D MAKE^TIUSRVP(.IEN,DFN,TITLE,,,,.DTIUX,VSTR,1)
"RTN","DSIO3",40,0)
 I +IEN<1 S RET=IEN Q
"RTN","DSIO3",41,0)
 D BLRSHELL^TIUSRVD(.TMP,TITLE,DFN,VSTR) I $D(TMP) M BLR("TEXT")=@TMP
"RTN","DSIO3",42,0)
 D UPDATE1
"RTN","DSIO3",43,0)
 Q
"RTN","DSIO3",44,0)
 ;
"RTN","DSIO3",45,0)
VISIT(TITLE) ; GET VISIT INFORMATION FROM A TITLE
"RTN","DSIO3",46,0)
 ; ONLY WORKS WITH RPC: DSIO CREATE A NOTE
"RTN","DSIO3",47,0)
 ;
"RTN","DSIO3",48,0)
 ; RETURN THE VISIT STRING OR -1^MESSAGE
"RTN","DSIO3",49,0)
 ;
"RTN","DSIO3",50,0)
 ; [VDT]   = Date(/Time) of Visit
"RTN","DSIO3",51,0)
 ; [VLOC]  = Visit Location (HOSPITAL LOCATION)
"RTN","DSIO3",52,0)
 ; [VSIT]  = Visit file ien (#9000010)
"RTN","DSIO3",53,0)
 ; [VSTR]  = Visit string (i.e., VLOC;VDT;VTYPE)
"RTN","DSIO3",54,0)
 ;
"RTN","DSIO3",55,0)
 ; VTYPE = Service Category (SET OF CODES - 9000010(VISIT FILE) - .07)
"RTN","DSIO3",56,0)
 ;
"RTN","DSIO3",57,0)
 N MSG,VLOC,VTYPE S MSG=" - please check the DSIO TITLE CONFIGURATION file."
"RTN","DSIO3",58,0)
 S VLOC=$$GET1^DIQ(19641.5,TITLE_",",.02,"I")
"RTN","DSIO3",59,0)
 I +VLOC<1 Q "0^Invaild VISIT LOCATION"_MSG
"RTN","DSIO3",60,0)
 S VTYPE=$$GET1^DIQ(19641.5,TITLE_",",.03)
"RTN","DSIO3",61,0)
 I $L(VTYPE)'=1 Q "0^Invaild SERVICE CATEGORY"_MSG
"RTN","DSIO3",62,0)
 Q +VLOC_";"_$$NOW^XLFDT_";"_VTYPE
"RTN","DSIO3",63,0)
 ;
"RTN","DSIO3",64,0)
SET(RET,IEN,NOTE,DATA,SUBJ) ; RPC: DSIO UPDATE A NOTE
"RTN","DSIO3",65,0)
 ; 
"RTN","DSIO3",66,0)
 ; REQUIRED INPUT:
"RTN","DSIO3",67,0)
 ; ---------------
"RTN","DSIO3",68,0)
 ; IEN,NOTE
"RTN","DSIO3",69,0)
 ;
"RTN","DSIO3",70,0)
 ; THIS RETURN ALSO APPLIES TO CREATE AND ADDENDUM
"RTN","DSIO3",71,0)
 ; -----------------------------------------------
"RTN","DSIO3",72,0)
 ; If successful:
"RTN","DSIO3",73,0)
 ;   <IEN in TIU DOCUMENT FILE>^<LAST_PAGE_RECEIVED>^<TOTAL_PAGES_EXPECTED>
"RTN","DSIO3",74,0)
 ; 
"RTN","DSIO3",75,0)
 ; If unsuccessful:
"RTN","DSIO3",76,0)
 ;   0^0^0^Explanatory text
"RTN","DSIO3",77,0)
 ;
"RTN","DSIO3",78,0)
 ; RETURN: LITERAL
"RTN","DSIO3",79,0)
 ;
"RTN","DSIO3",80,0)
 Q:'$$AUTH(.RET,IEN,"EDIT RECORD")
"RTN","DSIO3",81,0)
UPDATE ;
"RTN","DSIO3",82,0)
 S DTIUX(1301)=$$NOW^XLFDT
"RTN","DSIO3",83,0)
UPDATE1 ;
"RTN","DSIO3",84,0)
 N:'$D(DTIUX) DTIUX N NOTIN,CT,I,X
"RTN","DSIO3",85,0)
 S DTIUX(1202)=DUZ S:$G(SUBJ)'="" DTIUX(1701)=SUBJ
"RTN","DSIO3",86,0)
 Q:'$$LCK(.RET,IEN)
"RTN","DSIO3",87,0)
 D UPDATE^TIUSRVP(.RET,IEN,.DTIUX,0) I $P(RET,U,2)=1 D  Q
"RTN","DSIO3",88,0)
 .S RET="0^Error updating." D UNLCK(IEN)
"RTN","DSIO3",89,0)
 D SETDATA(IEN,.DATA)
"RTN","DSIO3",90,0)
 I $D(BLR) M NOTIN=BLR S CT=$O(NOTIN("TEXT",""),-1)+1
"RTN","DSIO3",91,0)
 S CT=1,X="" F I=CT:1 S X=$O(NOTE(X)) Q:X=""  S NOTIN("TEXT",I,0)=NOTE(X)
"RTN","DSIO3",92,0)
 S NOTIN("HDR")="1^1" ;<# of Current Page>^<Total # of Pages>
"RTN","DSIO3",93,0)
 D SETTEXT^TIUSRVPT(.RET,IEN,.NOTIN),UNLCK(IEN)
"RTN","DSIO3",94,0)
 S:+RET=0 RET="0^"_$P(RET,U,4)
"RTN","DSIO3",95,0)
 Q
"RTN","DSIO3",96,0)
 ;
"RTN","DSIO3",97,0)
ADDEN(RET,IEN,NOTE,DATA,SUBJ) ; RPC: DSIO MAKE ADDENDUM
"RTN","DSIO3",98,0)
 ;
"RTN","DSIO3",99,0)
 ; RETURN: LITERAL
"RTN","DSIO3",100,0)
 ;
"RTN","DSIO3",101,0)
 N DTIUX,AIEN
"RTN","DSIO3",102,0)
 Q:'$$AUTH(.RET,IEN,"MAKE ADDENDUM")
"RTN","DSIO3",103,0)
 S DTIUX(1202)=DUZ,DTIUX(1301)=$$NOW^XLFDT
"RTN","DSIO3",104,0)
 S:$G(SUBJ)'="" DTIUX(1701)=SUBJ
"RTN","DSIO3",105,0)
 D MAKEADD^TIUSRVP(.AIEN,IEN,.DTIUX) I +AIEN=-1 S RET="0^"_$P(AIEN,U,4) Q
"RTN","DSIO3",106,0)
 S IEN=AIEN D UPDATE1
"RTN","DSIO3",107,0)
 Q
"RTN","DSIO3",108,0)
 ;
"RTN","DSIO3",109,0)
GET(RET,IEN,TYP) ; RPC: DSIO GET RECORD TEXT
"RTN","DSIO3",110,0)
 ;
"RTN","DSIO3",111,0)
 ; - TYP PARAMETER 
"RTN","DSIO3",112,0)
 ;   - NULL - WHOLE NOTE WITH DISCREET DATA AND ADDENDA
"RTN","DSIO3",113,0)
 ;   - H - ONLY THE HEADER
"RTN","DSIO3",114,0)
 ;   - B - ONLY THE BODY
"RTN","DSIO3",115,0)
 ;
"RTN","DSIO3",116,0)
 ; RETURN: GLOBAL ARRAY
"RTN","DSIO3",117,0)
 ;
"RTN","DSIO3",118,0)
 N LIST,FLD,OUT,I,LN,FLG,TIUARR,DATA,NCLSS,REC S TYP=$G(TYP)
"RTN","DSIO3",119,0)
 S LIST(IEN)="",RET=$NA(^TMP("DSIO TIUVIEW",$J)) K @RET
"RTN","DSIO3",120,0)
 S FLD=".01;.06;.07;1301;1204;1208;1701;1205;1405;2101;70201;70202"
"RTN","DSIO3",121,0)
 ;
"RTN","DSIO3",122,0)
 ; RETURN JUST THE BODY OF THE NOTE FOR EDIT
"RTN","DSIO3",123,0)
 I TYP="B" D  Q
"RTN","DSIO3",124,0)
 .D GET4EDIT^TIUSRVR(.OUT,IEN,FLD)
"RTN","DSIO3",125,0)
 .S I=0,LN=$NA(@OUT) F  S LN=$Q(@LN) Q:LN=""  Q:$QS(LN,1)'="TIUEDIT"!($QS(LN,2)'=$J)  D
"RTN","DSIO3",126,0)
 ..I @LN="$TXT" S FLG=1 Q
"RTN","DSIO3",127,0)
 ..Q:'$D(FLG)
"RTN","DSIO3",128,0)
 ..S @RET@(I)=@LN,I=I+1
"RTN","DSIO3",129,0)
 ;
"RTN","DSIO3",130,0)
 Q:'$$AUTH(.RET,IEN,"VIEW")
"RTN","DSIO3",131,0)
 ; RETURN JUST THE HEADER OF THE NOTE
"RTN","DSIO3",132,0)
 I TYP="H" D  Q
"RTN","DSIO3",133,0)
 .S TIUARR=RET,DATA=$$SETGDATA^TIUSRVR1(IEN)
"RTN","DSIO3",134,0)
 .; Set a flag to indicate whether or not a Title is a memer of the
"RTN","DSIO3",135,0)
 .; Clinical Procedures Class (1=Yes and 0=No)
"RTN","DSIO3",136,0)
 .S NCLSS=+$$ISA^TIULX(+$G(^TIU(8925,IEN,0)),+$$CLASS^TIUCP)
"RTN","DSIO3",137,0)
 .; Call INQUIRE to get record
"RTN","DSIO3",138,0)
 .D INQUIRE^TIUSRVR2(IEN,.REC,NCLSS)
"RTN","DSIO3",139,0)
 .D LOADTOP^TIUSRVR1(.REC,IEN,0,DATA,NCLSS)
"RTN","DSIO3",140,0)
 ;
"RTN","DSIO3",141,0)
 ; RETURN THE WHOLE NOTE WITH DISCREET DATA
"RTN","DSIO3",142,0)
 D TGET^TIUSRVR1(.RET,IEN),GETS(.RET,IEN),ADD(IEN)
"RTN","DSIO3",143,0)
 Q
"RTN","DSIO3",144,0)
 ;
"RTN","DSIO3",145,0)
ADD(IEN) ;
"RTN","DSIO3",146,0)
 N SCR,CT,OUT,ERR,I S SCR="I $P(^(0),U,6)=IEN,$$STATUS^DSIO3(Y)"
"RTN","DSIO3",147,0)
 ; DOES IT HAVE ADDENDA? IF YES THEN GET ADDENDA
"RTN","DSIO3",148,0)
 I $$HASKIDS^TIUSRVLI(IEN) D
"RTN","DSIO3",149,0)
 .S CT=$O(@RET@(""),-1)+1
"RTN","DSIO3",150,0)
 .S @RET@(CT)="------------------------ ADDENDA -----------------------"
"RTN","DSIO3",151,0)
 .D LIST^DIC(8925,,"@;.01;.05;1201;1202","P",,,,"DAD",SCR,,"OUT","ERR") Q:$D(ERR)
"RTN","DSIO3",152,0)
 .S I=0 F  S I=$O(OUT("DILIST",I)) Q:I=""  D
"RTN","DSIO3",153,0)
 ..S @RET@(CT+I)=OUT("DILIST",I,0)
"RTN","DSIO3",154,0)
 Q
"RTN","DSIO3",155,0)
 ;
"RTN","DSIO3",156,0)
DELETE(RET,IEN,JUST) ; RPC: DSIO DELETE A NOTE
"RTN","DSIO3",157,0)
 ;
"RTN","DSIO3",158,0)
 ; RETURN: LITERAL
"RTN","DSIO3",159,0)
 ;
"RTN","DSIO3",160,0)
 Q:'$$AUTH(.RET,IEN,"DELETE RECORD")
"RTN","DSIO3",161,0)
 D NEEDJUST^TIUSRVA(.RET,IEN) I +RET=1&($G(JUST)="") D  Q
"RTN","DSIO3",162,0)
 .S RET="0^Justification for deletion is required."
"RTN","DSIO3",163,0)
 Q:'$$LCK(.RET,IEN)
"RTN","DSIO3",164,0)
 D DELETE^TIUSRVP(.RET,IEN,$G(JUST)) I +RET=0 S RET=1
"RTN","DSIO3",165,0)
 I +RET>1 S $P(RET,U)=0
"RTN","DSIO3",166,0)
 D UNLCK(IEN)
"RTN","DSIO3",167,0)
 Q
"RTN","DSIO3",168,0)
 ;
"RTN","DSIO3",169,0)
SIGN(RET,IEN,SIG) ; RPC: DSIO SIGN A NOTE
"RTN","DSIO3",170,0)
 ;
"RTN","DSIO3",171,0)
 ; RETURN: LITERAL
"RTN","DSIO3",172,0)
 ;
"RTN","DSIO3",173,0)
 ; $$ENCRYP^XUSRB1 - DEBUG
"RTN","DSIO3",174,0)
 ;
"RTN","DSIO3",175,0)
 D SAVED^TIUSRVP1(.RET,IEN) Q:+RET=0
"RTN","DSIO3",176,0)
 Q:'$$LCK(.RET,IEN)
"RTN","DSIO3",177,0)
 N ACT D WHATACT^TIUSRVA(.ACT,IEN)
"RTN","DSIO3",178,0)
 Q:'$$AUTH(.RET,IEN,ACT)
"RTN","DSIO3",179,0)
 D SIGN^TIUSRVP(.RET,IEN,SIG),UNLCK(IEN)
"RTN","DSIO3",180,0)
 S:+RET=0&($P(RET,U,2)="") RET=1
"RTN","DSIO3",181,0)
 Q
"RTN","DSIO3",182,0)
 ;
"RTN","DSIO3",183,0)
LIST(RET,DFN,TITLE,SORT) ; RPC: DSIO NOTES BY DFN AND TITLE
"RTN","DSIO3",184,0)
 ;
"RTN","DSIO3",185,0)
 ; SORT: PAGE#,CT
"RTN","DSIO3",186,0)
 ;
"RTN","DSIO3",187,0)
 ; X-REF: ACLPT = ALL OF PATIENTS PROGRESS NOTES IF
"RTN","DSIO3",188,0)
 ;                ^TIU(8925,"ACLPT",3(DOC CLASS-PROGRESS NOTES),8(DFN),DT,NOTE IEN
"RTN","DSIO3",189,0)
 ;
"RTN","DSIO3",190,0)
 ; STATUS : POINTER TO TIU STATUS FILE (#8925.6)
"RTN","DSIO3",191,0)
 ;
"RTN","DSIO3",192,0)
 ; RETURN: GLOBAL ARRAY - LIST ITEM^IEN^SUBJECT^STATUS(.05)^ENTRY DATE/TIME(1201)^
"RTN","DSIO3",193,0)
 ;                        AUTHOR/DICTATOR(1202)^VISIT LOCATION(1211)^LINKED DOC(.06)
"RTN","DSIO3",194,0)
 ; LINKED DOC
"RTN","DSIO3",195,0)
 ; ----------
"RTN","DSIO3",196,0)
 ; O:## = ORIGINAL DOC'S IEN
"RTN","DSIO3",197,0)
 ; A:## = ADDENDA DOC'S IEN
"RTN","DSIO3",198,0)
 ;
"RTN","DSIO3",199,0)
 N TNAM,OUT,SCR,ERR,TO,REC,STRT,T,CT,Z,I,LN S TNAM=TITLE
"RTN","DSIO3",200,0)
 S RET=$NA(^TMP($J,"DSIO LISTRET")),OUT=$NA(^TMP($J,"DSIO TIULIST"))
"RTN","DSIO3",201,0)
 K @RET,@OUT S @RET@(0)="0^Title not found."
"RTN","DSIO3",202,0)
 S TITLE=$$FIND1^DIC(8925.1,,"O",TITLE) Q:TITLE=0
"RTN","DSIO3",203,0)
 S (REC,TO,STRT,T)=0 I $G(SORT)?.N1",".N D
"RTN","DSIO3",204,0)
 .S STRT=$$FN^DSIO2($P(SORT,","),$P(SORT,",",2))
"RTN","DSIO3",205,0)
 S SCR="I +^(0)=TITLE,$P(^(0),U,2)=DFN,$$STATUS^DSIO3(Y) S TO=TO+1"
"RTN","DSIO3",206,0)
 D LIST^DIC(8925,,"@;1701;.05;1201;1202","P",,,,"B",SCR,,OUT,"ERR") Q:$D(ERR)
"RTN","DSIO3",207,0)
 I '$O(@OUT@("DILIST",""),-1) S @RET@(0)="Patient has no "_TNAM_" notes." Q
"RTN","DSIO3",208,0)
 S CT=1,Z="" F I=0:1 S Z=$O(@OUT@("DILIST",Z),-1) Q:Z=""  D 
"RTN","DSIO3",209,0)
 .Q:I<STRT
"RTN","DSIO3",210,0)
 .I $P($G(SORT),",",2)'="" I T>=$P($G(SORT),",",2) S T=T+1 Q
"RTN","DSIO3",211,0)
 .I Z'=0 S LN=@OUT@("DILIST",Z,0) D
"RTN","DSIO3",212,0)
 ..S REC=REC+1,@RET@(CT)=REC_U_LN_U_$$GET1^DIQ(8925,+LN_",",1211)_U D PARTS(+LN)
"RTN","DSIO3",213,0)
 ..S T=T+1,CT=CT+1
"RTN","DSIO3",214,0)
 K @OUT I T>0 S @RET@(0)=TO
"RTN","DSIO3",215,0)
 E  S @RET@(0)="0^No notes found."
"RTN","DSIO3",216,0)
 Q
"RTN","DSIO3",217,0)
 ;
"RTN","DSIO3",218,0)
PARTS(IEN) ;
"RTN","DSIO3",219,0)
 N SCR,SUB,ERR,I,IENS S SCR="I $P(^(0),U,6)=IEN,$$STATUS^DSIO3(Y)"
"RTN","DSIO3",220,0)
 ;
"RTN","DSIO3",221,0)
 ; DOES IT HAVE ADDENDA? IF YES THEN GET ADDENDA
"RTN","DSIO3",222,0)
 I $$HASKIDS^TIUSRVLI(IEN) D  S CT=$O(@RET@(""),-1)
"RTN","DSIO3",223,0)
 .D LIST^DIC(8925,,"@;.01;.05;1201;1202","P",,,,"DAD",SCR,,"SUB","ERR") Q:$D(ERR)
"RTN","DSIO3",224,0)
 .S I=0 F  S I=$O(SUB("DILIST",I)) Q:I=""  D
"RTN","DSIO3",225,0)
 ..K IENS S IENS=+SUB("DILIST",I,0)
"RTN","DSIO3",226,0)
 ..S @RET@(CT)=@RET@(CT)_"A:"_IENS_";"
"RTN","DSIO3",227,0)
 ..S @RET@(CT+I)=REC_U_SUB("DILIST",I,0)_U_$$GET1^DIQ(8925,IENS_",",1211)_U_"O:"_IEN
"RTN","DSIO3",228,0)
 ..S $P(@RET@(CT+I),U,2)=$P(@RET@(CT+I),U,2)_" to "_$P(@RET@(CT),U,2)
"RTN","DSIO3",229,0)
 ;
"RTN","DSIO3",230,0)
 ; IS IT ADDENDA? IF YES THEN GET ORIGINAL DOC
"RTN","DSIO3",231,0)
 I $$HASDAD^TIUSRVLI(IEN) D
"RTN","DSIO3",232,0)
 .; THE $P(^(0),U,6) IS PARENT (P8925'), [0;6] (IEN OF THE PARENT DOC)
"RTN","DSIO3",233,0)
 .S @RET@(CT)=@RET@(CT)_"O:"_$$GET1^DIQ(8925,IEN,.06,"I")
"RTN","DSIO3",234,0)
 Q
"RTN","DSIO3",235,0)
 ;
"RTN","DSIO3",236,0)
STATUS(IEN) ; CHECK THE STATUS OF THE NOTE, CAN THIS USER VIEW IT
"RTN","DSIO3",237,0)
 N RET I '$$AUTH(.RET,IEN,"VIEW") Q 0
"RTN","DSIO3",238,0)
 Q 1
"RTN","DSIO3",239,0)
 ;
"RTN","DSIO3",240,0)
 ;=====================================================================
"RTN","DSIO3",241,0)
 ;               D I S C R E E T  D A T A  E L E M E N T S
"RTN","DSIO3",242,0)
 ;=====================================================================
"RTN","DSIO3",243,0)
 ;
"RTN","DSIO3",244,0)
 ; DSIO TIU DISCREET CONTROL (FILE TO PUSH DISCREET DATA ELEMENTS
"RTN","DSIO3",245,0)
 ;                            ELSEWHERE) (19641.4)
"RTN","DSIO3",246,0)
 ; - FIRST BY TIU DOCUMENT DEFINITION (8925.1) THEN BY DATA ELEMENT
"RTN","DSIO3",247,0)
 ;   - A DOCUMENT DEFINITION CAN CONTROL MANY DATA ELEMENTS
"RTN","DSIO3",248,0)
 ;     - THUS IF A DATA ELEMENT IS WITHIN THE DOC DEFINITION IT WILL
"RTN","DSIO3",249,0)
 ;       EXECUTE PROVIDED M CODE TO SAVE THE DATA ELSEWHERE
"RTN","DSIO3",250,0)
 ;
"RTN","DSIO3",251,0)
 ; DSIO TIU DISCREET DATA (FILE THAT STORES THE DISCREET DATA) (19641.41)
"RTN","DSIO3",252,0)
 ; - FIRST BY PATIENT - THEN BY NOTE (8925)
"RTN","DSIO3",253,0)
 ;   - THUS MULTIPLE PATIENT NOTES (EVEN OF THE SAME TYPE) CAN HAVE
"RTN","DSIO3",254,0)
 ;     DIFFERENT DISCREET DATA ELEMENTS
"RTN","DSIO3",255,0)
 ;
"RTN","DSIO3",256,0)
 ; DSIOSILENT - SET THIS TO PREVENT THE SPECIAL X-REFS FROM TRIGGERING
"RTN","DSIO3",257,0)
 ;              THAT HELP A USER TO CREATE AN ENTRY THROUGH FM
"RTN","DSIO3",258,0)
 ;
"RTN","DSIO3",259,0)
CONTROL(IEN,FLD,S,M,WP) ; CHECK THE CONTROL FILE AND XECUTE ADDITIONAL CODE
"RTN","DSIO3",260,0)
 N DFN,TITLE,RET,XE S S=$G(S),M=$G(M),WP=$G(WP)
"RTN","DSIO3",261,0)
 S DFN=$$GET1^DIQ(8925,IEN_",",.02,"I") Q:DFN=""
"RTN","DSIO3",262,0)
 S TITLE=$$TITLE(.RET,IEN) Q:TITLE<1
"RTN","DSIO3",263,0)
 K RET S RET=$$FIND1^DIC(19641.4,,"A",TITLE) Q:RET=0
"RTN","DSIO3",264,0)
 K RET S RET=$$FIND1^DIC(19641.42,","_TITLE_",","X",FLD) Q:RET=0
"RTN","DSIO3",265,0)
 S XE=$$GET1^DIQ(19641.42,RET_","_TITLE,1) X:XE'="" XE
"RTN","DSIO3",266,0)
 Q
"RTN","DSIO3",267,0)
 ;
"RTN","DSIO3",268,0)
SETDATA(IEN,DATA,SOR,DIEN) ; SAVE DATA AS DISCREET ELEMENTS FOR A TIU NOTE
"RTN","DSIO3",269,0)
 ;
"RTN","DSIO3",270,0)
 ; DSIO NOTE CONTROL = 19641.4
"RTN","DSIO3",271,0)
 ;    DSIO NOTE DATA = 19641.41
"RTN","DSIO3",272,0)
 ;  .01          NOTE
"RTN","DSIO3",273,0)
 ;  .02          JOB      - USER JOB NUMBER TO OVERWRITE DATA DURING A SESSION
"RTN","DSIO3",274,0)
 ;  1            DATA     (multiple)
"RTN","DSIO3",275,0)
 ;  2            DIALOGS  (multiple)
"RTN","DSIO3",276,0)
 ;
"RTN","DSIO3",277,0)
 ;  IEN = TIU DOCUMENT     - IEN OF 8925
"RTN","DSIO3",278,0)
 ; DATA = ELEMENTS TO FILE - FIELD^DATA
"RTN","DSIO3",279,0)
 ;  SOR = SOURCE           - O(THER),C(NT),D(IALOG),R(EMINDER DIALOG)
"RTN","DSIO3",280,0)
 ; DIEN = DIALOG IEN       - FILE 19641.49
"RTN","DSIO3",281,0)
 ;
"RTN","DSIO3",282,0)
 ; DSIO NOTE (S,M,WP) - FIELDS
"RTN","DSIO3",283,0)
 ;  .01          FIELD
"RTN","DSIO3",284,0)
 ;  1.1          VALUE  (MULTIPLE, WORD PROCESSING)
"RTN","DSIO3",285,0)
 ;  2.1          NOTE
"RTN","DSIO3",286,0)
 ;  2.2          SOURCE
"RTN","DSIO3",287,0)
 ;  2.3          DATE
"RTN","DSIO3",288,0)
 ;  2.4          CONTROL (NAME OF THE DELPHI CONTROL OR REMINDER DIALOG IEN)
"RTN","DSIO3",289,0)
 ;
"RTN","DSIO3",290,0)
 ; TYPE^ID^FIELD^VALUE
"RTN","DSIO3",291,0)
 ;
"RTN","DSIO3",292,0)
 ;  TYPE : S - SINGLE (IGNORES ID)
"RTN","DSIO3",293,0)
 ;         M - MULTIPLE (FIRST FIELD NAME TAKES PRIORITY)
"RTN","DSIO3",294,0)
 ;        WP - WORD PROCESSING (FIRST FIELD NAME TAKES PRIORITY)
"RTN","DSIO3",295,0)
 ; FIELD : THE LABEL OR CAPTION
"RTN","DSIO3",296,0)
 ; VALUE : THE VALUE TO BE STORED
"RTN","DSIO3",297,0)
 ;
"RTN","DSIO3",298,0)
 ; EXAMPLE ARRAY:
"RTN","DSIO3",299,0)
 ; --------------
"RTN","DSIO3",300,0)
 ;  S^CONTROL^LABEL 1^SOME VALUE
"RTN","DSIO3",301,0)
 ;  S^CONTROL^LABEL 2^SOME OTHER VALUE
"RTN","DSIO3",302,0)
 ;  M^CONTROL^M LABEL^VALUE 1^INDEX
"RTN","DSIO3",303,0)
 ;  M^CONTROL^M LABEL^VALUE 2^INDEX
"RTN","DSIO3",304,0)
 ; WP^CONTROL^WP LABEL^THIS TYPE IS USED MORE FOR A FIELD THAT
"RTN","DSIO3",305,0)
 ; WP^CONTROL^WP LABEL^CONTAINS A LOT OF TEXT THAT'S MEANT TO BE READ
"RTN","DSIO3",306,0)
 ; WP^CONTROL^WP LABEL^TOGETHER.
"RTN","DSIO3",307,0)
 ;
"RTN","DSIO3",308,0)
 ; REMINDER DIALOG - SOR = R
"RTN","DSIO3",309,0)
 ; -------------------------
"RTN","DSIO3",310,0)
 ;  S^CLASS|IENS^CAPTION^SOME OTHER VALUE^NOTE TEXT
"RTN","DSIO3",311,0)
 ;  M^CLASS|IENS^CAPTION^VALUE 1^INDEX^NOTE TEXT
"RTN","DSIO3",312,0)
 ; WP^CLASS|IENS^CAPTION^THIS TYPE IS USED MORE FOR A FIELD THAT...^NOTE TEXT
"RTN","DSIO3",313,0)
 ;
"RTN","DSIO3",314,0)
 N DSIOSILENT,DIC,DA,X,Y,CT,TYP,DONE,FLE,OUT,IENS,IPT,IPTI,ID,I,TMP,WP,PE
"RTN","DSIO3",315,0)
 N CM,CWP,RPL,SCR,MFLE,MIENS,ND S RPL=0,SOR=$G(SOR,"O"),DSIOSILENT=1
"RTN","DSIO3",316,0)
 S DIC="^DSIO(19641.41,",DIC(0)="XL",X="`"_IEN D ^DIC
"RTN","DSIO3",317,0)
 ;
"RTN","DSIO3",318,0)
 S CT="" F  S CT=$O(DATA(CT)) Q:CT=""  D  K DB
"RTN","DSIO3",319,0)
 .S TYP=$P(DATA(CT),U) Q:$D(DONE(CT))
"RTN","DSIO3",320,0)
 .S FLE=$S(TYP="S":19641.43,TYP="M":19641.44,TYP="WP":19641.45,1:0) Q:FLE=0
"RTN","DSIO3",321,0)
 .;
"RTN","DSIO3",322,0)
 .; SESSION HANDLING
"RTN","DSIO3",323,0)
 .I $$GET1^DIQ(19641.41,IEN_",",.02)=$J S RPL=1
"RTN","DSIO3",324,0)
 .;
"RTN","DSIO3",325,0)
 .I RPL D  I +IENS<1 S RPL=0
"RTN","DSIO3",326,0)
 ..I SOR="D" S MFLE=19641.4121,MIENS=","_DIEN_","_IEN_","
"RTN","DSIO3",327,0)
 ..I SOR'="D" S MFLE=19641.411,MIENS=","_IEN_","
"RTN","DSIO3",328,0)
 ..S SCR="I $P(^(0),U,2)=$J,$$GET1^DIQ($TR($P($P(X,"";"",2),""("",2),"","""
"RTN","DSIO3",329,0)
 ..S SCR=SCR_",""""),$P(X,"";"")_"","",2.4)="""_$P(DATA(CT),U,2)_""""
"RTN","DSIO3",330,0)
 ..D LIST^DIC(MFLE,MIENS,,"BP",1,,,"J",SCR,,"OUT")
"RTN","DSIO3",331,0)
 ..S ND=$P($G(OUT("DILIST",+$O(OUT("DILIST",""),-1),0)),U)
"RTN","DSIO3",332,0)
 ..S IENS=$P($$GET1^DIQ(MFLE,ND_MIENS,.01,"I"),";")
"RTN","DSIO3",333,0)
 .;
"RTN","DSIO3",334,0)
 .; CREATE THE DATA ENTRY IF NOT REPLACING
"RTN","DSIO3",335,0)
 .I 'RPL D  Q:$G(CK(IENS))=""
"RTN","DSIO3",336,0)
 ..S IPT(19641.41,IEN_",",.02)=$J D UPDATE^DIE(,"IPT") K IPT
"RTN","DSIO3",337,0)
 ..D FILE^DID(FLE,,"ENTRIES","OUT") S IENS=OUT("ENTRIES")+1
"RTN","DSIO3",338,0)
 ..S IPT(FLE,"+"_IENS_",",.01)=$$TRIM^XLFSTR($TR($P(DATA(CT),U,3),":",""))
"RTN","DSIO3",339,0)
 ..S IPT(FLE,"+"_IENS_",",2.1)="`"_IEN
"RTN","DSIO3",340,0)
 ..S IPT(FLE,"+"_IENS_",",2.2)=SOR
"RTN","DSIO3",341,0)
 ..S IPT(FLE,"+"_IENS_",",2.3)=$$NOW^XLFDT
"RTN","DSIO3",342,0)
 ..S IPT(FLE,"+"_IENS_",",2.4)=$P($P(DATA(CT),U,2),"|")
"RTN","DSIO3",343,0)
 ..I SOR="R" D
"RTN","DSIO3",344,0)
 ...I $P($P($P(DATA(CT),U,2),"|",2),",",2)'="" D
"RTN","DSIO3",345,0)
 ....S IPT(FLE,"+"_IENS_",",3.1)="`"_$P($P($P(DATA(CT),U,2),"|",2),",",2)
"RTN","DSIO3",346,0)
 ....S IPT(FLE,"+"_IENS_",",3.2)="`"_$P($P($P(DATA(CT),U,2),"|",2),",")
"RTN","DSIO3",347,0)
 ...E  S IPT(FLE,"+"_IENS_",",3.1)="`"_$P($P($P(DATA(CT),U,2),"|",2),",")
"RTN","DSIO3",348,0)
 ..D UPDATE^DIE("E","IPT","CK") K IPT
"RTN","DSIO3",349,0)
 .;
"RTN","DSIO3",350,0)
 .; ADD THE ENTRY INTO THE DATA FILE IF NOT REPLACING
"RTN","DSIO3",351,0)
 .I 'RPL D
"RTN","DSIO3",352,0)
 ..I SOR="D" D
"RTN","DSIO3",353,0)
 ...; SET THE DIALOG (DIEN) AS DINUM
"RTN","DSIO3",354,0)
 ...S DA(1)=IEN,DIC="^DSIO(19641.41,"_DA(1)_",2,",DIC(0)="XL",X="`"_DIEN
"RTN","DSIO3",355,0)
 ...D ^DIC Q:+Y<1
"RTN","DSIO3",356,0)
 ...S IPT(19641.4121,"?+1,"_DIEN_","_IEN_",",.01)=IENS_";DSIO("_FLE_","
"RTN","DSIO3",357,0)
 ...S IPT(19641.4121,"?+1,"_DIEN_","_IEN_",",.02)=$J
"RTN","DSIO3",358,0)
 ...D UPDATE^DIE(,"IPT") K IPT
"RTN","DSIO3",359,0)
 ..I SOR'="D" D
"RTN","DSIO3",360,0)
 ...S IPT(19641.411,"?+1,"_IEN_",",.01)=IENS_";DSIO("_FLE_","
"RTN","DSIO3",361,0)
 ...S IPT(19641.411,"?+1,"_IEN_",",.02)=$J
"RTN","DSIO3",362,0)
 ...D UPDATE^DIE(,"IPT") K IPT
"RTN","DSIO3",363,0)
 .;
"RTN","DSIO3",364,0)
 .; ADD NOTE TEXT
"RTN","DSIO3",365,0)
 .K ^TMP($J,"DSIO SETNOTE")
"RTN","DSIO3",366,0)
 .I $P(DATA(CT),U)="M"&($P(DATA(CT),U,6)'="") D
"RTN","DSIO3",367,0)
 ..S ^TMP($J,"DSIO SETNOTE",1,0)=$P(DATA(CT),U,6)
"RTN","DSIO3",368,0)
 .E  I $P(DATA(CT),U,5)'="" D
"RTN","DSIO3",369,0)
 ..S ^TMP($J,"DSIO SETNOTE",1,0)=$P(DATA(CT),U,5)
"RTN","DSIO3",370,0)
 .I $G(^TMP($J,"DSIO SETNOTE",1,0))'="" D
"RTN","DSIO3",371,0)
 ..D WP^DIE(FLE,IENS_",",4,"K","^TMP($J,""DSIO SETNOTE"")")
"RTN","DSIO3",372,0)
 .;
"RTN","DSIO3",373,0)
 .; S - SINGLE
"RTN","DSIO3",374,0)
 .I TYP="S" D
"RTN","DSIO3",375,0)
 ..S IPT(FLE,IENS_",",1.1)=$P(DATA(CT),U,4) D FILE^DIE(,"IPT") K IPT
"RTN","DSIO3",376,0)
 ..D CONTROL(IEN,$P(DATA(CT),U,3),$P(DATA(CT),U,4))
"RTN","DSIO3",377,0)
 .;
"RTN","DSIO3",378,0)
 .; M - MULTIPLE
"RTN","DSIO3",379,0)
 .I TYP="M" K CM D
"RTN","DSIO3",380,0)
 ..S ID=$P(DATA(CT),U,2) Q:ID=""
"RTN","DSIO3",381,0)
 ..S I="" F  S I=$O(DATA(I)) Q:I=""  D
"RTN","DSIO3",382,0)
 ...I $P(DATA(I),U,2)=ID&($P(DATA(I),U)="M") D
"RTN","DSIO3",383,0)
 ....I $P(DATA(I),U,5)="" S $P(DATA(I),U,5)="+"
"RTN","DSIO3",384,0)
 ....S (CM,IPT(19641.46,"?+1,"_IENS_",",.01))=$P(DATA(I),U,5)
"RTN","DSIO3",385,0)
 ....S IPT(19641.46,"?+1,"_IENS_",",.02)=$P(DATA(I),U,4),DONE(I)=""
"RTN","DSIO3",386,0)
 ....D:$D(IPT) UPDATE^DIE(,"IPT") K IPT
"RTN","DSIO3",387,0)
 ..D:$D(CM) CONTROL(IEN,$P(DATA(CT),U,3),,.CM)
"RTN","DSIO3",388,0)
 .;
"RTN","DSIO3",389,0)
 .; WP - WORD PROCESSING
"RTN","DSIO3",390,0)
 .I TYP="WP" K CWP D  K @TMP
"RTN","DSIO3",391,0)
 ..S TMP=$NA(^TMP($J,"SETDATA")) K @TMP
"RTN","DSIO3",392,0)
 ..S ID=$P(DATA(CT),U,2) Q:ID=""
"RTN","DSIO3",393,0)
 ..S WP=1,I="" F  S I=$O(DATA(I)) Q:I=""  D
"RTN","DSIO3",394,0)
 ...I $P(DATA(I),U,2)=ID&($P(DATA(I),U)="WP") D
"RTN","DSIO3",395,0)
 ....S (CWP,@TMP@(WP))=$P(DATA(I),U,4),DONE(I)="",WP=WP+1
"RTN","DSIO3",396,0)
 ..D:$G(@TMP@(1))'="" WP^DIE(FLE,IENS_",",1.1,"K","@TMP")
"RTN","DSIO3",397,0)
 ..D:$D(CWP) CONTROL(IEN,$P(DATA(CT),U,3),,,.CWP)
"RTN","DSIO3",398,0)
 ;
"RTN","DSIO3",399,0)
 S IPT(19641.41,IEN_",",.02)=$J D UPDATE^DIE(,"IPT") K IPT
"RTN","DSIO3",400,0)
 Q
"RTN","DSIO3",401,0)
 ;
"RTN","DSIO3",402,0)
GETS(ARY,IEN) ; APPEND DISCREET DATA TO A NOTE ARRAY
"RTN","DSIO3",403,0)
 N I,FLD,OUT,CT S I=$O(@ARY@(""),-1)+1
"RTN","DSIO3",404,0)
 S @ARY@(I)="----------------- DISCREET DATA FIELDS -----------------",I=I+1
"RTN","DSIO3",405,0)
 S FLD="" F  S FLD=$O(^DSIO(19641.41,"FLD",IEN,FLD)) Q:FLD=""  D
"RTN","DSIO3",406,0)
 .K OUT D GETDATA(.OUT,IEN,FLD) Q:'$D(OUT)
"RTN","DSIO3",407,0)
 .S @ARY@(I)=FLD_": "_OUT(0),I=I+1
"RTN","DSIO3",408,0)
 .I $O(OUT(""),-1)>0 S CT=0 F  S CT=$O(OUT(CT)) Q:CT=""  D
"RTN","DSIO3",409,0)
 ..S $E(@ARY@(I),$L(FLD)+3)=OUT(CT),I=I+1
"RTN","DSIO3",410,0)
 I @ARY@($O(@ARY@(""),-1))="----------------- DISCREET DATA FIELDS -----------------" D
"RTN","DSIO3",411,0)
 .K @ARY@($O(@ARY@(""),-1))
"RTN","DSIO3",412,0)
 Q
"RTN","DSIO3",413,0)
 ;
"RTN","DSIO3",414,0)
GETDATA(OUT,IEN,FLD) ; RPC: DSIO GET NOTE ELEMENT
"RTN","DSIO3",415,0)
 ;
"RTN","DSIO3",416,0)
 ; GET DATA SAVED AS DISCREET ELEMENTS LINKED TO A TIU NOTE
"RTN","DSIO3",417,0)
 ; THE FLD X-REF IS BUILT FROM FILES 19641.43,.44,.45
"RTN","DSIO3",418,0)
 ;
"RTN","DSIO3",419,0)
 ; RETURN: LIST
"RTN","DSIO3",420,0)
 ;
"RTN","DSIO3",421,0)
 N I,FLE,FI,CT,M S I=0,OUT(I)=""
"RTN","DSIO3",422,0)
 S FLD=$$UP^XLFSTR($G(FLD)) Q:FLD=""
"RTN","DSIO3",423,0)
 S FLE="" F  S FLE=$O(^DSIO(19641.41,"FLD",IEN,FLD,FLE)) Q:FLE=""  D
"RTN","DSIO3",424,0)
 .S FI="" F  S FI=$O(^DSIO(19641.41,"FLD",IEN,FLD,FLE,FI)) Q:FI=""  D
"RTN","DSIO3",425,0)
 ..I FLE[".43" S OUT(I)=$$GET1^DIQ(FLE,FI_",",1.1),I=I+1
"RTN","DSIO3",426,0)
 ..I FLE[".44" D
"RTN","DSIO3",427,0)
 ...K M D GETS^DIQ(FLE,FI_",","1.1*",,"M") I $D(M) D
"RTN","DSIO3",428,0)
 ....S CT=$NA(M) F  S CT=$Q(@CT) Q:CT=""  D
"RTN","DSIO3",429,0)
 .....I $QS(CT,3)=.01 S OUT(I)=@CT Q
"RTN","DSIO3",430,0)
 .....S OUT(I)=OUT(I)_U_@CT,I=I+1
"RTN","DSIO3",431,0)
 ..I FLE[".45" D
"RTN","DSIO3",432,0)
 ...K M D GETS^DIQ(FLE,FI_",","1.1",,"M") I $D(M) D
"RTN","DSIO3",433,0)
 ....S CT=$NA(M) F  S CT=$Q(@CT) Q:CT=""  S:$QL(CT)=4 OUT(I)=@CT,I=I+1
"RTN","DSIO3",434,0)
 Q
"RTN","DSIO3",435,0)
 ;
"RTN","DSIO3",436,0)
TRACK(RET,IENSTR) ; RPC: DSIO IS IT CONTROLLED?
"RTN","DSIO3",437,0)
 ;
"RTN","DSIO3",438,0)
 ; IS THIS A DISCREET DATA COLLECTING NOTE?
"RTN","DSIO3",439,0)
 ; ONLY LOOKING AT REMINDER DIALOGS
"RTN","DSIO3",440,0)
 ;
"RTN","DSIO3",441,0)
 S RET=0 I $D(^DSIO(19641.4,"B",IENSTR)) D
"RTN","DSIO3",442,0)
 .I '$$GET1^DIQ(19641.4,$O(^DSIO(19641.4,"B",IENSTR,""))_",",.02,"I") S RET=1
"RTN","DSIO3",443,0)
 Q
"RTN","DSIO3",444,0)
 ;
"RTN","DSIO3",445,0)
 ;=====================================================================
"RTN","DSIO3",446,0)
 ;                         U T I L I T I E S
"RTN","DSIO3",447,0)
 ;=====================================================================
"RTN","DSIO3",448,0)
 ;
"RTN","DSIO3",449,0)
TITLE(OUT,IEN) ; TIU GET DOCUMENT TITLE
"RTN","DSIO3",450,0)
 N RET S RET="" D GETTITLE^TIUSRVA(.RET,IEN)
"RTN","DSIO3",451,0)
 I +RET<1 S OUT="0^Title not found."
"RTN","DSIO3",452,0)
 Q +RET
"RTN","DSIO3",453,0)
 ;
"RTN","DSIO3",454,0)
AUTH(OUT,IEN,ACT) ; TIU AUTHORIZATION
"RTN","DSIO3",455,0)
 N RET S RET="" D CANDO^TIUSRVA(.RET,IEN,ACT)
"RTN","DSIO3",456,0)
 I +RET=0 D
"RTN","DSIO3",457,0)
 .I $G(OUT)["^TMP(" S @OUT@(0)=RET Q
"RTN","DSIO3",458,0)
 .S OUT=RET
"RTN","DSIO3",459,0)
 Q RET
"RTN","DSIO3",460,0)
 ;
"RTN","DSIO3",461,0)
LCK(OUT,IEN) ; TIU LOCK RECORD
"RTN","DSIO3",462,0)
 ;
"RTN","DSIO3",463,0)
 ; 0 if the LOCK was GRANTED
"RTN","DSIO3",464,0)
 ; 1^<Explanatory Message> if LOCK was DENIED
"RTN","DSIO3",465,0)
 ;
"RTN","DSIO3",466,0)
 ; TRANSFORMED: 0 IS FAIL
"RTN","DSIO3",467,0)
 ;              1 IS PASS
"RTN","DSIO3",468,0)
 ;
"RTN","DSIO3",469,0)
 S OUT="" D LOCK^TIUSRVP(.OUT,IEN) I +OUT=1 S $P(OUT,U)=0 Q OUT
"RTN","DSIO3",470,0)
 Q 1
"RTN","DSIO3",471,0)
 ;
"RTN","DSIO3",472,0)
UNLCK(IEN) ; TIU UNLOCK RECORD
"RTN","DSIO3",473,0)
 N OUT S OUT="" D UNLOCK^TIUSRVP(.OUT,IEN)
"RTN","DSIO3",474,0)
 Q 1
"RTN","DSIO3A")
0^4^B16113575
"RTN","DSIO3A",1,0)
DSIO3A ;DSS/TFF - DSIO IHE SUPPORT;06/28/2013 15:19
"RTN","DSIO3A",2,0)
 ;;1.0;DSS,INC OPEN SOURCE;;28 Jan 2013;Build 25
"RTN","DSIO3A",3,0)
 ;Copyright 1995-2014,Document Storage Systems Inc. All Rights Reserved
"RTN","DSIO3A",4,0)
 ;
"RTN","DSIO3A",5,0)
 ;
"RTN","DSIO3A",6,0)
 ; Documented API and ICRs
"RTN","DSIO3A",7,0)
 ; -----------------------
"RTN","DSIO3A",8,0)
 ;
"RTN","DSIO3A",9,0)
 Q
"RTN","DSIO3A",10,0)
 ;
"RTN","DSIO3A",11,0)
SAVE(RET,GUID,DFN,DIRECT,DTC,DTIE,DTYE,TITLE,FAC,REC,DOC) ; DSIO IHE SAVE
"RTN","DSIO3A",12,0)
 ;
"RTN","DSIO3A",13,0)
 ; .01    DFN = PATIENT NUMBER
"RTN","DSIO3A",14,0)
 ;   1 subfile - GUID
"RTN","DSIO3A",15,0)
 ; .01    GUID = GUID
"RTN","DSIO3A",16,0)
 ; .02     DTC = DATE/TIME OF CREATION
"RTN","DSIO3A",17,0)
 ; .03    DTIE = DATE/TIME OF IMPORT/EXPORT
"RTN","DSIO3A",18,0)
 ; .04    DTYE = DOCUMENT TYPE
"RTN","DSIO3A",19,0)
 ; .05  DIRECT = DIRECTION (IN/OUT)
"RTN","DSIO3A",20,0)
 ; 1.1   TITLE = DOCUMENT TITLE
"RTN","DSIO3A",21,0)
 ; 1.2     FAC = SENDING FACILITY/PROVIDER
"RTN","DSIO3A",22,0)
 ; 1.3     REC = INTENDED RECIPIENT
"RTN","DSIO3A",23,0)
 ; 2       DOC = DOCUMENT CONTENT IN XML
"RTN","DSIO3A",24,0)
 ;
"RTN","DSIO3A",25,0)
 N DIC,DA,X,Y,IPT,DATE,IEN,IENS,ERR,%X,%Y
"RTN","DSIO3A",26,0)
 S GUID=$G(GUID),DFN=$G(DFN),DIRECT=$G(DIRECT),DTC=$G(DTC)
"RTN","DSIO3A",27,0)
 S DTYE=$G(DTYE),TITLE=$G(TITLE),FAC=$G(FAC),REC=$G(REC),DOC=$G(DOC)
"RTN","DSIO3A",28,0)
 S DIC="^DSIO(19641.6,",DIC(0)="XL",X="`"_DFN D ^DIC
"RTN","DSIO3A",29,0)
 I +Y<1 S RET="-1^The DFN is invalid." Q
"RTN","DSIO3A",30,0)
 S IEN=+Y,IPT(19641.62,"+1,"_IEN_",",.01)=GUID
"RTN","DSIO3A",31,0)
 D UPDATE^DIE("E","IPT","IENS") K IPT
"RTN","DSIO3A",32,0)
 I +$G(IENS(1))<1 S RET="-1^The GUID is invalid or not unique." Q
"RTN","DSIO3A",33,0)
 S DATE=$$DT^DSIO2(DTC) I DATE=-1!('$$VALID(.02,DATE)) D  D DEL Q
"RTN","DSIO3A",34,0)
 .S RET="-1^Unable to translate Date of Creation."
"RTN","DSIO3A",35,0)
 S IPT(19641.62,IENS(1)_","_IEN_",",.02)=DATE
"RTN","DSIO3A",36,0)
 S DATE=$$DT^DSIO2($G(DTIE,$$NOW^XLFDT))
"RTN","DSIO3A",37,0)
 I (+DATE'=-1&('$$VALID(.03,DATE)))!(+DATE=-1&('$$VALID(.03,$P(DATE,U,2)))) D  D DEL Q
"RTN","DSIO3A",38,0)
 .S RET="-1^Unable to translate Date of Import/Export."
"RTN","DSIO3A",39,0)
 I +DATE=-1 S DATE=$P(DATE,U,2)
"RTN","DSIO3A",40,0)
 S IPT(19641.62,IENS(1)_","_IEN_",",.03)=DATE
"RTN","DSIO3A",41,0)
 I '$$VALID(.04,DTYE) D  D DEL Q
"RTN","DSIO3A",42,0)
 .S RET="-1^Unknown DOCUMENT TYPE."
"RTN","DSIO3A",43,0)
 S IPT(19641.62,IENS(1)_","_IEN_",",.04)=DTYE
"RTN","DSIO3A",44,0)
 I '$$VALID(.05,DIRECT) D  D DEL Q
"RTN","DSIO3A",45,0)
 .S RET="-1^Unknown DIRECTION."
"RTN","DSIO3A",46,0)
 S IPT(19641.62,IENS(1)_","_IEN_",",.05)=DIRECT
"RTN","DSIO3A",47,0)
 S IPT(19641.62,IENS(1)_","_IEN_",",1.1)=TITLE
"RTN","DSIO3A",48,0)
 S IPT(19641.62,IENS(1)_","_IEN_",",1.2)=FAC
"RTN","DSIO3A",49,0)
 S IPT(19641.62,IENS(1)_","_IEN_",",1.3)=REC
"RTN","DSIO3A",50,0)
 D FILE^DIE("E","IPT","ERR")
"RTN","DSIO3A",51,0)
 I $D(ERR) S RET=-1 Q
"RTN","DSIO3A",52,0)
 ;
"RTN","DSIO3A",53,0)
 ; WE CAN'T PROCESS THE ZERO NODE WITH WP^DIE SO INSTEAD OF MERGING
"RTN","DSIO3A",54,0)
 ; WE CAN USE %XY^%RCR TO CONCATENATE A SUBSCRIPT
"RTN","DSIO3A",55,0)
 ;
"RTN","DSIO3A",56,0)
 K ^TMP($J,"DSIOIHE")
"RTN","DSIO3A",57,0)
 S %X="DOC(",%Y="^TMP($J,""DSIOIHE"",1" D %XY^%RCR
"RTN","DSIO3A",58,0)
 D WP^DIE(19641.62,IENS(1)_","_IEN_",",2,"K","^TMP($J,""DSIOIHE"")")
"RTN","DSIO3A",59,0)
 K ^TMP($J,"DSIOIHE") S RET=IENS(1)_U_IEN
"RTN","DSIO3A",60,0)
 Q
"RTN","DSIO3A",61,0)
 ;
"RTN","DSIO3A",62,0)
DEL ; DELETE THE RECORD - THE IMPORT FAILED
"RTN","DSIO3A",63,0)
 N DIK,DA,X,Y
"RTN","DSIO3A",64,0)
 S DA(1)=IEN,DA=IENS(1),DIK="^DSIO(19641.6,"_DA(1)_",1," D ^DIK
"RTN","DSIO3A",65,0)
 Q
"RTN","DSIO3A",66,0)
 ;
"RTN","DSIO3A",67,0)
VALID(FLD,VAL) ; CHECK IF A VALUE IS VALID
"RTN","DSIO3A",68,0)
 N VALID,ERR D VAL^DIE(19641.62,IENS(1)_","_IEN_",",FLD,,VAL,.VALID,,"ERR")
"RTN","DSIO3A",69,0)
 I VALID["^"!($D(ERR)) Q 0
"RTN","DSIO3A",70,0)
 Q 1
"RTN","DSIO3A",71,0)
 ;
"RTN","DSIO3A",72,0)
LIST(RET,DFN,SORT) ; DSIO IHE PATIENT LIST
"RTN","DSIO3A",73,0)
 ;
"RTN","DSIO3A",74,0)
 ; RETURN:
"RTN","DSIO3A",75,0)
 ; COUNT
"RTN","DSIO3A",76,0)
 ; IEN^GUID^DATE OF CREATION^DATE OF IMPORT/EXPORT^TYPE^DIRECTION^TITLE^SENDING FAC^
"RTN","DSIO3A",77,0)
 ; INTENDED RECIPIENT
"RTN","DSIO3A",78,0)
 ;
"RTN","DSIO3A",79,0)
 N SCR,FLDS,OUT,ERR,STRT,T,CT,I,Z,TO S TO=0
"RTN","DSIO3A",80,0)
 S RET=$NA(^TMP($J,"DSIOIHEL")),OUT=$NA(^TMP($J,"DSIOIHEP")) K @RET,@OUT
"RTN","DSIO3A",81,0)
 S @RET@(0)=-1
"RTN","DSIO3A",82,0)
 S SCR="S TO=TO+1",FLDS="@;.01;.02;.03;.04;.05;1.1;1.2;1.3"
"RTN","DSIO3A",83,0)
 D LIST^DIC(19641.62,","_DFN_",",FLDS,"P",,,,"P",SCR,,OUT,"ERR") Q:$D(ERR)
"RTN","DSIO3A",84,0)
 S (STRT,T)=0 I $G(SORT)?.N1",".N D
"RTN","DSIO3A",85,0)
 .S STRT=$$FN^DSIO2($P(SORT,","),$P(SORT,",",2))
"RTN","DSIO3A",86,0)
 S CT=1,Z=0 F I=0:1 S Z=$O(@OUT@("DILIST",Z)) Q:Z=""  D
"RTN","DSIO3A",87,0)
 .Q:I<STRT
"RTN","DSIO3A",88,0)
 .I $P($G(SORT),",",2)'="" I T>=$P($G(SORT),",",2) S T=T+1 Q
"RTN","DSIO3A",89,0)
 .S @RET@(CT)=@OUT@("DILIST",Z,0)
"RTN","DSIO3A",90,0)
 .S T=T+1,CT=CT+1
"RTN","DSIO3A",91,0)
 I T>0 S @RET@(0)=TO
"RTN","DSIO3A",92,0)
 K @OUT
"RTN","DSIO3A",93,0)
 Q
"RTN","DSIO3A",94,0)
 ;
"RTN","DSIO3A",95,0)
DOC(RET,GUID,XML) ; DSIO IHE GET DOC
"RTN","DSIO3A",96,0)
 N DFN,IENS,FLDS,OUT,ERR,Z,I,LB
"RTN","DSIO3A",97,0)
 S RET=$NA(^TMP($J,"DSIOIHED")) K @RET S @RET@(0)=-1
"RTN","DSIO3A",98,0)
 S DFN=$$FIND1^DIC(19641.6,,"O",GUID,"C") Q:DFN<1
"RTN","DSIO3A",99,0)
 S IENS=$O(^DSIO(19641.6,"C",GUID,DFN,"")) ;Need to get find to work
"RTN","DSIO3A",100,0)
 I $G(XML)=1 D  S:'$D(@RET) @RET@(0)=-1 Q
"RTN","DSIO3A",101,0)
 .K @RET D GETS^DIQ(19641.62,IENS_","_DFN_",",2,"E",RET)
"RTN","DSIO3A",102,0)
 .K @RET@(19641.62,IENS_","_DFN_",",2,"E")
"RTN","DSIO3A",103,0)
 S FLDS="@;.01;.02;.03;.04;.05;1.1;1.2;1.3"
"RTN","DSIO3A",104,0)
 D GETS^DIQ(19641.62,IENS_","_DFN_",",FLDS,,"OUT") Q:'$D(OUT)
"RTN","DSIO3A",105,0)
 S @RET@(0)="PATIENT^"_$$NAME^DSIO2($$GET1^DIQ(2,DFN_",",.01))
"RTN","DSIO3A",106,0)
 S Z=$NA(OUT) F I=1:1 S Z=$Q(@Z) Q:Z=""  D
"RTN","DSIO3A",107,0)
 .K LB D FIELD^DID(19641.62,$QS(Z,3),,"LABEL","LB")
"RTN","DSIO3A",108,0)
 .S @RET@(I)=$G(LB("LABEL"))_U_@Z
"RTN","DSIO3A",109,0)
 .S:$P(@RET@(I),U)="PATIENT" $P(@RET@(I),U,3)=DFN
"RTN","DSIO3A",110,0)
 Q
"RTN","DSIO3V1")
0^5^B34559170
"RTN","DSIO3V1",1,0)
DSIO3V1 ;DSS/TFF - DSIO VPR FOR IHE;06/28/2013 15:19
"RTN","DSIO3V1",2,0)
 ;;1.0;DSS,INC OPEN SOURCE;;28 Jan 2013;Build 25
"RTN","DSIO3V1",3,0)
 ;Copyright 1995-2014,Document Storage Systems Inc. All Rights Reserved
"RTN","DSIO3V1",4,0)
 ;
"RTN","DSIO3V1",5,0)
 ;
"RTN","DSIO3V1",6,0)
VPRD ;SLC/MKB -- Serve VistA data as XML via RPC ;8/2/11  15:29
"RTN","DSIO3V1",7,0)
 ;;1.0;VIRTUAL PATIENT RECORD;**1**;Sep 01, 2011;Build 38
"RTN","DSIO3V1",8,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","DSIO3V1",9,0)
 ;
"RTN","DSIO3V1",10,0)
 ; External References          DBIA#
"RTN","DSIO3V1",11,0)
 ; -------------------          -----
"RTN","DSIO3V1",12,0)
 ; ^DPT                         10035
"RTN","DSIO3V1",13,0)
 ; ^SC                          10040
"RTN","DSIO3V1",14,0)
 ; DIQ                           2056
"RTN","DSIO3V1",15,0)
 ; MPIF001                       2701
"RTN","DSIO3V1",16,0)
 ; VASITE                       10112
"RTN","DSIO3V1",17,0)
 ; XLFDT                        10103
"RTN","DSIO3V1",18,0)
 ; XLFSTR                       10104
"RTN","DSIO3V1",19,0)
 ; XUAF4                         2171
"RTN","DSIO3V1",20,0)
 ;
"RTN","DSIO3V1",21,0)
 ;
"RTN","DSIO3V1",22,0)
 ; RPC: DSIO VPR GET PATIENT DATA 
"RTN","DSIO3V1",23,0)
 ;
"RTN","DSIO3V1",24,0)
GET(VPR,DFN,TYPE,START,STOP,MAX,ID,FILTER) ; -- Return search results as XML in @VPR@(n) 
"RTN","DSIO3V1",25,0)
 ; RPC = VPR GET PATIENT DATA
"RTN","DSIO3V1",26,0)
 N ICN,VPRI,VPRTOTL,VPRTEXT
"RTN","DSIO3V1",27,0)
 S VPR=$NA(^TMP("VPR",$J)) K @VPR
"RTN","DSIO3V1",28,0)
 S VPRTEXT=+$G(FILTER("text")) ;include report/document text?
"RTN","DSIO3V1",29,0)
 ;
"RTN","DSIO3V1",30,0)
 ; parse & validate input parameters
"RTN","DSIO3V1",31,0)
 S ICN=+$P($G(DFN),";",2),DFN=+$G(DFN),ID=$G(ID)
"RTN","DSIO3V1",32,0)
 I DFN<1,ICN S DFN=+$$GETDFN^MPIF001(ICN)
"RTN","DSIO3V1",33,0)
 S TYPE=$$LOW^XLFSTR($G(TYPE)) I TYPE="" S TYPE=$$ALL
"RTN","DSIO3V1",34,0)
 I TYPE'="new",DFN<1!'$D(^DPT(DFN)) D ERR(1,DFN) G GTQ
"RTN","DSIO3V1",35,0)
 S:'$G(START) START=1410102 S:'$G(STOP) STOP=4141015 S:'$G(MAX) MAX=9999
"RTN","DSIO3V1",36,0)
 I START,STOP,STOP<START N X S X=START,START=STOP,STOP=X  ;switch
"RTN","DSIO3V1",37,0)
 I STOP,$L(STOP,".")<2 S STOP=STOP_".24"
"RTN","DSIO3V1",38,0)
 I ID="",$D(FILTER("id")) S ID=FILTER("id")
"RTN","DSIO3V1",39,0)
 ;
"RTN","DSIO3V1",40,0)
 ; extract data
"RTN","DSIO3V1",41,0)
 N VPRTYPE,VPRP,VPRHDR,VPRTAG,VPRTN
"RTN","DSIO3V1",42,0)
 S VPRTYPE=TYPE D ADD("<results version='1.1' timeZone='"_$$TZ^XLFDT_"' >")
"RTN","DSIO3V1",43,0)
 F VPRP=1:1:$L(VPRTYPE,";") S VPRTAG=$P(VPRTYPE,";",VPRP) I $L(VPRTAG) D
"RTN","DSIO3V1",44,0)
 . S VPRTN=$$RTN(.VPRTAG) Q:'$L($T(@VPRTN))
"RTN","DSIO3V1",45,0)
 . D ADD("<"_VPRTAG) S VPRHDR=VPRI,VPRTOTL=0
"RTN","DSIO3V1",46,0)
 . D @(VPRTN_"(DFN,START,STOP,MAX,ID)")
"RTN","DSIO3V1",47,0)
 . S @VPR@(VPRHDR)=@VPR@(VPRHDR)_" total='"_+$G(VPRTOTL)_"' >" D ADD("</"_VPRTAG_">")
"RTN","DSIO3V1",48,0)
 D ADD("</results>")
"RTN","DSIO3V1",49,0)
 ;
"RTN","DSIO3V1",50,0)
GTQ ; end
"RTN","DSIO3V1",51,0)
 Q
"RTN","DSIO3V1",52,0)
 ;
"RTN","DSIO3V1",53,0)
RTN(X) ; -- Return name of VPRDxxxx routine for clinical domain X
"RTN","DSIO3V1",54,0)
 ;  X is also enforced as expected group tag name, if passed by ref
"RTN","DSIO3V1",55,0)
 N Y S Y="VPRD",X=$G(X) I X="" Q Y
"RTN","DSIO3V1",56,0)
 I X["accession"     S Y="EN^VPRDLRA",X="accessions"
"RTN","DSIO3V1",57,0)
 I X["allerg"        S Y="EN^VPRDGMRA",X="reactions"
"RTN","DSIO3V1",58,0)
 I X["appointment"   S Y="EN^VPRDSDAM",X="appointments"
"RTN","DSIO3V1",59,0)
 I X["clinicalproc"  S Y="EN^VPRDMC",X="clinicalProcedures"
"RTN","DSIO3V1",60,0)
 I X["consult"       S Y="EN^VPRDGMRC",X="consults"
"RTN","DSIO3V1",61,0)
 I X["demograph"     S Y="EN^DSIO3V2",X="demographics"
"RTN","DSIO3V1",62,0)
 I X["document"      S Y="EN^VPRDTIU",X="documents"
"RTN","DSIO3V1",63,0)
 I X["factor"        S Y="EN^VPRDPXHF",X="healthFactors"
"RTN","DSIO3V1",64,0)
 I X["flag"          S Y="EN^VPRDGPF",X="flags"
"RTN","DSIO3V1",65,0)
 I X["immunization"  S Y="EN^VPRDPXIM",X="immunizations"
"RTN","DSIO3V1",66,0)
 I X["skin"          S Y="EN^VPRDPXSK",X="skinTests"
"RTN","DSIO3V1",67,0)
 I X?1"exam".E       S Y="EN^VPRDPXAM",X="exams"
"RTN","DSIO3V1",68,0)
 I X["educat"        S Y="EN^VPRDPXED",X="educationTopics"
"RTN","DSIO3V1",69,0)
 I X["insur"         S Y="EN^VPRDIB",X="insurancePolicies"
"RTN","DSIO3V1",70,0)
 I X["polic"         S Y="EN^VPRDIB",X="insurancePolicies"
"RTN","DSIO3V1",71,0)
 I X["lab"           S Y="EN^VPRDLR",X="labs"
"RTN","DSIO3V1",72,0)
 I X["panel"         S Y="EN^VPRDLRO",X="panels"
"RTN","DSIO3V1",73,0)
 I X["med"           S Y="EN^VPRDPS",X="meds"
"RTN","DSIO3V1",74,0)
 I X["pharm"         S Y="EN^VPRDPSOR",X="meds"
"RTN","DSIO3V1",75,0)
 I X["observ"        S Y="EN^VPRDMDC",X="observations"
"RTN","DSIO3V1",76,0)
 I X["order"         S Y="EN^VPRDOR",X="orders"
"RTN","DSIO3V1",77,0)
 I X["patient"       S Y="EN^DSIO3V2",X="demographics"
"RTN","DSIO3V1",78,0)
 I X["problem"       S Y="EN^VPRDGMPL",X="problems"
"RTN","DSIO3V1",79,0)
 I X["procedure"     S Y="EN^VPRDPROC",X="procedures"
"RTN","DSIO3V1",80,0)
 I X["reaction"      S Y="EN^VPRDGMRA",X="reactions"
"RTN","DSIO3V1",81,0)
 I X["surg"          S Y="EN^VPRDSR",X="surgeries"
"RTN","DSIO3V1",82,0)
 I X["visit"         S Y="EN^VPRDVSIT",X="visits"
"RTN","DSIO3V1",83,0)
 I X["vital"         S Y="EN^VPRDGMV",X="vitals"
"RTN","DSIO3V1",84,0)
 I X["rad"           S Y="EN^VPRDRA",X="radiologyExams"
"RTN","DSIO3V1",85,0)
 I X["xray"          S Y="EN^VPRDRA",X="radiologyExams"
"RTN","DSIO3V1",86,0)
 I X["new"           S Y="EN^VPRDX",X="patients"
"RTN","DSIO3V1",87,0)
 I X["author"        S Y="AUT^DSIO3V3",X="author"
"RTN","DSIO3V1",88,0)
 I X["family"        S Y="PAR^DSIO3V3",X="family"
"RTN","DSIO3V1",89,0)
 I X["providers"     S Y="DOC^DSIO3V3",X="providers"
"RTN","DSIO3V1",90,0)
 Q Y
"RTN","DSIO3V1",91,0)
 ;
"RTN","DSIO3V1",92,0)
TAG(X) ; -- return plural name for group tags
"RTN","DSIO3V1",93,0)
 N Y S:X'?1.L X=$$LOW^XLFSTR(X)
"RTN","DSIO3V1",94,0)
 I $E(X,$L(X))="s" S Y=X
"RTN","DSIO3V1",95,0)
 I $E(X,$L(X))="y" S Y=$E(X,1,$L(X)-1)_"ies"
"RTN","DSIO3V1",96,0)
 E  S Y=X_"s"
"RTN","DSIO3V1",97,0)
 Q Y
"RTN","DSIO3V1",98,0)
 ;
"RTN","DSIO3V1",99,0)
ALL() ; -- return string for all types of data
"RTN","DSIO3V1",100,0)
 Q "demographics;reactions;problems;vitals;labs;meds;immunizations;observation;visits;appointments;documents;procedures;consults;flags;factors;skintests;exams;education;insurance;author,family;providers"
"RTN","DSIO3V1",101,0)
 ;
"RTN","DSIO3V1",102,0)
ERR(X,VAL) ; -- return error message
"RTN","DSIO3V1",103,0)
 N MSG  S MSG="Error"
"RTN","DSIO3V1",104,0)
 I X=1  S MSG="Patient with dfn '"_$G(VAL)_"' not found"
"RTN","DSIO3V1",105,0)
 I X=2  S MSG="Requested domain type '"_$G(VAL)_"' not recognized"
"RTN","DSIO3V1",106,0)
 I X=99 S MSG="Unknown request"
"RTN","DSIO3V1",107,0)
 ;
"RTN","DSIO3V1",108,0)
 D ADD("<error>")
"RTN","DSIO3V1",109,0)
 D ADD("<message>"_MSG_"</message>")
"RTN","DSIO3V1",110,0)
 D ADD("</error>")
"RTN","DSIO3V1",111,0)
 Q
"RTN","DSIO3V1",112,0)
 ;
"RTN","DSIO3V1",113,0)
ESC(X) ; -- escape outgoing XML
"RTN","DSIO3V1",114,0)
 ; Q $ZCONVERT(X,"O","HTML")  ; uncomment for fastest performance on Cache
"RTN","DSIO3V1",115,0)
 ;
"RTN","DSIO3V1",116,0)
 N I,Y,QOT S QOT=""""
"RTN","DSIO3V1",117,0)
 S Y=$P(X,"&") F I=2:1:$L(X,"&") S Y=Y_"&amp;"_$P(X,"&",I)
"RTN","DSIO3V1",118,0)
 S X=Y,Y=$P(X,"<") F I=2:1:$L(X,"<") S Y=Y_"&lt;"_$P(X,"<",I)
"RTN","DSIO3V1",119,0)
 S X=Y,Y=$P(X,">") F I=2:1:$L(X,">") S Y=Y_"&gt;"_$P(X,">",I)
"RTN","DSIO3V1",120,0)
 S X=Y,Y=$P(X,"'") F I=2:1:$L(X,"'") S Y=Y_"&apos;"_$P(X,"'",I)
"RTN","DSIO3V1",121,0)
 S X=Y,Y=$P(X,QOT) F I=2:1:$L(X,QOT) S Y=Y_"&quot;"_$P(X,QOT,I)
"RTN","DSIO3V1",122,0)
 Q Y
"RTN","DSIO3V1",123,0)
 ;
"RTN","DSIO3V1",124,0)
ADD(X) ; Add a line @VPR@(n)=X
"RTN","DSIO3V1",125,0)
 S VPRI=$G(VPRI)+1
"RTN","DSIO3V1",126,0)
 S @VPR@(VPRI)=X
"RTN","DSIO3V1",127,0)
 Q
"RTN","DSIO3V1",128,0)
 ;
"RTN","DSIO3V1",129,0)
STRING(ARRAY) ; -- Return text in ARRAY(n) or ARRAY(n,0) as a string
"RTN","DSIO3V1",130,0)
 N I,X,Y S Y=""
"RTN","DSIO3V1",131,0)
 S I=+$O(ARRAY("")) I I=0 S I=+$O(ARRAY(0))
"RTN","DSIO3V1",132,0)
 S Y=$S($D(ARRAY(I,0)):ARRAY(I,0),1:$G(ARRAY(I)))
"RTN","DSIO3V1",133,0)
 F  S I=$O(ARRAY(I)) Q:I<1  D
"RTN","DSIO3V1",134,0)
 . S X=$S($D(ARRAY(I,0)):ARRAY(I,0),1:ARRAY(I))
"RTN","DSIO3V1",135,0)
 . I $E(X)=" " S Y=Y_$C(13,10)_X Q
"RTN","DSIO3V1",136,0)
 . S Y=Y_$S($E(Y,$L(Y))=" ":"",1:" ")_X
"RTN","DSIO3V1",137,0)
 Q Y
"RTN","DSIO3V1",138,0)
 ;
"RTN","DSIO3V1",139,0)
FAC(X) ; -- return Institution file station# for location X
"RTN","DSIO3V1",140,0)
 N HLOC,FAC,Y0,Y S Y=""
"RTN","DSIO3V1",141,0)
 S HLOC=$G(^SC(+$G(X),0)),FAC=$P(HLOC,U,4)
"RTN","DSIO3V1",142,0)
 ; Get P:4 via Med Ctr Div, if not directly linked
"RTN","DSIO3V1",143,0)
 I 'FAC,$P(HLOC,U,15) S FAC=$$GET1^DIQ(44,+$G(X)_",","3.5:.07","I")
"RTN","DSIO3V1",144,0)
 S Y0=$S(FAC:$$NS^XUAF4(FAC),1:$P($$SITE^VASITE,U,2,3)) ;name^stn#
"RTN","DSIO3V1",145,0)
 S:$L(Y0) Y=$P(Y0,U,2)_U_$P(Y0,U) ;switch to stn#^name
"RTN","DSIO3V1",146,0)
 I $L(Y),'Y S $P(Y,U)=FAC
"RTN","DSIO3V1",147,0)
 Q Y
"RTN","DSIO3V1",148,0)
 ;
"RTN","DSIO3V1",149,0)
VUID(IEN,FILE) ; -- Return VUID for item
"RTN","DSIO3V1",150,0)
 Q $$GET1^DIQ(FILE,IEN_",",99.99)
"RTN","DSIO3V1",151,0)
 ;
"RTN","DSIO3V1",152,0)
VERSION(RET) ; -- Return current version of data extracts
"RTN","DSIO3V1",153,0)
 S RET="1.01"
"RTN","DSIO3V1",154,0)
 Q
"RTN","DSIO3V2")
0^6^B108695401
"RTN","DSIO3V2",1,0)
DSIO3V2 ;DSS/TFF - DSIO VPR FOR IHE;06/28/2013 15:19
"RTN","DSIO3V2",2,0)
 ;;1.0;DSS,INC OPEN SOURCE;;28 Jan 2013;Build 25
"RTN","DSIO3V2",3,0)
 ;Copyright 1995-2014,Document Storage Systems Inc. All Rights Reserved
"RTN","DSIO3V2",4,0)
 ;
"RTN","DSIO3V2",5,0)
 ;
"RTN","DSIO3V2",6,0)
VPRDPT ;SLC/MKB -- Patient demographics extract ;8/11/11  15:29
"RTN","DSIO3V2",7,0)
 ;;1.0;VIRTUAL PATIENT RECORD;**1**;Sep 01, 2011;Build 38
"RTN","DSIO3V2",8,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","DSIO3V2",9,0)
 ;
"RTN","DSIO3V2",10,0)
 ; External References          DBIA#
"RTN","DSIO3V2",11,0)
 ; -------------------          -----
"RTN","DSIO3V2",12,0)
 ; ^AUPNVSIT                     2028
"RTN","DSIO3V2",13,0)
 ; ^DGSL(38.1                     767
"RTN","DSIO3V2",14,0)
 ; ^DIC(4                       10090
"RTN","DSIO3V2",15,0)
 ; ^DIC(31                        733
"RTN","DSIO3V2",16,0)
 ; ^DIC(42                  723,10039
"RTN","DSIO3V2",17,0)
 ; ^DPT               3581,5597,10035
"RTN","DSIO3V2",18,0)
 ; DGCV                          4156
"RTN","DSIO3V2",19,0)
 ; DGMSTAPI                      2716
"RTN","DSIO3V2",20,0)
 ; DGNTAPI                       3457
"RTN","DSIO3V2",21,0)
 ; DGPFAPI                       3860
"RTN","DSIO3V2",22,0)
 ; DGRPDB                        4807
"RTN","DSIO3V2",23,0)
 ; DILFD                         2055
"RTN","DSIO3V2",24,0)
 ; DIQ                           2056
"RTN","DSIO3V2",25,0)
 ; MPIF001                       2701
"RTN","DSIO3V2",26,0)
 ; SDUTL3                        1252
"RTN","DSIO3V2",27,0)
 ; VADPT                        10061
"RTN","DSIO3V2",28,0)
 ; VAFCTFU1                      2990
"RTN","DSIO3V2",29,0)
 ; VASITE                       10112
"RTN","DSIO3V2",30,0)
 ; XUAF4                         2171
"RTN","DSIO3V2",31,0)
 ;
"RTN","DSIO3V2",32,0)
 ; ------------ Get data from VistA ------------
"RTN","DSIO3V2",33,0)
 ;
"RTN","DSIO3V2",34,0)
EN(DFN,BEG,END,MAX,ID) ; -- find current patient demographics
"RTN","DSIO3V2",35,0)
 ; [BEG,END,MAX,ID not currently used]
"RTN","DSIO3V2",36,0)
 S DFN=+$G(DFN) Q:DFN<1  ;invalid patient
"RTN","DSIO3V2",37,0)
 N PAT,SYS S SYS=$$SITE^VASITE
"RTN","DSIO3V2",38,0)
 D DEM,SVC,PRF,ATC,SUPP,ALIAS,FAC,GAR,BIR
"RTN","DSIO3V2",39,0)
 I $D(PAT)>9 D XML(.PAT)
"RTN","DSIO3V2",40,0)
 Q
"RTN","DSIO3V2",41,0)
 ;
"RTN","DSIO3V2",42,0)
DEM ;-demographic data
"RTN","DSIO3V2",43,0)
 N VADM,VA,VAERR,X
"RTN","DSIO3V2",44,0)
 S X=+$$GETICN^MPIF001(DFN) S:X>1 PAT("icn")=X
"RTN","DSIO3V2",45,0)
 D DEM^VADPT S X=VADM(1),PAT("fullName")=X
"RTN","DSIO3V2",46,0)
 S PAT("familyName")=$P(X,","),PAT("givenNames")=$P(X,",",2,99)
"RTN","DSIO3V2",47,0)
 S PAT("ssn")=$P(VADM(2),U),PAT("id")=DFN
"RTN","DSIO3V2",48,0)
 S:$D(VA("BID")) PAT("bid")=$E(X)_VA("BID")
"RTN","DSIO3V2",49,0)
 S PAT("dob")=+$P($P(VADM(3),U),".")
"RTN","DSIO3V2",50,0)
 S PAT("gender")=$P(VADM(5),U)
"RTN","DSIO3V2",51,0)
 S PAT("lrdfn")=+$G(^DPT(DFN,"LR"))
"RTN","DSIO3V2",52,0)
 S X=+$P($P(VADM(6),U),".") S:X PAT("died")=X
"RTN","DSIO3V2",53,0)
 S X=$$GET1^DIQ(38.1,DFN_",",2,"I") S:$L(X) PAT("sensitive")=X
"RTN","DSIO3V2",54,0)
 S X=+VADM(9) S:X PAT("religion")=X
"RTN","DSIO3V2",55,0)
 S X=$P(VADM(10),U,2) S:$L(X) PAT("maritalStatus")=$E(X)
"RTN","DSIO3V2",56,0)
 I VADM(11) D
"RTN","DSIO3V2",57,0)
 . N I S I=0
"RTN","DSIO3V2",58,0)
 . F  S I=$O(VADM(11,I)) Q:I<1  S X=+VADM(11,I),PAT("ethnicity",X)=$$GET1^DIQ(2.06,X_","_DFN_",",".01:3")
"RTN","DSIO3V2",59,0)
 I VADM(12) D
"RTN","DSIO3V2",60,0)
 . N I S I=0
"RTN","DSIO3V2",61,0)
 . F  S I=$O(VADM(12,I)) Q:I<1  S X=+VADM(12,I),PAT("race",X)=$$GET1^DIQ(2.02,X_","_DFN_",",".01:3")
"RTN","DSIO3V2",62,0)
 Q
"RTN","DSIO3V2",63,0)
SVC ;-service data
"RTN","DSIO3V2",64,0)
 N VAEL,VASV,VAERR,X,Y,I,AO,IR,PGF,HNC,MST,CV
"RTN","DSIO3V2",65,0)
 D 7^VADPT
"RTN","DSIO3V2",66,0)
 S PAT("veteran")=VAEL(4)
"RTN","DSIO3V2",67,0)
 S PAT("sc")=+VAEL(3) S:VAEL(3) PAT("scPercent")=+$P(VAEL(3),U,2)
"RTN","DSIO3V2",68,0)
 ;
"RTN","DSIO3V2",69,0)
 ; exposures
"RTN","DSIO3V2",70,0)
 S AO=VASV(2),IR=VASV(3)
"RTN","DSIO3V2",71,0)
 S PGF=VASV(11)!VASV(12)!VASV(13) ;OIF/OEF
"RTN","DSIO3V2",72,0)
 S X=$$GETCUR^DGNTAPI(DFN,"HNC"),X=+($G(HNC("STAT")))
"RTN","DSIO3V2",73,0)
 S HNC=$S(X=4:1,X=5:1,X=1:0,X=6:0,1:"")
"RTN","DSIO3V2",74,0)
 S X=$P($$GETSTAT^DGMSTAPI(DFN),U,2),MST=$S(X="Y":1,X="N":0,1:"")
"RTN","DSIO3V2",75,0)
 S X=$$CVEDT^DGCV(DFN),CV=$S(+X<0:"",+X=0:0,$P(X,U,3):1,1:0)
"RTN","DSIO3V2",76,0)
 S PAT("exposures")=AO_U_IR_U_PGF_U_HNC_U_MST_U_CV
"RTN","DSIO3V2",77,0)
 ;
"RTN","DSIO3V2",78,0)
 ; rated disabilities [DGRPDB]
"RTN","DSIO3V2",79,0)
 N VPRDIS,DIS,NM,DX
"RTN","DSIO3V2",80,0)
 D RDIS^DGRPDB(DFN,.VPRDIS)
"RTN","DSIO3V2",81,0)
 S I=0 F  S I=$O(VPRDIS(I)) Q:I<1  D
"RTN","DSIO3V2",82,0)
 . S DIS=VPRDIS(I)
"RTN","DSIO3V2",83,0)
 . S NM=$$GET1^DIQ(31,+DIS_",",.01),DX=$$GET1^DIQ(31,+DIS_",",2)
"RTN","DSIO3V2",84,0)
 . S PAT("disability",+DX)=NM_U_$P(DIS,U,2,3) ;name^%^sc
"RTN","DSIO3V2",85,0)
 Q
"RTN","DSIO3V2",86,0)
PRF ;-patient record flags
"RTN","DSIO3V2",87,0)
 N VPRPF,I,NAME,TEXT
"RTN","DSIO3V2",88,0)
 Q:'$$GETACT^DGPFAPI(DFN,"VPRPF")
"RTN","DSIO3V2",89,0)
 S I=0 F  S I=$O(VPRPF(I)) Q:I<1  D
"RTN","DSIO3V2",90,0)
 . S NAME=$P(VPRPF(I,"FLAG"),U,2)
"RTN","DSIO3V2",91,0)
 . M TEXT=VPRPF(I,"NARR")
"RTN","DSIO3V2",92,0)
 . S PAT("flag",I)=NAME_U_$$STRING^DSIO3V1(.TEXT)
"RTN","DSIO3V2",93,0)
 Q
"RTN","DSIO3V2",94,0)
ATC ;-address & telecom
"RTN","DSIO3V2",95,0)
 N VAPA,I,X
"RTN","DSIO3V2",96,0)
 S VAPA("P")="" D ADD^VADPT ;permanent address
"RTN","DSIO3V2",97,0)
 S X="" F I=1:1:4 S X=X_VAPA(I)_U
"RTN","DSIO3V2",98,0)
 S X=X_$P(VAPA(5),U,2)_U_$P(VAPA(11),U,2)
"RTN","DSIO3V2",99,0)
 S PAT("address")=X ;street1^st2^st3^city^state^zip
"RTN","DSIO3V2",100,0)
 S X=$$FORMAT(VAPA(8))_U_$$FORMAT($$GET1^DIQ(2,DFN_",",.134))_U_$$FORMAT($$GET1^DIQ(2,DFN_",",.132))
"RTN","DSIO3V2",101,0)
 S PAT("telecom")=X ;home^cell^work phones
"RTN","DSIO3V2",102,0)
 Q
"RTN","DSIO3V2",103,0)
GAR ;-guardian
"RTN","DSIO3V2",104,0)
 S PAT("guardian")=$$GET1^DIQ(2,DFN_",",.2912)_U_$$GET1^DIQ(2,DFN_",",.2922) ;va^civil
"RTN","DSIO3V2",105,0)
 Q
"RTN","DSIO3V2",106,0)
BIR ;-birthplace
"RTN","DSIO3V2",107,0)
 S PAT("birthplace")=$$GET1^DIQ(2,DFN_",",.092)_U_$$GET1^DIQ(2,DFN_",",.093) ;city^state
"RTN","DSIO3V2",108,0)
 Q
"RTN","DSIO3V2",109,0)
SUPP ;-support contacts
"RTN","DSIO3V2",110,0)
 N VAOA,A,I,X,TYPE
"RTN","DSIO3V2",111,0)
 F A="",1 K VAOA D
"RTN","DSIO3V2",112,0)
 . S:A VAOA("A")=A D OAD^VADPT Q:'$L($G(VAOA(9)))
"RTN","DSIO3V2",113,0)
 . S TYPE=$S(A=1:"ECON",1:"NOK")
"RTN","DSIO3V2",114,0)
 . S PAT("support",TYPE)=VAOA(9)_U_VAOA(10) ;name^relationship
"RTN","DSIO3V2",115,0)
 . S X="" F I=1:1:4 S X=X_VAOA(I)_U
"RTN","DSIO3V2",116,0)
 . S X=X_$P(VAOA(5),U,2)_U_$P(VAOA(11),U,2)
"RTN","DSIO3V2",117,0)
 . S PAT("support",TYPE,"address")=X ;street1^st2^st3^city^state^zip
"RTN","DSIO3V2",118,0)
 . S I=$S(A=1:.33011,1:.21011),X=$$FORMAT(VAOA(8))_U_U_$$FORMAT($$GET1^DIQ(2,DFN_",",I))
"RTN","DSIO3V2",119,0)
 . S PAT("support",TYPE,"telecom")=X ;home^cell^work phones
"RTN","DSIO3V2",120,0)
 Q
"RTN","DSIO3V2",121,0)
ALIAS ;-other names used
"RTN","DSIO3V2",122,0)
 N I,X
"RTN","DSIO3V2",123,0)
 S I=0 F  S I=$O(^DPT(DFN,.01,I)) Q:I<1  S X=$G(^(I,0)) D
"RTN","DSIO3V2",124,0)
 . S PAT("alias",I)=$P(X,U)
"RTN","DSIO3V2",125,0)
 Q
"RTN","DSIO3V2",126,0)
FORMAT(X) ; -- enforce (xxx)xxx-xxxx phone format
"RTN","DSIO3V2",127,0)
 S X=$G(X) I X?1"("3N1")"3N1"-"4N.E Q X
"RTN","DSIO3V2",128,0)
 N P,N,I,Y S P=""
"RTN","DSIO3V2",129,0)
 F I=1:1:$L(X) S N=$E(X,I) I N=+N S P=P_N
"RTN","DSIO3V2",130,0)
 S:$L(P)<10 P=$E("0000000000",1,10-$L(P))_P
"RTN","DSIO3V2",131,0)
 S Y=$S(P:"("_$E(P,1,3)_")"_$E(P,4,6)_"-"_$E(P,7,10),1:"")
"RTN","DSIO3V2",132,0)
 Q Y
"RTN","DSIO3V2",133,0)
FAC ;-treating facilities [see FACLIST^ORWCIRN]
"RTN","DSIO3V2",134,0)
 N IFN S DFN=+$G(DFN) Q:DFN<1
"RTN","DSIO3V2",135,0)
 N VPRY,HOME,LAST,I,X,IEN
"RTN","DSIO3V2",136,0)
 I $L($T(TFL^VAFCTFU1)) D TFL^VAFCTFU1(.VPRY,DFN)
"RTN","DSIO3V2",137,0)
 S HOME=+$P($G(^DPT(DFN,"MPI")),U,3) ;home facility
"RTN","DSIO3V2",138,0)
 I $P($G(VPRY(1)),U)<0 D  Q  ;not setup
"RTN","DSIO3V2",139,0)
 . S X=$O(^AUPNVSIT("AA",DFN,0)),LAST=$S(X:9999999-$P(X,"."),1:"")
"RTN","DSIO3V2",140,0)
 . S X=$$SITE^VASITE
"RTN","DSIO3V2",141,0)
 . S PAT("facility",+X)=$P(X,U,3)_U_$P(X,U,2)_U_LAST_U_$$GET1^DIQ(4,+X_",",60)
"RTN","DSIO3V2",142,0)
 . ;street1^st2^city^state^zip
"RTN","DSIO3V2",143,0)
 . S $P(PAT("facility",+X),U,5)=$$GET1^DIQ(4,+X_",",1.01)
"RTN","DSIO3V2",144,0)
 . S $P(PAT("facility",+X),U,6)=$$GET1^DIQ(4,+X_",",1.02)
"RTN","DSIO3V2",145,0)
 . S $P(PAT("facility",+X),U,7)=$$GET1^DIQ(4,+X_",",1.03)
"RTN","DSIO3V2",146,0)
 . S $P(PAT("facility",+X),U,8)=$$GET1^DIQ(4,+X_",",.02)
"RTN","DSIO3V2",147,0)
 . S $P(PAT("facility",+X),U,9)=$$GET1^DIQ(4,+X_",",1.04)
"RTN","DSIO3V2",148,0)
 S I=0 F  S I=$O(VPRY(I)) Q:I<1  D
"RTN","DSIO3V2",149,0)
 . S X=VPRY(I) Q:$P(X,U)=""  ;unknown
"RTN","DSIO3V2",150,0)
 . S IEN=+$$IEN^XUAF4($P(X,U))
"RTN","DSIO3V2",151,0)
 . I +X=776!(+X=200) S $P(X,U,2)="DEPT. OF DEFENSE"
"RTN","DSIO3V2",152,0)
 . S PAT("facility",IEN)=$P(X,U,1,3) ;stn# ^ name ^ last date ^ VistA domain
"RTN","DSIO3V2",153,0)
 . S $P(PAT("facility",IEN),U,4)=$$GET1^DIQ(4,IEN_",",60)
"RTN","DSIO3V2",154,0)
 . ;street1^st2^city^state^zip
"RTN","DSIO3V2",155,0)
 . S $P(PAT("facility",IEN),U,5)=$$GET1^DIQ(4,IEN_",",1.01)
"RTN","DSIO3V2",156,0)
 . S $P(PAT("facility",IEN),U,6)=$$GET1^DIQ(4,IEN_",",1.02)
"RTN","DSIO3V2",157,0)
 . S $P(PAT("facility",IEN),U,7)=$$GET1^DIQ(4,IEN_",",1.03)
"RTN","DSIO3V2",158,0)
 . S $P(PAT("facility",IEN),U,8)=$$GET1^DIQ(4,IEN_",",.02)
"RTN","DSIO3V2",159,0)
 . S $P(PAT("facility",IEN),U,9)=$$GET1^DIQ(4,IEN_",",1.04)
"RTN","DSIO3V2",160,0)
 . I IEN=HOME S $P(PAT("facility",IEN),U,10)=1
"RTN","DSIO3V2",161,0)
 Q
"RTN","DSIO3V2",162,0)
 ;
"RTN","DSIO3V2",163,0)
INPT ;-current inpt status data
"RTN","DSIO3V2",164,0)
 N ADM,X
"RTN","DSIO3V2",165,0)
 S ADM=+$G(^DPT(DFN,.105)) I ADM D
"RTN","DSIO3V2",166,0)
 . N VAIN,VAERR,HLOC,SVC
"RTN","DSIO3V2",167,0)
 . D INP^VADPT S PAT("admitted")=ADM_U_+VAIN(7)
"RTN","DSIO3V2",168,0)
 . S PAT("ward")=VAIN(4),PAT("roomBed")=VAIN(5)
"RTN","DSIO3V2",169,0)
 . S HLOC=+$G(^DIC(42,+VAIN(4),44)),SVC=$P($G(^(0)),U,3)
"RTN","DSIO3V2",170,0)
 . S PAT("location")=HLOC_U_$P(VAIN(4),U,2)
"RTN","DSIO3V2",171,0)
 . S:$L(SVC) PAT("locSvc")=SVC_U_$$EXTERNAL^DILFD(42,.03,,SVC)
"RTN","DSIO3V2",172,0)
 . S PAT("specialty")=VAIN(3)
"RTN","DSIO3V2",173,0)
 . S PAT("attending")=VAIN(11)
"RTN","DSIO3V2",174,0)
 . S X=$$FAC^DSIO3V1(HLOC),PAT("site")=X
"RTN","DSIO3V2",175,0)
 S PAT("inpatient")=$S(ADM:"true",1:"false")
"RTN","DSIO3V2",176,0)
 S X=$$OUTPTPR^SDUTL3(DFN) S:X PAT("pcProvider")=X
"RTN","DSIO3V2",177,0)
 S X=$$OUTPTTM^SDUTL3(DFN) S:X PAT("pcTeam")=X
"RTN","DSIO3V2",178,0)
 Q
"RTN","DSIO3V2",179,0)
 ;
"RTN","DSIO3V2",180,0)
 ; ------------ Return data to middle tier ------------
"RTN","DSIO3V2",181,0)
 ;
"RTN","DSIO3V2",182,0)
XML(ITEM) ; -- Return patient data as XML in @VPR@(n)
"RTN","DSIO3V2",183,0)
 ; as <element code='123' displayName='ABC' />
"RTN","DSIO3V2",184,0)
 N ATT,X,Y,I,ID
"RTN","DSIO3V2",185,0)
 D ADD("<patient>") S VPRTOTL=$G(VPRTOTL)+1
"RTN","DSIO3V2",186,0)
 S ATT="" F  S ATT=$O(ITEM(ATT)) Q:ATT=""  D  D:$L(Y) ADD(Y)
"RTN","DSIO3V2",187,0)
 . I ATT="exposures" D:X["1"  S Y="" Q
"RTN","DSIO3V2",188,0)
 .. S I=0,Y="<exposures>" D ADD(Y)
"RTN","DSIO3V2",189,0)
 .. F ID="AO","IR","PG","HNC","MST","CV" S I=I+1 I $P(X,U,I) S Y="<exposure value='"_ID_"' />" D ADD(Y)
"RTN","DSIO3V2",190,0)
 .. D ADD("</exposures>")
"RTN","DSIO3V2",191,0)
 . I $L($O(ITEM(ATT,""))) D  Q  ;multiples
"RTN","DSIO3V2",192,0)
 .. S ID=$S($E(ATT,$L(ATT))="s":ATT_"es",$E(ATT,$L(ATT))="y":$E(ATT,1,$L(ATT)-1)_"ies",1:ATT_"s")
"RTN","DSIO3V2",193,0)
 .. D ADD("<"_ID_">")
"RTN","DSIO3V2",194,0)
 .. S I="" F  S I=$O(ITEM(ATT,I)) Q:I=""  D  D:$L(Y) ADD(Y)
"RTN","DSIO3V2",195,0)
 ... S X=ITEM(ATT,I),Y="<"_ATT_" "
"RTN","DSIO3V2",196,0)
 ... I ATT="support" D  S Y="" Q
"RTN","DSIO3V2",197,0)
 .... S Y=Y_"contactType='"_I_"' name='"_$$ESC^VPRD($P(X,U))_$S($L($P(X,U,2)):"' relationship='"_$$ESC^VPRD($P(X,U,2)),1:"")_"' >" D ADD(Y)
"RTN","DSIO3V2",198,0)
 .... S X=$G(ITEM(ATT,I,"address")) I $L(X) D ADDR(X)
"RTN","DSIO3V2",199,0)
 .... S X=$G(ITEM(ATT,I,"telecom")) I $L(X) D PHONE(X)
"RTN","DSIO3V2",200,0)
 .... D ADD("</support>")
"RTN","DSIO3V2",201,0)
 ... I ATT="alias" S Y=Y_"fullName='"_$$ESC^VPRD(X)_$S(X[",":"' familyName='"_$$ESC^VPRD($P(X,","))_"' givenNames='"_$$ESC^VPRD($P(X,",",2,99)),1:"")_"' />" Q
"RTN","DSIO3V2",202,0)
 ... I ATT="flag" S Y=Y_"name='"_$$ESC^VPRD($P(X,U))_"' text='"_$$ESC^VPRD($P(X,U,2))_"' />" Q
"RTN","DSIO3V2",203,0)
 ... I ATT="facility" D ADDFAC(X) S Y="" Q
"RTN","DSIO3V2",204,0)
 ... I ATT="disability" S Y=Y_"vaCode='"_I_"' printName='"_$$ESC^VPRD($P(X,U))_$S($P(X,U,3):"' sc='"_$P(X,U,3)_"' scPercent='"_$P(X,U,2),1:"")_"' />" Q
"RTN","DSIO3V2",205,0)
 ... S Y=Y_"value='"_$$ESC^VPRD(ITEM(ATT,I))_"' />"
"RTN","DSIO3V2",206,0)
 .. D ADD("</"_ID_">") S Y=""
"RTN","DSIO3V2",207,0)
 . S X=$G(ITEM(ATT)),Y="" Q:'$L(X)
"RTN","DSIO3V2",208,0)
 . I ATT="address" D ADDR(X) S Y="" Q
"RTN","DSIO3V2",209,0)
 . I ATT="telecom" D PHONE(X) S Y="" Q
"RTN","DSIO3V2",210,0)
 . I ATT="guardian" D ADDG(X) S Y="" Q
"RTN","DSIO3V2",211,0)
 . I ATT="birthplace" D ADDB(X) S Y="" Q
"RTN","DSIO3V2",212,0)
 . I X'["^" S Y="<"_ATT_" value='"_$$ESC^VPRD(X)_"' />" Q
"RTN","DSIO3V2",213,0)
 . S Y="<"_ATT_" code='"_$P(X,U)_"' name='"_$$ESC^VPRD($P(X,U,2))_"' />"
"RTN","DSIO3V2",214,0)
 D ADD("</patient>")
"RTN","DSIO3V2",215,0)
 Q
"RTN","DSIO3V2",216,0)
 ;
"RTN","DSIO3V2",217,0)
ADDFAC(X) ;
"RTN","DSIO3V2",218,0)
 N IEN,I S IEN=+$P(X,U)
"RTN","DSIO3V2",219,0)
 S Y=Y_"code='"_$P(X,U)_"' name='"_$$ESC^DSIO3V1($P(X,U,2))_"'"
"RTN","DSIO3V2",220,0)
 S Y=Y_$S($P(X,U,3):" latestDate='"_$P($P(X,U,3),".")_"'",1:"")
"RTN","DSIO3V2",221,0)
 S Y=Y_$S($L($P(X,U,4))>0:" domain='"_$P(X,U,4)_"'",1:"")
"RTN","DSIO3V2",222,0)
 S Y=Y_$S($P(X,U,10):" homeSite='1'",1:"")_" >"
"RTN","DSIO3V2",223,0)
 D ADD(Y)
"RTN","DSIO3V2",224,0)
 S Y="<address "
"RTN","DSIO3V2",225,0)
 S Y=Y_$S($L($P(X,U,5))>0:" streetLine1='"_$P(X,U,5)_"'",1:"")
"RTN","DSIO3V2",226,0)
 S Y=Y_$S($L($P(X,U,6))>0:" streetLine2='"_$P(X,U,6)_"'",1:"")
"RTN","DSIO3V2",227,0)
 S Y=Y_$S($L($P(X,U,7))>0:" city='"_$P(X,U,7)_"'",1:"")
"RTN","DSIO3V2",228,0)
 S Y=Y_$S($L($P(X,U,8))>0:" stateProvince='"_$P(X,U,8)_"'",1:"")
"RTN","DSIO3V2",229,0)
 S Y=Y_$S($L($P(X,U,9))>0:" postalCode='"_$P(X,U,9)_"'",1:"")
"RTN","DSIO3V2",230,0)
 S Y=Y_" />" D ADD(Y)
"RTN","DSIO3V2",231,0)
 ;D ADD("<contactList>")
"RTN","DSIO3V2",232,0)
 ;contact^area^phone
"RTN","DSIO3V2",233,0)
 ;I +$P(^DIC(4,IEN,2,0),U,4)>0 D
"RTN","DSIO3V2",234,0)
 ;.F I=1:1:+$P(^DIC(4,IEN,2,0),U,4) S X=$G(^DIC(4,IEN,2,I,0)) D
"RTN","DSIO3V2",235,0)
 ;..I $L(X)>0 S Y="<contact " D
"RTN","DSIO3V2",236,0)
 ;...S Y=Y_$S($L($P(X,U))>0:" name='"_$P(X,U)_"'",1:"")
"RTN","DSIO3V2",237,0)
 ;...S Y=Y_$S($L($P(X,U,2))>0:" area='"_$P(^SC($P(X,U,2),0),U)_"'",1:"")
"RTN","DSIO3V2",238,0)
 ;...S Y=Y_$S($L($P(X,U,3))>0:" phone='"_$P(X,U,3)_"'",1:"")
"RTN","DSIO3V2",239,0)
 ;...S Y=Y_" />" D ADD(Y)
"RTN","DSIO3V2",240,0)
 ;D ADD("</contactList")
"RTN","DSIO3V2",241,0)
 D ADD("</facility>")
"RTN","DSIO3V2",242,0)
 Q
"RTN","DSIO3V2",243,0)
 ;
"RTN","DSIO3V2",244,0)
ADDR(X) ; -- XML address node from X=street1^st2^st3^city^state^zip
"RTN","DSIO3V2",245,0)
 N I,Y Q:$L(X)'>5  ;no data
"RTN","DSIO3V2",246,0)
 S Y="<address"
"RTN","DSIO3V2",247,0)
 F I=1,2,3 I $L($P(X,U,I)) S Y=Y_" streetLine"_I_"='"_$$ESC^DSIO3V1($P(X,U,I))_"'"
"RTN","DSIO3V2",248,0)
 I $L($P(X,U,4)) S Y=Y_" city='"_$$ESC^DSIO3V1($P(X,U,4))_"'"
"RTN","DSIO3V2",249,0)
 I $L($P(X,U,5)) S Y=Y_" stateProvince='"_$P(X,U,5)_"'"
"RTN","DSIO3V2",250,0)
 I $L($P(X,U,6)) S Y=Y_" postalCode='"_$P(X,U,6)_"'"
"RTN","DSIO3V2",251,0)
 S Y=Y_" />" D ADD(Y)
"RTN","DSIO3V2",252,0)
 Q
"RTN","DSIO3V2",253,0)
 ;
"RTN","DSIO3V2",254,0)
ADDRE(X) ; -- XML religion
"RTN","DSIO3V2",255,0)
 N Y
"RTN","DSIO3V2",256,0)
 S Y="<religion"
"RTN","DSIO3V2",257,0)
 I $L($P(X,U)) S Y=Y_" code='"_$$ESC^DSIO3V1($P(X,U))_"'"
"RTN","DSIO3V2",258,0)
 I $L($P(X,U,2)) S Y=Y_" description='"_$P(X,U,2)_"'"
"RTN","DSIO3V2",259,0)
 S Y=Y_" />" D ADD(Y)
"RTN","DSIO3V2",260,0)
 Q
"RTN","DSIO3V2",261,0)
 ;
"RTN","DSIO3V2",262,0)
ADDMS(X) ; -- XML marital status
"RTN","DSIO3V2",263,0)
 N Y
"RTN","DSIO3V2",264,0)
 S Y="<marital_status"
"RTN","DSIO3V2",265,0)
 I $L($P(X,U)) S Y=Y_" code='"_$$ESC^DSIO3V1($P(X,U))_"'"
"RTN","DSIO3V2",266,0)
 I $L($P(X,U,2)) S Y=Y_" description='"_$P(X,U,2)_"'"
"RTN","DSIO3V2",267,0)
 S Y=Y_" />" D ADD(Y)
"RTN","DSIO3V2",268,0)
 Q
"RTN","DSIO3V2",269,0)
 ;
"RTN","DSIO3V2",270,0)
ADDG(X) ; -- XML guardian node from X=va^civil
"RTN","DSIO3V2",271,0)
 N I,Y Q:$L(X)'>5  ;no data
"RTN","DSIO3V2",272,0)
 S Y="<guardian"
"RTN","DSIO3V2",273,0)
 I $L($P(X,U)) S Y=Y_" va='"_$$ESC^DSIO3V1($P(X,U))_"'"
"RTN","DSIO3V2",274,0)
 I $L($P(X,U,2)) S Y=Y_" civil='"_$P(X,U,2)_"'"
"RTN","DSIO3V2",275,0)
 S Y=Y_" />" D ADD(Y)
"RTN","DSIO3V2",276,0)
 Q
"RTN","DSIO3V2",277,0)
 ;
"RTN","DSIO3V2",278,0)
ADDB(X) ; -- XML birthplace node from X=city^state
"RTN","DSIO3V2",279,0)
 N I,Y Q:$L(X)'>5  ;no data
"RTN","DSIO3V2",280,0)
 S Y="<birthplace"
"RTN","DSIO3V2",281,0)
 I $L($P(X,U)) S Y=Y_" city='"_$$ESC^DSIO3V1($P(X,U))_"'"
"RTN","DSIO3V2",282,0)
 I $L($P(X,U,2)) S Y=Y_" state='"_$P(X,U,2)_"'"
"RTN","DSIO3V2",283,0)
 S Y=Y_" />" D ADD(Y)
"RTN","DSIO3V2",284,0)
 Q
"RTN","DSIO3V2",285,0)
 ;
"RTN","DSIO3V2",286,0)
PHONE(X) ; -- XML telecom node from X=home^cell^work numbers
"RTN","DSIO3V2",287,0)
 N I,Y Q:$L(X)'>2  ;no data
"RTN","DSIO3V2",288,0)
 D ADD("<telecomList>")
"RTN","DSIO3V2",289,0)
 I $L($P(X,U,1)) S Y="<telecom usageType='H' value='"_$P(X,U,1)_"' />" D ADD(Y)
"RTN","DSIO3V2",290,0)
 I $L($P(X,U,2)) S Y="<telecom usageType='MC' value='"_$P(X,U,2)_"' />" D ADD(Y)
"RTN","DSIO3V2",291,0)
 I $L($P(X,U,3)) S Y="<telecom usageType='WP' value='"_$P(X,U,3)_"' />" D ADD(Y)
"RTN","DSIO3V2",292,0)
 D ADD("</telecomList>")
"RTN","DSIO3V2",293,0)
 Q
"RTN","DSIO3V2",294,0)
 ;
"RTN","DSIO3V2",295,0)
ADD(X) ; Add a line @VPR@(n)=X
"RTN","DSIO3V2",296,0)
 S VPRI=$G(VPRI)+1
"RTN","DSIO3V2",297,0)
 S @VPR@(VPRI)=X
"RTN","DSIO3V2",298,0)
 Q
"RTN","DSIO3V3")
0^7^B38841252
"RTN","DSIO3V3",1,0)
DSIO3V3 ;DSS/TFF - DSIO VPR FOR IHE;06/28/2013 15:19
"RTN","DSIO3V3",2,0)
 ;;1.0;DSS,INC OPEN SOURCE;;28 Jan 2013;Build 25
"RTN","DSIO3V3",3,0)
 ;Copyright 1995-2014,Document Storage Systems Inc. All Rights Reserved
"RTN","DSIO3V3",4,0)
 ;
"RTN","DSIO3V3",5,0)
 ;
"RTN","DSIO3V3",6,0)
 ;
"RTN","DSIO3V3",7,0)
 ;=============================================================================
"RTN","DSIO3V3",8,0)
 ;                                    AUTHOR
"RTN","DSIO3V3",9,0)
 ;=============================================================================
"RTN","DSIO3V3",10,0)
 ;
"RTN","DSIO3V3",11,0)
AUT(DFN,BEG,END,MAX,ID) ; -- find current user information (Author)
"RTN","DSIO3V3",12,0)
 ; [BEG,END,MAX,ID not currently used]
"RTN","DSIO3V3",13,0)
 ;
"RTN","DSIO3V3",14,0)
 ; IF PRIMARY PROVIDER OF THE PATIENT USE THE FOLLOWING
"RTN","DSIO3V3",15,0)
 ;S DFN=+$G(DFN) Q:DFN<1  ;invalid patient
"RTN","DSIO3V3",16,0)
 ;S IEN=$$GET1^DIQ(2,+DFN_",",.104,"I") Q:+IEN<1
"RTN","DSIO3V3",17,0)
 ;
"RTN","DSIO3V3",18,0)
 N PAT
"RTN","DSIO3V3",19,0)
 S PAT("name")=$$GET1^DIQ(200,DUZ_",",.01)
"RTN","DSIO3V3",20,0)
 S PAT("type")=$$GET1^DIQ(200,DUZ_",",53.6)
"RTN","DSIO3V3",21,0)
 S PAT("class")=$$GET1^DIQ(200,DUZ_",",53.5)
"RTN","DSIO3V3",22,0)
 ; npi^npi entry status
"RTN","DSIO3V3",23,0)
 S PAT("npi")=$$GET1^DIQ(200,DUZ_",",41.99)_U_$$GET1^DIQ(200,DUZ_",",41.98)
"RTN","DSIO3V3",24,0)
 D ATC(DUZ),FAC^DSIO3V2,XMLD(.PAT)
"RTN","DSIO3V3",25,0)
 Q
"RTN","DSIO3V3",26,0)
 ;
"RTN","DSIO3V3",27,0)
XMLD(ITEM) ; -- Return current user information as XML in @VPR@(n)
"RTN","DSIO3V3",28,0)
 ; as <element code='123' displayName='ABC' />
"RTN","DSIO3V3",29,0)
 N ATT,X,Y,I,ID
"RTN","DSIO3V3",30,0)
 D ADD("<current_user>") S VPRTOTL=$G(VPRTOTL)+1
"RTN","DSIO3V3",31,0)
 S ATT="" F  S ATT=$O(ITEM(ATT)) Q:ATT=""  D  D:$L(Y) ADD(Y)
"RTN","DSIO3V3",32,0)
 . I $L($O(ITEM(ATT,""))) D  Q  ;multiples
"RTN","DSIO3V3",33,0)
 .. S ID=$S($E(ATT,$L(ATT))="s":ATT_"es",$E(ATT,$L(ATT))="y":$E(ATT,1,$L(ATT)-1)_"ies",1:ATT_"s")
"RTN","DSIO3V3",34,0)
 .. D ADD("<"_ID_">")
"RTN","DSIO3V3",35,0)
 .. S I="" F  S I=$O(ITEM(ATT,I)) Q:I=""  D  D:$L(Y) ADD(Y)
"RTN","DSIO3V3",36,0)
 ... S X=ITEM(ATT,I),Y="<"_ATT_" "
"RTN","DSIO3V3",37,0)
 ... I ATT="facility" D ADDFAC^DSIO3V2(X) S Y="" Q
"RTN","DSIO3V3",38,0)
 ... S Y=Y_"value='"_$$ESC^DSIO3V1(ITEM(ATT,I))_"' />"
"RTN","DSIO3V3",39,0)
 .. D ADD("</"_ID_">") S Y=""
"RTN","DSIO3V3",40,0)
 . S X=$G(ITEM(ATT)),Y="" Q:'$L(X)
"RTN","DSIO3V3",41,0)
 . I ATT="npi" S Y="<"_ATT_" value='"_$P(X,U)_"' status='"_$$ESC^DSIO3V1($P(X,U,2))_"' />" Q
"RTN","DSIO3V3",42,0)
 . I ATT="address" D ADDR^DSIO3V2(X) S Y="" Q
"RTN","DSIO3V3",43,0)
 . I ATT="telecom" D PHONE^DSIO3V2(X) S Y="" Q
"RTN","DSIO3V3",44,0)
 . I X'["^" S Y="<"_ATT_" value='"_$$ESC^DSIO3V1(X)_"' />" Q
"RTN","DSIO3V3",45,0)
 . S Y="<"_ATT_" code='"_$P(X,U)_"' name='"_$$ESC^DSIO3V1($P(X,U,2))_"' />"
"RTN","DSIO3V3",46,0)
 D ADD("</current_user>")
"RTN","DSIO3V3",47,0)
 Q
"RTN","DSIO3V3",48,0)
 ;
"RTN","DSIO3V3",49,0)
 ;=============================================================================
"RTN","DSIO3V3",50,0)
 ;                                  PARTICIPANT
"RTN","DSIO3V3",51,0)
 ;=============================================================================
"RTN","DSIO3V3",52,0)
 ;
"RTN","DSIO3V3",53,0)
PAR(DFN,BEG,END,MAX,ID) ; -- find patient family information (Participant)
"RTN","DSIO3V3",54,0)
 ; [BEG,END,MAX,ID not currently used]
"RTN","DSIO3V3",55,0)
 S DFN=+$G(DFN) Q:DFN<1  ;invalid patient
"RTN","DSIO3V3",56,0)
 N PAT,OUT,ERR,I,RT
"RTN","DSIO3V3",57,0)
 D LIST^DIC(408.12,,"@;.01;.02;.03","P",,,,,"I $P(^(0),U)=DFN",,"OUT","ERR")
"RTN","DSIO3V3",58,0)
 I $D(OUT) S I=$NA(OUT) F  S I=$Q(@I) Q:I=""  D
"RTN","DSIO3V3",59,0)
 .Q:$QS(I,2)<1
"RTN","DSIO3V3",60,0)
 .;name^relationship
"RTN","DSIO3V3",61,0)
 .Q:$P(@I,U,3)="SELF"
"RTN","DSIO3V3",62,0)
 .S PAT("family_member",$QS(I,2))=$P(@I,U,4)_U_$P(@I,U,3)
"RTN","DSIO3V3",63,0)
 .; POINTER TO (2) OR (408.13)
"RTN","DSIO3V3",64,0)
 .S RT=$$GET1^DIQ(408.12,+@I_",",.03,"I")
"RTN","DSIO3V3",65,0)
 .D ATCS($TR($P($P(RT,U,";",2),"(",2),",",""),+RT,$QS(I,2))
"RTN","DSIO3V3",66,0)
 K OUT D LIST^DIC(19641.01,","_DFN_",","@;.01IE;.02I","P",,,,,,,"OUT","ERR")
"RTN","DSIO3V3",67,0)
 I $D(OUT) S I=$NA(OUT) F  S I=$Q(@I) Q:I=""  D
"RTN","DSIO3V3",68,0)
 .Q:$QS(I,2)<1
"RTN","DSIO3V3",69,0)
 .;name^associated pregnancy_edc
"RTN","DSIO3V3",70,0)
 .S PAT("father_of_fetus",$QS(I,2))=$P(@I,U,3)_U_$$GET1^DIQ(790.05,$P(@I,U,4)_",",.04)
"RTN","DSIO3V3",71,0)
 .D ATCF($P(@I,U,2),$QS(I,2))
"RTN","DSIO3V3",72,0)
 D SUPP^DSIO3V2,XMLP(.PAT)
"RTN","DSIO3V3",73,0)
 Q
"RTN","DSIO3V3",74,0)
 ;
"RTN","DSIO3V3",75,0)
ATCF(IEN,ND) ;-address & telecom
"RTN","DSIO3V3",76,0)
 ;street1^st2^st3^city^state^zip
"RTN","DSIO3V3",77,0)
 ;phone
"RTN","DSIO3V3",78,0)
 N FLD,S S S="father_of_fetus"
"RTN","DSIO3V3",79,0)
 S PAT(S,ND,"address")=$$GET1^DIQ(19641.11,IEN_",",1.1)
"RTN","DSIO3V3",80,0)
 F FLD=1.2,1.3,1.4,1.5,1.6 D
"RTN","DSIO3V3",81,0)
 .S PAT(S,ND,"address")=PAT(S,ND,"address")_U_$$GET1^DIQ(19641.11,IEN_",",FLD)
"RTN","DSIO3V3",82,0)
 S PAT(S,ND,"telecom")=$$FORMAT^DSIO3V2($$GET1^DIQ(19641.11,IEN_",",1.7))
"RTN","DSIO3V3",83,0)
 Q
"RTN","DSIO3V3",84,0)
 ;
"RTN","DSIO3V3",85,0)
ATCS(FLE,IEN,ND) ;-address & telecom
"RTN","DSIO3V3",86,0)
 ;street1^st2^st3^city^state^zip
"RTN","DSIO3V3",87,0)
 ;home^cell^work phones
"RTN","DSIO3V3",88,0)
 N FLD,S S S="family_member" I FLE=2 D  Q
"RTN","DSIO3V3",89,0)
 .S PAT(S,ND,"address")=$$GET1^DIQ(2,IEN_",",.111)
"RTN","DSIO3V3",90,0)
 .F FLD=.112,.113,.114,.115,.116 D
"RTN","DSIO3V3",91,0)
 ..S PAT(S,ND,"address")=PAT(S,ND,"address")_U_$$GET1^DIQ(2,IEN_",",FLD)
"RTN","DSIO3V3",92,0)
 .S PAT(S,ND,"telecom")=$$FORMAT^DSIO3V2($$GET1^DIQ(2,IEN_",",.131))
"RTN","DSIO3V3",93,0)
 .F FLD=.134,.132 D
"RTN","DSIO3V3",94,0)
 ..S PAT(S,ND,"telecom")=PAT(S,ND,"telecom")_U_$$FORMAT^DSIO3V2($$GET1^DIQ(2,IEN_",",FLD))
"RTN","DSIO3V3",95,0)
 I FLE=408.13 D
"RTN","DSIO3V3",96,0)
 .S PAT(S,ND,"address")=$$GET1^DIQ(FLE,IEN_",",1.2)
"RTN","DSIO3V3",97,0)
 .F FLD=1.3,1.4,1.5,1.6,1.7 D
"RTN","DSIO3V3",98,0)
 ..S PAT(S,ND,"address")=PAT(S,ND,"address")_U_$$GET1^DIQ(FLE,IEN_",",FLD)
"RTN","DSIO3V3",99,0)
 .S PAT(S,ND,"telecom")=$$FORMAT^DSIO3V2($$GET1^DIQ(FLE,IEN_",",1.8))
"RTN","DSIO3V3",100,0)
 Q
"RTN","DSIO3V3",101,0)
 ;
"RTN","DSIO3V3",102,0)
XMLP(ITEM) ; -- Return patient family information data as XML in @VPR@(n)
"RTN","DSIO3V3",103,0)
 ; as <element code='123' displayName='ABC' />
"RTN","DSIO3V3",104,0)
 N ATT,X,Y,I,ID
"RTN","DSIO3V3",105,0)
 D ADD("<patient_family>") S VPRTOTL=$G(VPRTOTL)+1
"RTN","DSIO3V3",106,0)
 S ATT="" F  S ATT=$O(ITEM(ATT)) Q:ATT=""  D  D:$L(Y) ADD(Y)
"RTN","DSIO3V3",107,0)
 . I $L($O(ITEM(ATT,""))) D  Q  ;multiples
"RTN","DSIO3V3",108,0)
 .. S ID=$S($E(ATT,$L(ATT))="s":ATT_"es",$E(ATT,$L(ATT))="y":$E(ATT,1,$L(ATT)-1)_"ies",1:ATT_"s")
"RTN","DSIO3V3",109,0)
 .. D ADD("<"_ID_">")
"RTN","DSIO3V3",110,0)
 .. S I="" F  S I=$O(ITEM(ATT,I)) Q:I=""  D  D:$L(Y) ADD(Y)
"RTN","DSIO3V3",111,0)
 ... S X=ITEM(ATT,I),Y="<"_ATT_" "
"RTN","DSIO3V3",112,0)
 ... I ATT="support" D  S Y="" Q
"RTN","DSIO3V3",113,0)
 .... S Y=Y_"contactType='"_I_"' name='"_$$ESC^DSIO3V1($P(X,U))_$S($L($P(X,U,2)):"' relationship='"_$$ESC^DSIO3V1($P(X,U,2)),1:"")_"' >" D ADD(Y)
"RTN","DSIO3V3",114,0)
 .... S X=$G(ITEM(ATT,I,"address")) I $L(X) D ADDR^DSIO3V2(X)
"RTN","DSIO3V3",115,0)
 .... S X=$G(ITEM(ATT,I,"telecom")) I $L(X) D PHONE^DSIO3V2(X)
"RTN","DSIO3V3",116,0)
 .... D ADD("</support>")
"RTN","DSIO3V3",117,0)
 ... I ATT="family_member" D  S Y="" Q
"RTN","DSIO3V3",118,0)
 .... S Y=Y_"name='"_$$ESC^DSIO3V1($P(X,U))_$S($L($P(X,U,2)):"' relationship='"_$$ESC^DSIO3V1($P(X,U,2)),1:"")_"' >" D ADD(Y)
"RTN","DSIO3V3",119,0)
 .... S X=$G(ITEM(ATT,I,"address")) I $L(X) D ADDR^DSIO3V2(X)
"RTN","DSIO3V3",120,0)
 .... S X=$G(ITEM(ATT,I,"telecom")) I $L(X) D PHONE^DSIO3V2(X)
"RTN","DSIO3V3",121,0)
 .... D ADD("</family>")
"RTN","DSIO3V3",122,0)
 ... I ATT="father_of_fetus" D  S Y="" Q
"RTN","DSIO3V3",123,0)
 .... S Y=Y_"name='"_$$ESC^DSIO3V1($P(X,U))_$S($L($P(X,U,2)):"' associated_pregnancy_edc='"_$$ESC^DSIO3V1($P(X,U,2)),1:"")_"' >" D ADD(Y)
"RTN","DSIO3V3",124,0)
 .... S X=$G(ITEM(ATT,I,"address")) I $L(X) D ADDR^DSIO3V2(X)
"RTN","DSIO3V3",125,0)
 .... S X=$G(ITEM(ATT,I,"telecom")) I $L(X) D PHONE^DSIO3V2(X)
"RTN","DSIO3V3",126,0)
 .... D ADD("</father_of_fetus>")
"RTN","DSIO3V3",127,0)
 ... S Y=Y_"value='"_$$ESC^DSIO3V1(ITEM(ATT,I))_"' />"
"RTN","DSIO3V3",128,0)
 .. D ADD("</"_ID_">") S Y=""
"RTN","DSIO3V3",129,0)
 . S X=$G(ITEM(ATT)),Y="" Q:'$L(X)
"RTN","DSIO3V3",130,0)
 . I X'["^" S Y="<"_ATT_" value='"_$$ESC^DSIO3V1(X)_"' />" Q
"RTN","DSIO3V3",131,0)
 . S Y="<"_ATT_" code='"_$P(X,U)_"' name='"_$$ESC^DSIO3V1($P(X,U,2))_"' />"
"RTN","DSIO3V3",132,0)
 D ADD("</patient_family>")
"RTN","DSIO3V3",133,0)
 Q
"RTN","DSIO3V3",134,0)
 ;
"RTN","DSIO3V3",135,0)
 ;=============================================================================
"RTN","DSIO3V3",136,0)
 ;                              DOCUMENTATION OF
"RTN","DSIO3V3",137,0)
 ;=============================================================================
"RTN","DSIO3V3",138,0)
 ;
"RTN","DSIO3V3",139,0)
 ; LAB - D RR^LR7OR1(DFN,,BEG,END,VPRSUB,,,MAX)
"RTN","DSIO3V3",140,0)
 ; - ACCESSION
"RTN","DSIO3V3",141,0)
 ; - LAB
"RTN","DSIO3V3",142,0)
 ; - PANEL
"RTN","DSIO3V3",143,0)
 ;
"RTN","DSIO3V3",144,0)
 ; - CLINICAL PROCEDURE
"RTN","DSIO3V3",145,0)
 ; - CONSULT
"RTN","DSIO3V3",146,0)
 ; 
"RTN","DSIO3V3",147,0)
DOC(DFN,BEG,END,MAX,ID) ; -- find performer (current user) information (Documentation Of)
"RTN","DSIO3V3",148,0)
 N LRDFN
"RTN","DSIO3V3",149,0)
 S DFN=+$G(DFN) Q:$G(DFN)<1
"RTN","DSIO3V3",150,0)
 S BEG=$G(BEG,1410101),END=$G(END,4141015),MAX=$G(MAX,9999)
"RTN","DSIO3V3",151,0)
 K ^TMP("LRRR",$J,DFN) S LRDFN=$G(^DPT(DFN,"LR")) Q:LRDFN=""
"RTN","DSIO3V3",152,0)
 D RR^LR7OR1(DFN,,BEG,END,,,,MAX)
"RTN","DSIO3V3",153,0)
 Q
"RTN","DSIO3V3",154,0)
 ;
"RTN","DSIO3V3",155,0)
 ;=============================================================================
"RTN","DSIO3V3",156,0)
 ;                                   SHARED
"RTN","DSIO3V3",157,0)
 ;=============================================================================
"RTN","DSIO3V3",158,0)
 ;
"RTN","DSIO3V3",159,0)
ATC(IEN) ;-address & telecom
"RTN","DSIO3V3",160,0)
 N FLD
"RTN","DSIO3V3",161,0)
 ;street1^st2^st3^city^state^zip
"RTN","DSIO3V3",162,0)
 S PAT("address")=$$GET1^DIQ(200,IEN_",",.111)
"RTN","DSIO3V3",163,0)
 F FLD=.112,.113,.114,.115,.116 D
"RTN","DSIO3V3",164,0)
 .S PAT("address")=PAT("address")_U_$$GET1^DIQ(200,IEN_",",FLD)
"RTN","DSIO3V3",165,0)
 ;home^office^phone #3^phone #4^commercial phone
"RTN","DSIO3V3",166,0)
 S PAT("telecom")=$$FORMAT^DSIO3V2($$GET1^DIQ(200,IEN_",",.131))
"RTN","DSIO3V3",167,0)
 F FLD=.132,.133,.134,.135 D
"RTN","DSIO3V3",168,0)
 .S PAT("telecom")=PAT("telecom")_U_$$FORMAT^DSIO3V2($$GET1^DIQ(200,IEN_",",FLD))
"RTN","DSIO3V3",169,0)
 Q
"RTN","DSIO3V3",170,0)
 ;
"RTN","DSIO3V3",171,0)
ADD(X) ; Add a line @VPR@(n)=X
"RTN","DSIO3V3",172,0)
 S VPRI=$G(VPRI)+1
"RTN","DSIO3V3",173,0)
 S @VPR@(VPRI)=X
"RTN","DSIO3V3",174,0)
 Q
"RTN","DSIO4")
0^3^B19271651
"RTN","DSIO4",1,0)
DSIO4 ;DSS/TFF - DSIO RPCS;06/28/2013 15:19
"RTN","DSIO4",2,0)
 ;;1.0;DSS,INC OPEN SOURCE;;28 Jan 2013;Build 25
"RTN","DSIO4",3,0)
 ;Copyright 1995-2014,Document Storage Systems Inc. All Rights Reserved
"RTN","DSIO4",4,0)
 ;
"RTN","DSIO4",5,0)
 ;
"RTN","DSIO4",6,0)
 ; Documented API and ICRs
"RTN","DSIO4",7,0)
 ; -----------------------
"RTN","DSIO4",8,0)
 ;
"RTN","DSIO4",9,0)
 Q
"RTN","DSIO4",10,0)
 ;
"RTN","DSIO4",11,0)
GET(RET,DFN,ITEM) ; RPC: DSIO GET SINGLE VALUE
"RTN","DSIO4",12,0)
 ;
"RTN","DSIO4",13,0)
 ; RETURN = LITERAL
"RTN","DSIO4",14,0)
 ;
"RTN","DSIO4",15,0)
 S DFN=+$G(DFN) I DFN<1 S RET="-1^Invalid DFN" Q
"RTN","DSIO4",16,0)
 S ITEM=$$UP^XLFSTR($G(ITEM)) S RET=-1
"RTN","DSIO4",17,0)
 ;
"RTN","DSIO4",18,0)
 ; NEXT CONTACT DATE
"RTN","DSIO4",19,0)
 I ITEM="NEXT CONTACT DATE" D  Q
"RTN","DSIO4",20,0)
 .S RET=$$GET1^DIQ(19641,DFN_",",.03)
"RTN","DSIO4",21,0)
 ;
"RTN","DSIO4",22,0)
 ; INSTITUTION
"RTN","DSIO4",23,0)
 I ITEM="INSTITUTION" D  Q
"RTN","DSIO4",24,0)
 .;IEN^NAME^LATESTDATE^DOMAIN^STREET1^STREET2^CITY^STATE^ZIP^HOMESITE
"RTN","DSIO4",25,0)
 .N PAT D FAC^DSIO3V2 S RET=PAT("facility",$O(PAT("facility","")))
"RTN","DSIO4",26,0)
 ;
"RTN","DSIO4",27,0)
 ; FATHER OF FETUS
"RTN","DSIO4",28,0)
 I ITEM="FATHER OF FETUS" D  Q
"RTN","DSIO4",29,0)
 .;IEN^NAME^STREET1^STREET2^STREET3^CITY^STATE^ZIP^PHONE
"RTN","DSIO4",30,0)
 .;GET CURRENT FATHER OF FETUS BASED OFF MOST RECENT EDC
"RTN","DSIO4",31,0)
 .;
"RTN","DSIO4",32,0)
 .N OUT,I,EDC,FIEN,FOUT
"RTN","DSIO4",33,0)
 .D LIST^DIC(19641.01,","_DFN_",","@;.01IE;.02I","P",,,,,,,"OUT","ERR")
"RTN","DSIO4",34,0)
 .I $D(OUT) S I=$NA(OUT) F  S I=$Q(@I) Q:I=""  D
"RTN","DSIO4",35,0)
 ..Q:$QS(I,2)<1
"RTN","DSIO4",36,0)
 ..S EDC(+$$GET1^DIQ(790.05,$P(@I,U,4)_",",.04,"I"))=$P(@I,U,2)
"RTN","DSIO4",37,0)
 .S FIEN=EDC($O(EDC(""),-1)) Q:FIEN=""
"RTN","DSIO4",38,0)
 .D GETS^DIQ(19641.11,FIEN_",",".01;1.1;1.2;1.3;1.4;1.5;1.6;1.7",,"FOUT")
"RTN","DSIO4",39,0)
 .I $D(FOUT) S RET=FIEN,I=$NA(FOUT) F  S I=$Q(@I) Q:I=""  S RET=$G(RET)_U_@I
"RTN","DSIO4",40,0)
 .S:$P(RET,U,2)'="" $P(RET,U,2)=$$NAME^DSIO2($P(RET,U,2))
"RTN","DSIO4",41,0)
 .S:$P(RET,U,9)'="" $P(RET,U,9)=$$FORMAT^DSIO3V2($P(RET,U,9))
"RTN","DSIO4",42,0)
 Q
"RTN","DSIO4",43,0)
 ;
"RTN","DSIO4",44,0)
SENT(RET,SAVE) ; RPC: DSIO SAVE NON VA ENTITY
"RTN","DSIO4",45,0)
 ;
"RTN","DSIO4",46,0)
 ; SAVE(#)=FIELD^VALUE   (FOR .01: FIELD^OLD^NEW VALUE)
"RTN","DSIO4",47,0)
 ; RETURN: LITERAL
"RTN","DSIO4",48,0)
 ;         -1^ERROR MESSAGE
"RTN","DSIO4",49,0)
 ;          1^IEN
"RTN","DSIO4",50,0)
 ;
"RTN","DSIO4",51,0)
 N CT,FLD,TMP,IPT,IPT1,IEN,FLG S RET=-1
"RTN","DSIO4",52,0)
 S CT="" F  S CT=$O(SAVE(CT)) Q:CT=""  D
"RTN","DSIO4",53,0)
 .S FLD=$$FLDNUM^DILFD(19641.1,$$UP^XLFSTR($P(SAVE(CT),U))) Q:FLD=0
"RTN","DSIO4",54,0)
 .S TMP(FLD)=$P(SAVE(CT),U,2,3)
"RTN","DSIO4",55,0)
 I $G(TMP(.01))="" S RET="-1^The name of the entity must be provided." Q
"RTN","DSIO4",56,0)
 D SENT1(.IEN,.01)
"RTN","DSIO4",57,0)
 I +$G(IEN)<1 S RET="-1^Could not identify entity." Q
"RTN","DSIO4",58,0)
 K IPT S FLD="" F  S FLD=$O(TMP(FLD)) Q:FLD=""  D  Q:$D(FLG)
"RTN","DSIO4",59,0)
 .I FLD=.01&($P(TMP(FLD),U,2)'="") D  Q
"RTN","DSIO4",60,0)
 ..I $$FIND1^DIC(19641.1,,"O",$$UP^XLFSTR($P(TMP(FLD),U,2))) D  Q
"RTN","DSIO4",61,0)
 ...S RET="-1^Cannot rename an entity to match an existing entity.",FLG=1
"RTN","DSIO4",62,0)
 ..S IPT(19641.1,IEN_",",FLD)=$$UP^XLFSTR($P(TMP(FLD),U,2))
"RTN","DSIO4",63,0)
 .S:FLD'=.01!(FLD'=1.5) IPT(19641.1,IEN_",",FLD)=$P(TMP(FLD),U)
"RTN","DSIO4",64,0)
 .I FLD=.04 D SENT1(,.04) S IPT(19641.1,IEN_",",FLD)=$$UP^XLFSTR($P(TMP(FLD),U))
"RTN","DSIO4",65,0)
 .I FLD=1.5 S IPT1(19641.1,IEN_",",FLD)=$$UP^XLFSTR($P(TMP(FLD),U))
"RTN","DSIO4",66,0)
 D:$D(IPT) FILE^DIE("E","IPT"),FILE^DIE(,"IPT1") K IPT,IPT1
"RTN","DSIO4",67,0)
 S:'$D(FLG) RET="1^"_IEN
"RTN","DSIO4",68,0)
 Q
"RTN","DSIO4",69,0)
 ;
"RTN","DSIO4",70,0)
SENT1(IEN,VAL) ;
"RTN","DSIO4",71,0)
 N IPT,AIEN S IPT(19641.1,"?+1,",.01)=$$UP^XLFSTR($P(TMP(VAL),U))
"RTN","DSIO4",72,0)
 I VAL=.01 S IPT(19641.1,"?+1,",.02)=$$UP^XLFSTR($P(TMP(.02),U))
"RTN","DSIO4",73,0)
 E  S IPT(19641.1,"?+1,",.02)="P"
"RTN","DSIO4",74,0)
 D UPDATE^DIE(,"IPT","AIEN") S IEN=+AIEN(1)
"RTN","DSIO4",75,0)
 Q
"RTN","DSIO4",76,0)
 ;
"RTN","DSIO4",77,0)
RENT(RET,TYP,SORT) ; RPC: DSIO RETURN ENTITY
"RTN","DSIO4",78,0)
 ;
"RTN","DSIO4",79,0)
 ; SORT: PAGE#,CT
"RTN","DSIO4",80,0)
 ;
"RTN","DSIO4",81,0)
 ; RETURN: GLOBAL ARRAY
"RTN","DSIO4",82,0)
 ;
"RTN","DSIO4",83,0)
 ; IEN^NAME^TYPE^INACTIVE^PRIMARY PROVIDER NAME^STREET ADDRESS 1
"RTN","DSIO4",84,0)
 ; ^STREET ADDRESS 2^STREET ADDRESS 3^CITY^STATE^ZIP CODE
"RTN","DSIO4",85,0)
 ; ^PHONE NUMBER (HOME)^PHONE NUMBER (OFFICE)^PHONE NUMBER (CELL)^FAX NUMBER
"RTN","DSIO4",86,0)
 ;
"RTN","DSIO4",87,0)
 ; TYP - F        (FACILITIES)
"RTN","DSIO4",88,0)
 ;       P        (PROVIDERS)
"RTN","DSIO4",89,0)
 ;       NULL     (ALL ENTITIES)
"RTN","DSIO4",90,0)
 ;       IEN/NAME (SINGLE ENTITY)
"RTN","DSIO4",91,0)
 ;
"RTN","DSIO4",92,0)
 N FLD,IEN,OUT,ERR,TO,STRT,T,CT,Z,I,LN
"RTN","DSIO4",93,0)
 S TYP=$$UP^XLFSTR($G(TYP,"B"))
"RTN","DSIO4",94,0)
 S RET=$NA(^TMP("DSIO RENTRET",$J)),OUT=$NA(^TMP("DSIO RENT",$J))
"RTN","DSIO4",95,0)
 K @RET,@OUT S @RET@(0)="-1^No entries found."
"RTN","DSIO4",96,0)
 S FLD="@;.01;.02;.03;.04E;1.1;1.2;1.3;1.4;1.5I;1.6;2.1;2.2;2.3;2.4"
"RTN","DSIO4",97,0)
 I TYP?.N!($L(TYP)>1)&(TYP'="") D  Q
"RTN","DSIO4",98,0)
 .I TYP?.N S IEN=$$FIND1^DIC(19641.1,,"A",TYP) Q:IEN=0
"RTN","DSIO4",99,0)
 .S:'$D(IEN) IEN=$$FIND1^DIC(19641.1,,"X",TYP) Q:IEN=0
"RTN","DSIO4",100,0)
 .D GETS^DIQ(19641.1,IEN_",","*","E","OUT") Q:'$D(OUT)
"RTN","DSIO4",101,0)
 .S @RET@(0)=IEN,CT=$NA(OUT) F  S CT=$Q(@CT) Q:CT=""  S @RET@(0)=@RET@(0)_U_@CT
"RTN","DSIO4",102,0)
 .S $P(@RET@(0),U,10)=$$GET1^DIQ(19641.1,IEN_",",1.5,"I")
"RTN","DSIO4",103,0)
 .S $P(@RET@(0),U,2)=$$TITLE^XLFSTR($P(@RET@(0),U,2))
"RTN","DSIO4",104,0)
 .S $P(@RET@(0),U,5)=$$TITLE^XLFSTR($P(@RET@(0),U,5))
"RTN","DSIO4",105,0)
 S (TO,STRT,T)=0 I $G(SORT)?.N1",".N D
"RTN","DSIO4",106,0)
 .S STRT=$$FN^DSIO2($P(SORT,","),$P(SORT,",",2))
"RTN","DSIO4",107,0)
 D LIST^DIC(19641.1,,FLD,"P",,,,$G(TYP),"S TO=TO+1",,OUT,"ERR") Q:$D(ERR)
"RTN","DSIO4",108,0)
 S CT=1,Z=STRT F I=0:1 S Z=$O(@OUT@("DILIST",Z)) Q:Z=""  D
"RTN","DSIO4",109,0)
 .I $P($G(SORT),",",2)'="" I T>=$P($G(SORT),",",2) S T=T+1 Q
"RTN","DSIO4",110,0)
 .S @RET@(CT)=@OUT@("DILIST",Z,0)
"RTN","DSIO4",111,0)
 .S $P(@RET@(CT),U,2)=$$TITLE^XLFSTR($P(@RET@(CT),U,2))
"RTN","DSIO4",112,0)
 .S $P(@RET@(CT),U,5)=$$TITLE^XLFSTR($P(@RET@(CT),U,5))
"RTN","DSIO4",113,0)
 .S T=T+1,CT=CT+1
"RTN","DSIO4",114,0)
 K @OUT I T>0 S @RET@(0)=TO
"RTN","DSIO4",115,0)
 Q
"SEC","^DIC",19641,19641,0,"AUDIT")
@
"SEC","^DIC",19641,19641,0,"DD")
@
"SEC","^DIC",19641.11,19641.11,0,"AUDIT")
@
"SEC","^DIC",19641.11,19641.11,0,"DD")
@
"SEC","^DIC",19641.6,19641.6,0,"AUDIT")
@
"SEC","^DIC",19641.6,19641.6,0,"DD")
@
"VER")
8.0^22.0
"^DD",19641,19641,0)
FIELD^^1^4
"^DD",19641,19641,0,"DDA")
N
"^DD",19641,19641,0,"DT")
3140416
"^DD",19641,19641,0,"IX","B",19641,.01)

"^DD",19641,19641,0,"IX","TRACKING",19641,.02)

"^DD",19641,19641,0,"NM","DSIO PATIENT")

"^DD",19641,19641,0,"PT",19641.2,.01)

"^DD",19641,19641,.01,0)
PATIENT^R*P2'X^DPT(^0;1^S DIC("S")="I $P(^DPT(Y,0),U,2)=""F""" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X S:$D(X) DINUM=X
"^DD",19641,19641,.01,1,0)
^.1
"^DD",19641,19641,.01,1,1,0)
19641^B
"^DD",19641,19641,.01,1,1,1)
S ^DSIO(19641,"B",$E(X,1,30),DA)=""
"^DD",19641,19641,.01,1,1,2)
K ^DSIO(19641,"B",$E(X,1,30),DA)
"^DD",19641,19641,.01,3)

"^DD",19641,19641,.01,12)
Only female patients.
"^DD",19641,19641,.01,12.1)
S DIC("S")="I $P(^DPT(Y,0),U,2)=""F"""
"^DD",19641,19641,.01,"DT")
3131118
"^DD",19641,19641,.02,0)
TRACKING STATUS^S^0:NO;1:YES;2:FLAG;^0;2^Q
"^DD",19641,19641,.02,1,0)
^.1
"^DD",19641,19641,.02,1,1,0)
19641^TRACKING
"^DD",19641,19641,.02,1,1,1)
S ^DSIO(19641,"TRACKING",$E(X,1,30),DA)=""
"^DD",19641,19641,.02,1,1,2)
K ^DSIO(19641,"TRACKING",$E(X,1,30),DA)
"^DD",19641,19641,.02,1,1,"DT")
3131120
"^DD",19641,19641,.02,"DT")
3131202
"^DD",19641,19641,.03,0)
NEXT CONTACT DATE^D^^0;3^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",19641,19641,.03,"DT")
3140127
"^DD",19641,19641,1,0)
FATHER OF FETUS^19641.01P^^1;0
"^DD",19641,19641,1,"DT")
3140416
"^DD",19641,19641.01,0)
FATHER OF FETUS SUB-FIELD^^.02^2
"^DD",19641,19641.01,0,"DT")
3140416
"^DD",19641,19641.01,0,"IX","B",19641.01,.01)

"^DD",19641,19641.01,0,"NM","FATHER OF FETUS")

"^DD",19641,19641.01,0,"UP")
19641
"^DD",19641,19641.01,.01,0)
PERSON^MR*P19641.11^DSIO(19641.11,^0;1^S DIC("S")="I +$P(^(0),U,2)<2" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",19641,19641.01,.01,1,0)
^.1
"^DD",19641,19641.01,.01,1,1,0)
19641.01^B
"^DD",19641,19641.01,.01,1,1,1)
S ^DSIO(19641,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",19641,19641.01,.01,1,1,2)
K ^DSIO(19641,DA(1),1,"B",$E(X,1,30),DA)
"^DD",19641,19641.01,.01,12)
Cannot select female.
"^DD",19641,19641.01,.01,12.1)
S DIC("S")="I +$P(^(0),U,2)<2"
"^DD",19641,19641.01,.01,"DT")
3140416
"^DD",19641,19641.01,.02,0)
ASSOCIATED PREGNANCY^R*P790.05'^WV(790.05,^0;2^S DIC("S")="I $P(^(0),U,2)=DA(1)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",19641,19641.01,.02,12)
Associated the Father of Fetus with the patient's pregnancy.
"^DD",19641,19641.01,.02,12.1)
S DIC("S")="I $P(^(0),U,2)=DA(1)"
"^DD",19641,19641.01,.02,"DT")
3140416
"^DD",19641.11,19641.11,0)
FIELD^^1.5^9
"^DD",19641.11,19641.11,0,"DDA")
N
"^DD",19641.11,19641.11,0,"DT")
3140417
"^DD",19641.11,19641.11,0,"ID",.02)
W ""
"^DD",19641.11,19641.11,0,"IX","B",19641.11,.01)

"^DD",19641.11,19641.11,0,"NM","DSIO PERSONS")

"^DD",19641.11,19641.11,0,"PT",19641.01,.01)

"^DD",19641.11,19641.11,.01,0)
NAME^RF^^0;1^K:$L(X)>40!($L(X)<3) X
"^DD",19641.11,19641.11,.01,1,0)
^.1
"^DD",19641.11,19641.11,.01,1,1,0)
19641.11^B
"^DD",19641.11,19641.11,.01,1,1,1)
S ^DSIO(19641.11,"B",$E(X,1,30),DA)=""
"^DD",19641.11,19641.11,.01,1,1,2)
K ^DSIO(19641.11,"B",$E(X,1,30),DA)
"^DD",19641.11,19641.11,.01,3)
Name must be in the format LASNAME,FIRSTNAME MIDDLE where MIDDLE is optional.
"^DD",19641.11,19641.11,.01,"DT")
3140415
"^DD",19641.11,19641.11,.02,0)
SEX^RS^1:MALE;2:FEMALE;0:UNKNOWN;^0;2^Q
"^DD",19641.11,19641.11,.02,"DT")
3140416
"^DD",19641.11,19641.11,1.1,0)
STREET ADDRESS [LINE 1]^F^^1;1^K:$L(X)>30!($L(X)<3) X
"^DD",19641.11,19641.11,1.1,3)
Answer must be 3-30 characters in length.
"^DD",19641.11,19641.11,1.1,"DT")
3140415
"^DD",19641.11,19641.11,1.2,0)
STREET ADDRESS [LINE 2]^F^^1;2^K:$L(X)>30!($L(X)<3) X
"^DD",19641.11,19641.11,1.2,3)
Answer must be 3-30 characters in length.
"^DD",19641.11,19641.11,1.2,"DT")
3140415
"^DD",19641.11,19641.11,1.3,0)
STREET ADDRESS [LINE 3]^F^^1;3^K:$L(X)>30!($L(X)<3) X
"^DD",19641.11,19641.11,1.3,3)
Answer must be 3-30 characters in length.
"^DD",19641.11,19641.11,1.3,"DT")
3140415
"^DD",19641.11,19641.11,1.4,0)
CITY^F^^1;4^K:$L(X)>20!($L(X)<1) X
"^DD",19641.11,19641.11,1.4,3)
Answer must be 1-20 characters in length.
"^DD",19641.11,19641.11,1.4,"DT")
3140415
"^DD",19641.11,19641.11,1.5,0)
STATE^*P5'X^DIC(5,^1;5^S DIC("S")="I $P(^DIC(5,Y,0),U,6)=1" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",19641.11,19641.11,1.5,3)
Select from the available listing the state in which this person resides.
"^DD",19641.11,19641.11,1.5,12)
This screen prevents selection of entires that are valid US states or possessions.
"^DD",19641.11,19641.11,1.5,12.1)
S DIC("S")="I $P(^DIC(5,Y,0),U,6)=1"
"^DD",19641.11,19641.11,1.5,"DT")
3140417
"^DD",19641.11,19641.11,1.6,0)
ZIP CODE^FX^^1;6^K:X[""""!($A(X)=45) X I $D(X) K:$L(X)>5!($L(X)<5)!'(X?5N) X
"^DD",19641.11,19641.11,1.6,3)
Answer must be 5 characters in length.
"^DD",19641.11,19641.11,1.6,"DT")
3140415
"^DD",19641.11,19641.11,1.7,0)
PHONE NUMBER^F^^1;7^K:$L(X)>20!($L(X)<4) X
"^DD",19641.11,19641.11,1.7,3)
Answer must be 4-20 characters in length.
"^DD",19641.11,19641.11,1.7,"DT")
3140415
"^DD",19641.6,19641.6,0)
FIELD^^1^2
"^DD",19641.6,19641.6,0,"DDA")
N
"^DD",19641.6,19641.6,0,"DT")
3140402
"^DD",19641.6,19641.6,0,"IX","B",19641.6,.01)

"^DD",19641.6,19641.6,0,"NM","DSIO IHE DOCUMENT")

"^DD",19641.6,19641.6,.01,0)
PATIENT^RP2'X^DPT(^0;1^S:$D(X) DINUM=X
"^DD",19641.6,19641.6,.01,1,0)
^.1
"^DD",19641.6,19641.6,.01,1,1,0)
19641.6^B
"^DD",19641.6,19641.6,.01,1,1,1)
S ^DSIO(19641.6,"B",$E(X,1,30),DA)=""
"^DD",19641.6,19641.6,.01,1,1,2)
K ^DSIO(19641.6,"B",$E(X,1,30),DA)
"^DD",19641.6,19641.6,.01,3)

"^DD",19641.6,19641.6,.01,"DT")
3140402
"^DD",19641.6,19641.6,1,0)
GUID^19641.62A^^1;0
"^DD",19641.6,19641.62,0)
GUID SUB-FIELD^^2^9
"^DD",19641.6,19641.62,0,"DT")
3140402
"^DD",19641.6,19641.62,0,"IX","B",19641.62,.01)

"^DD",19641.6,19641.62,0,"NM","GUID")

"^DD",19641.6,19641.62,0,"UP")
19641.6
"^DD",19641.6,19641.62,.01,0)
GUID^FX^^0;1^K:$L(X)>50!($L(X)<36)!($D(^DSIO(19641.6,"C",X))) X
"^DD",19641.6,19641.62,.01,1,0)
^.1^^-1
"^DD",19641.6,19641.62,.01,1,1,0)
19641.62^B
"^DD",19641.6,19641.62,.01,1,1,1)
S ^DSIO(19641.6,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",19641.6,19641.62,.01,1,1,2)
K ^DSIO(19641.6,DA(1),1,"B",$E(X,1,30),DA)
"^DD",19641.6,19641.62,.01,3)
Answer must be 36-50 characters in length.
"^DD",19641.6,19641.62,.01,"DT")
3140402
"^DD",19641.6,19641.62,.02,0)
DT CREATION^D^^0;2^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",19641.6,19641.62,.02,"DT")
3140402
"^DD",19641.6,19641.62,.03,0)
DT IMPORT/EXPORT^D^^0;3^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",19641.6,19641.62,.03,"DT")
3140416
"^DD",19641.6,19641.62,.04,0)
DOCUMENT TYPE^P19641.61'^DSIO(19641.61,^0;4^Q
"^DD",19641.6,19641.62,.04,"DT")
3140402
"^DD",19641.6,19641.62,.05,0)
DIRECTION^S^I:IN;O:OUT;^0;5^Q
"^DD",19641.6,19641.62,.05,"DT")
3140402
"^DD",19641.6,19641.62,1.1,0)
DOCUMENT TITLE^F^^1;1^K:$L(X)>100!($L(X)<1) X
"^DD",19641.6,19641.62,1.1,3)
Answer must be 1-100 characters in length.
"^DD",19641.6,19641.62,1.1,"DT")
3140402
"^DD",19641.6,19641.62,1.2,0)
SENDING FACILITY/PROVIDER^F^^1;2^K:$L(X)>50!($L(X)<1) X
"^DD",19641.6,19641.62,1.2,3)
Answer must be 1-50 characters in length.
"^DD",19641.6,19641.62,1.2,"DT")
3140402
"^DD",19641.6,19641.62,1.3,0)
INTENDED RECIPIENT^F^^1;3^K:$L(X)>50!($L(X)<1) X
"^DD",19641.6,19641.62,1.3,3)
Answer must be 1-50 characters in length.
"^DD",19641.6,19641.62,1.3,"DT")
3140402
"^DD",19641.6,19641.62,2,0)
DOCUMENT CONTENT^19641.622^^2;0
"^DD",19641.6,19641.622,0)
DOCUMENT CONTENT SUB-FIELD^^.01^1
"^DD",19641.6,19641.622,0,"DT")
3140402
"^DD",19641.6,19641.622,0,"NM","DOCUMENT CONTENT")

"^DD",19641.6,19641.622,0,"UP")
19641.62
"^DD",19641.6,19641.622,.01,0)
DOCUMENT CONTENT^Wx^^0;1^Q
"^DD",19641.6,19641.622,.01,"DT")
3140402
"^DIC",19641,19641,0)
DSIO PATIENT^19641
"^DIC",19641,19641,0,"GL")
^DSIO(19641,
"^DIC",19641,"B","DSIO PATIENT",19641)

"^DIC",19641.11,19641.11,0)
DSIO PERSONS^19641.11
"^DIC",19641.11,19641.11,0,"GL")
^DSIO(19641.11,
"^DIC",19641.11,"B","DSIO PERSONS",19641.11)

"^DIC",19641.6,19641.6,0)
DSIO IHE DOCUMENT^19641.6
"^DIC",19641.6,19641.6,0,"GL")
^DSIO(19641.6,
"^DIC",19641.6,"B","DSIO IHE DOCUMENT",19641.6)

**END**
**END**
